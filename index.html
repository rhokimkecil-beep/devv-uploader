<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DEV UPLOADER â€” Premium Asset Platform</title>
<meta name="description" content="Platform upload asset Roblox premium">
<meta name="theme-color" content="#020408">
<link rel="manifest" href="data:application/json,%7B%22name%22%3A%22DEV+Uploader%22%2C%22short_name%22%3A%22DEV%22%2C%22start_url%22%3A%22%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23020408%22%2C%22theme_color%22%3A%22%23020408%22%7D">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{--void:#010306;--deep:#050b14;--glass:rgba(255,255,255,0.025);--rim:rgba(255,255,255,0.06);--rim2:rgba(255,255,255,0.12);--gold:#c9a84c;--gold2:#f0d080;--gold3:#ffe9a0;--teal:#00e5c8;--red:#ff4466;--red-dim:rgba(255,68,102,0.12);--green:#00e5a0;--purple:#a78bfa;--blue:#60a5fa;--text:#dde6f0;--muted:#3d5570;--muted2:#6a8099;}
html{scroll-behavior:smooth;}
body{background:var(--void);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden;}
#c{position:fixed;inset:0;z-index:0;pointer-events:none;}
.scanlines{position:fixed;inset:0;z-index:1;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px);}
.vignette{position:fixed;inset:0;z-index:1;pointer-events:none;background:radial-gradient(ellipse at center,transparent 50%,rgba(0,0,0,0.7) 100%);}
/* AUTH */
#screen-auth{position:fixed;inset:0;z-index:50;display:flex;align-items:center;justify-content:center;background:var(--void);padding:20px;overflow-y:auto;}
.auth-box{width:100%;max-width:400px;background:linear-gradient(145deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));border:1px solid var(--rim);border-radius:28px;padding:36px 28px;position:relative;animation:fadeUp 0.6s ease;}
.auth-box::before{content:'';position:absolute;top:0;left:15%;right:15%;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,0.8),transparent);}
.auth-logo{font-family:'Bebas Neue',sans-serif;font-size:52px;letter-spacing:8px;text-align:center;display:block;margin-bottom:4px;background:linear-gradient(160deg,#fff 0%,var(--gold2) 30%,var(--gold) 60%,#8b6520 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.auth-tagline{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:4px;color:var(--muted);text-align:center;text-transform:uppercase;margin-bottom:28px;}
.auth-tabs{display:flex;gap:2px;background:rgba(255,255,255,0.03);border:1px solid var(--rim);border-radius:12px;padding:3px;margin-bottom:24px;}
.auth-tab{flex:1;padding:10px;border:none;background:none;color:var(--muted);font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;border-radius:10px;transition:all 0.25s;}
.auth-tab.active{background:linear-gradient(135deg,rgba(201,168,76,0.2),rgba(201,168,76,0.05));color:var(--gold2);border:1px solid rgba(201,168,76,0.3);}
.auth-form{display:none;}.auth-form.active{display:block;animation:fadeUp 0.3s ease;}
.auth-field{margin-bottom:14px;}
.auth-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:6px;display:block;}
.auth-input{width:100%;background:rgba(255,255,255,0.03);border:1px solid var(--rim);border-radius:10px;padding:12px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;outline:none;transition:all 0.25s;}
.auth-input::placeholder{color:var(--muted);}
.auth-input:focus{border-color:rgba(201,168,76,0.5);box-shadow:0 0 0 3px rgba(201,168,76,0.07);}
.auth-err{background:rgba(255,68,102,0.1);border:1px solid rgba(255,68,102,0.25);border-radius:8px;padding:10px 14px;font-family:'DM Mono',monospace;font-size:11px;color:var(--red);margin-bottom:14px;display:none;}
.btn-auth{width:100%;padding:15px;border:none;border-radius:12px;background:linear-gradient(100deg,#8b6520,var(--gold),var(--gold2),var(--gold),#8b6520);background-size:300% 100%;color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:3px;cursor:pointer;position:relative;overflow:hidden;transition:all 0.4s;box-shadow:0 4px 25px rgba(201,168,76,0.25);margin-bottom:10px;}
.btn-auth:hover:not(:disabled){background-position:100% 0;}
.btn-auth:disabled{opacity:0.4;cursor:not-allowed;}
.btn-google{width:100%;padding:13px;border:1px solid var(--rim2);border-radius:12px;background:rgba(255,255,255,0.04);color:var(--text);font-family:'Syne',sans-serif;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;}
.auth-divider{display:flex;align-items:center;gap:10px;margin:14px 0;}
.auth-divider-line{flex:1;height:1px;background:var(--rim);}
.auth-divider-txt{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.ref-hint{background:rgba(0,229,160,0.05);border:1px solid rgba(0,229,160,0.2);border-radius:10px;padding:10px 14px;font-family:'DM Mono',monospace;font-size:10px;color:rgba(0,229,160,0.7);margin-bottom:14px;line-height:1.6;display:none;}
/* APP */
#screen-app{display:none;}#screen-admin{display:none;}
.wrap{position:relative;z-index:2;max-width:520px;margin:0 auto;padding:0 16px 80px;}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 0 8px;}
.topbar-user{display:flex;align-items:center;gap:10px;}
.user-avatar{width:38px;height:38px;border-radius:50%;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.3);display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;transition:all 0.2s;}
.user-avatar:hover{transform:scale(1.1);}
.user-name{font-size:13px;font-weight:700;}.user-email{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.topbar-btns{display:flex;gap:6px;align-items:center;}
.btn-sm{padding:7px 12px;border-radius:8px;font-family:'Syne',sans-serif;font-size:10px;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.2s;border:1px solid;}
.btn-sm-gold{background:rgba(201,168,76,0.1);border-color:rgba(201,168,76,0.3);color:var(--gold);}
.btn-sm-red{background:rgba(255,68,102,0.08);border-color:rgba(255,68,102,0.2);color:var(--red);}
/* NOTIF */
.notif-btn{position:relative;width:36px;height:36px;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid var(--rim);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;}
.notif-badge{position:absolute;top:-4px;right:-4px;min-width:18px;height:18px;border-radius:9px;background:var(--red);color:#fff;font-family:'DM Mono',monospace;font-size:9px;display:none;align-items:center;justify-content:center;padding:0 3px;}
.notif-panel{position:fixed;top:64px;right:16px;width:300px;max-width:calc(100vw - 32px);background:linear-gradient(145deg,#0d1a2e,#080f1a);border:1px solid rgba(201,168,76,0.2);border-radius:20px;z-index:300;display:none;max-height:65vh;overflow:hidden;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,0.6);}
.notif-panel.show{display:flex;animation:fadeUp 0.3s ease;}
.notif-panel-hdr{padding:14px 18px 10px;border-bottom:1px solid var(--rim);display:flex;justify-content:space-between;align-items:center;}
.notif-panel-title{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:3px;color:var(--gold2);}
.notif-panel-clear{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);cursor:pointer;}
.notif-panel-clear:hover{color:var(--gold);}
.notif-scroll{overflow-y:auto;flex:1;}
.notif-item{display:flex;gap:10px;padding:11px 14px;border-bottom:1px solid rgba(255,255,255,0.04);cursor:pointer;}
.notif-item:hover{background:rgba(255,255,255,0.03);}
.notif-item.unread{background:rgba(201,168,76,0.03);}
.notif-icon{font-size:18px;flex-shrink:0;margin-top:1px;}
.notif-body{flex:1;min-width:0;}
.notif-title{font-size:12px;font-weight:700;margin-bottom:2px;}
.notif-msg{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);line-height:1.5;}
.notif-time{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:3px;}
.notif-dot{width:7px;height:7px;border-radius:50%;background:var(--gold);flex-shrink:0;margin-top:4px;}
/* HEADER */
.hdr{padding:18px 0 14px;text-align:center;}
.hdr-eyebrow{display:inline-flex;align-items:center;gap:8px;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:4px;color:var(--gold);text-transform:uppercase;border:1px solid rgba(201,168,76,0.25);border-radius:100px;padding:5px 16px;margin-bottom:12px;background:rgba(201,168,76,0.06);}
.hdr-eyebrow-dot{width:5px;height:5px;border-radius:50%;background:var(--gold);animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
.hdr-logo{font-family:'Bebas Neue',sans-serif;font-size:clamp(50px,15vw,74px);letter-spacing:8px;line-height:0.9;display:block;background:linear-gradient(160deg,#fff 0%,var(--gold2) 30%,var(--gold) 55%,#8b6520 80%,var(--gold) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hdr-tagline{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:5px;color:var(--muted);text-transform:uppercase;margin-top:8px;}
.hdr-rule{display:flex;align-items:center;margin:12px auto 0;width:160px;}
.hdr-rule-line{flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,0.5),transparent);}
.hdr-rule-gem{width:6px;height:6px;background:var(--gold);transform:rotate(45deg);}
/* COIN BAR */
.coin-bar{display:flex;align-items:center;justify-content:space-between;background:var(--glass);border:1px solid var(--rim);border-radius:16px;padding:11px 16px;margin-bottom:12px;}
.coin-bar-left{display:flex;align-items:center;gap:10px;}
.coin-icon{width:34px;height:34px;border-radius:50%;background:conic-gradient(var(--gold) 0deg,var(--gold2) 90deg,var(--gold) 180deg,#7a5010 270deg,var(--gold) 360deg);display:flex;align-items:center;justify-content:center;position:relative;}
.coin-icon::before{content:'';position:absolute;inset:3px;border-radius:50%;background:var(--deep);}
.coin-icon span{position:relative;z-index:1;font-size:12px;}
.coin-lbl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--muted);}
.coin-val{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.coin-bar-right{display:flex;gap:6px;align-items:center;}
.btn-topup-quick{padding:8px 13px;border:1px solid rgba(201,168,76,0.3);border-radius:10px;background:rgba(201,168,76,0.08);color:var(--gold);font-family:'Syne',sans-serif;font-size:11px;font-weight:700;cursor:pointer;}
.btn-pwa{padding:7px 11px;border:1px solid rgba(0,229,200,0.3);border-radius:10px;background:rgba(0,229,200,0.06);color:var(--teal);font-family:'Syne',sans-serif;font-size:10px;font-weight:700;cursor:pointer;display:none;align-items:center;gap:4px;}
/* TABS */
.tabs-wrap{overflow-x:auto;-webkit-overflow-scrolling:touch;margin-bottom:12px;}
.tabs-wrap::-webkit-scrollbar{height:2px;}
.tabs-wrap::-webkit-scrollbar-thumb{background:rgba(201,168,76,0.3);border-radius:2px;}
.tabs{display:flex;gap:2px;padding:4px;background:var(--glass);border:1px solid var(--rim);border-radius:18px;position:relative;min-width:max-content;}
.tab-slider{position:absolute;top:4px;height:calc(100% - 8px);border-radius:14px;background:linear-gradient(135deg,rgba(201,168,76,0.15),rgba(201,168,76,0.05));border:1px solid rgba(201,168,76,0.3);transition:all 0.4s cubic-bezier(0.4,0,0.2,1);z-index:0;}
.tab-btn{padding:10px 11px;border:none;background:none;color:var(--muted);font-family:'Syne',sans-serif;font-size:8px;font-weight:700;letter-spacing:0.8px;text-transform:uppercase;cursor:pointer;border-radius:14px;transition:color 0.3s;position:relative;z-index:1;display:flex;align-items:center;gap:3px;white-space:nowrap;}
.tab-btn.active{color:var(--gold2);}
.tab-btn .ti{font-size:11px;}
.panel{display:none;animation:fadeUp 0.4s ease both;}.panel.active{display:block;}
/* CARD */
.card{background:linear-gradient(145deg,rgba(255,255,255,0.04),rgba(255,255,255,0.01));border:1px solid var(--rim);border-radius:22px;padding:20px;position:relative;overflow:hidden;margin-bottom:12px;}
.card::before{content:'';position:absolute;top:0;left:15%;right:15%;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,0.7),transparent);}
.card-glow{position:absolute;top:-60px;right:-60px;width:200px;height:200px;background:radial-gradient(circle,rgba(201,168,76,0.04) 0%,transparent 70%);pointer-events:none;}
.ctitle{display:flex;align-items:center;gap:10px;margin-bottom:16px;}
.ctitle-icon{width:36px;height:36px;border-radius:11px;background:linear-gradient(135deg,rgba(201,168,76,0.15),rgba(201,168,76,0.05));border:1px solid rgba(201,168,76,0.25);display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;}
.ctitle-text{font-size:12px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;}
.ctitle-sub{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:1px;}
.infobox{background:rgba(0,229,200,0.05);border:1px solid rgba(0,229,200,0.15);border-radius:11px;padding:11px 14px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:11px;color:rgba(0,229,200,0.7);line-height:1.7;}
.infobox a{color:var(--teal);text-decoration:none;border-bottom:1px solid rgba(0,229,200,0.3);}
.field{margin-bottom:13px;}
.flabel{display:flex;align-items:center;gap:6px;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2.5px;color:var(--muted);text-transform:uppercase;margin-bottom:6px;}
.flabel-gem{width:4px;height:4px;background:var(--gold);border-radius:50%;}
.finput{width:100%;background:rgba(255,255,255,0.025);border:1px solid var(--rim);border-radius:11px;padding:11px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;transition:all 0.25s;outline:none;-webkit-appearance:none;}
.finput::placeholder{color:var(--muted);}
.finput:focus{border-color:rgba(201,168,76,0.5);box-shadow:0 0 0 3px rgba(201,168,76,0.07);}
select.finput{cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%234a6080'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 13px center;padding-right:34px;}
select.finput option{background:#0b1525;color:var(--text);}
textarea.finput{resize:vertical;min-height:80px;line-height:1.6;}
.div{height:1px;background:linear-gradient(90deg,transparent,var(--rim),transparent);margin:14px 0;}
/* DROPZONE */
.dz{position:relative;border:1.5px dashed rgba(255,255,255,0.08);border-radius:16px;padding:22px 18px;text-align:center;cursor:pointer;transition:all 0.3s;background:rgba(255,255,255,0.01);}
.dz:hover,.dz.over{border-color:rgba(201,168,76,0.4);background:rgba(201,168,76,0.02);}
.dz input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.dz-orb{width:50px;height:50px;margin:0 auto 10px;border-radius:14px;background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);display:flex;align-items:center;justify-content:center;font-size:22px;transition:all 0.3s;}
.dz:hover .dz-orb{transform:translateY(-4px) scale(1.05);}
.dz-title{font-size:13px;font-weight:700;margin-bottom:3px;}
.dz-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.dz-formats{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;margin-top:8px;}
.dz-fmt{font-family:'DM Mono',monospace;font-size:9px;background:rgba(255,255,255,0.04);border:1px solid var(--rim);border-radius:4px;padding:2px 7px;color:var(--muted);}
.dz-fmt.img{border-color:rgba(0,229,200,0.2);color:rgba(0,229,200,0.6);}
.dz-fmt.audio{border-color:rgba(201,168,76,0.2);color:rgba(201,168,76,0.6);}
.dz-fmt.mesh{border-color:rgba(139,92,246,0.2);color:rgba(139,92,246,0.6);}
.fchip{display:none;align-items:center;gap:9px;background:rgba(0,229,160,0.06);border:1px solid rgba(0,229,160,0.2);border-radius:13px;padding:10px 13px;margin-top:9px;}
.fchip.show{display:flex;animation:chipIn 0.3s ease;}
@keyframes chipIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.fchip-ico{width:34px;height:34px;background:rgba(0,229,160,0.1);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.fchip-info{flex:1;min-width:0;}
.fchip-name{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.fchip-size{font-family:'DM Mono',monospace;font-size:10px;color:var(--green);}
.fchip-rm{width:28px;height:28px;background:var(--red-dim);border:1px solid rgba(255,68,102,0.2);border-radius:7px;color:var(--red);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0;}
.rbxm-notice{display:none;background:rgba(255,68,102,0.07);border:1px solid rgba(255,68,102,0.2);border-radius:11px;padding:11px 14px;margin-top:8px;font-family:'DM Mono',monospace;font-size:11px;color:rgba(255,68,102,0.8);line-height:1.7;}
.rbxm-notice.show{display:block;}
.cost-preview{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:11px;padding:10px 14px;margin-bottom:12px;}
.cost-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.cost-val{font-size:14px;font-weight:700;color:var(--gold);}
.btn-up,.btn-bulk-go{width:100%;padding:14px;border:none;border-radius:15px;background:linear-gradient(100deg,#8b6520 0%,var(--gold) 25%,var(--gold2) 50%,var(--gold) 75%,#8b6520 100%);background-size:300% 100%;color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:4px;cursor:pointer;position:relative;overflow:hidden;transition:all 0.4s;box-shadow:0 4px 28px rgba(201,168,76,0.25);}
.btn-up:hover:not(:disabled),.btn-bulk-go:hover:not(:disabled){background-position:100% 0;transform:translateY(-2px);}
.btn-up:disabled,.btn-bulk-go:disabled{opacity:0.35;cursor:not-allowed;}
.shim{position:absolute;top:0;left:-100%;width:40%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);transform:skewX(-20deg);animation:shim 3.5s infinite;}
@keyframes shim{0%{left:-100%}35%,100%{left:160%}}
.result{display:none;margin-top:12px;border-radius:16px;overflow:hidden;}
.result.show{display:block;animation:fadeUp 0.4s ease;}
.result.ok{border:1px solid rgba(0,229,160,0.2);background:rgba(0,229,160,0.03);}
.result.fail{border:1px solid rgba(255,68,102,0.2);background:rgba(255,68,102,0.03);}
.result-hdr{padding:10px 16px;font-size:10px;font-weight:700;letter-spacing:2.5px;text-transform:uppercase;}
.result.ok .result-hdr{color:var(--green);border-bottom:1px solid rgba(0,229,160,0.12);}
.result.fail .result-hdr{color:var(--red);border-bottom:1px solid rgba(255,68,102,0.12);}
.result-body{padding:12px 16px;}
.rrow{display:flex;justify-content:space-between;align-items:center;padding:7px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.rrow:last-child{border-bottom:none;}
.rkey{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
.rval{font-family:'DM Mono',monospace;font-size:12px;color:var(--gold2);cursor:pointer;max-width:200px;word-break:break-all;text-align:right;}
.rval:hover{color:var(--teal);}
.badge-proc{font-family:'DM Mono',monospace;font-size:9px;background:rgba(245,158,11,0.12);border:1px solid rgba(245,158,11,0.25);color:#f59e0b;padding:3px 8px;border-radius:5px;animation:blink 1.5s infinite;}
.warnbox{margin-top:12px;background:rgba(245,158,11,0.04);border:1px solid rgba(245,158,11,0.15);border-radius:13px;padding:11px 14px;font-family:'DM Mono',monospace;font-size:11px;color:rgba(245,158,11,0.65);line-height:1.8;}
.warnbox-t{color:#f59e0b;font-weight:500;margin-bottom:3px;font-size:11px;}
/* BULK */
.bulk-drop{position:relative;border:1.5px dashed rgba(201,168,76,0.2);border-radius:16px;padding:18px;text-align:center;cursor:pointer;transition:all 0.3s;background:rgba(201,168,76,0.02);margin-bottom:12px;}
.bulk-drop input{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.bulk-drop:hover{border-color:rgba(201,168,76,0.4);}
.bulk-list{display:flex;flex-direction:column;gap:7px;margin-bottom:12px;max-height:220px;overflow-y:auto;}
.bulk-list::-webkit-scrollbar{width:3px;}
.bulk-list::-webkit-scrollbar-thumb{background:rgba(201,168,76,0.3);border-radius:3px;}
.bulk-item{display:flex;align-items:center;gap:9px;background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:11px;padding:10px 12px;transition:all 0.25s;}
.bulk-item-info{flex:1;min-width:0;}
.bulk-name{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.bulk-meta{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:1px;}
.bulk-status{font-size:15px;flex-shrink:0;width:22px;text-align:center;}
.bulk-rm{width:26px;height:26px;background:var(--red-dim);border:1px solid rgba(255,68,102,0.2);border-radius:6px;color:var(--red);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;}
.bulk-cost{background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.2);border-radius:11px;padding:10px 13px;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
/* HISTORY */
.hist-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px;}
.stat-box{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:13px;padding:12px;text-align:center;}
.stat-num{font-family:'Bebas Neue',sans-serif;font-size:26px;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.stat-lbl{font-family:'DM Mono',monospace;font-size:8px;letter-spacing:1.5px;color:var(--muted);margin-top:2px;}
.hist-item{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;margin-bottom:9px;}
.hist-item:hover{border-color:rgba(201,168,76,0.2);}
.hist-item-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:5px;}
.hist-name{font-size:13px;font-weight:700;}
.hist-time{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.hist-id{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);margin-bottom:6px;cursor:pointer;}
.hist-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:7px;}
.hist-tag{font-family:'DM Mono',monospace;font-size:9px;background:rgba(255,255,255,0.04);border:1px solid var(--rim);border-radius:4px;padding:2px 7px;color:var(--muted2);}
.hist-rating{display:flex;align-items:center;gap:5px;}
.star{font-size:14px;cursor:pointer;color:rgba(255,255,255,0.12);transition:all 0.15s;}
.star.active{color:var(--gold);}
.star:hover{color:var(--gold2);transform:scale(1.2);}
.hist-empty{text-align:center;padding:36px 20px;color:var(--muted);}
.hist-empty-ico{font-size:38px;opacity:0.3;margin-bottom:10px;}
.hist-empty-t{font-family:'DM Mono',monospace;font-size:11px;line-height:1.7;}
/* DASHBOARD */
.dash-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px;}
.dash-stat{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;position:relative;overflow:hidden;}
.dash-stat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.dash-stat.s1::before{background:linear-gradient(90deg,var(--gold),transparent);}
.dash-stat.s2::before{background:linear-gradient(90deg,var(--teal),transparent);}
.dash-stat.s3::before{background:linear-gradient(90deg,var(--gold2),transparent);}
.dash-stat.s4::before{background:linear-gradient(90deg,var(--purple),transparent);}
.dash-stat-num{font-family:'Bebas Neue',sans-serif;font-size:32px;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.dash-stat-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px;}
.chart-wrap{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:16px;margin-bottom:11px;}
.chart-title{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:12px;}
.bar-chart{display:flex;align-items:flex-end;gap:5px;height:70px;}
.bar-col{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;height:100%;}
.bar-wrap{flex:1;width:100%;display:flex;align-items:flex-end;}
.bar-fill{width:100%;background:linear-gradient(180deg,var(--gold2),var(--gold));border-radius:3px 3px 0 0;min-height:2px;position:relative;transition:height 0.6s ease;}
.bar-val{position:absolute;top:-15px;left:50%;transform:translateX(-50%);font-family:'DM Mono',monospace;font-size:9px;color:var(--gold2);white-space:nowrap;}
.bar-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);}
.type-breakdown{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;}
.type-breakdown-title{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:9px;}
.type-row{display:flex;align-items:center;gap:9px;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.04);}
.type-row:last-child{border-bottom:none;}
.type-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.type-name{flex:1;font-size:12px;font-weight:600;}
.type-count{font-family:'Bebas Neue',sans-serif;font-size:19px;color:var(--gold2);}
/* LEADERBOARD */
.leader-row{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;margin-bottom:8px;}
.leader-row.me{border-color:rgba(201,168,76,0.4);background:rgba(201,168,76,0.04);}
.leader-rank{width:28px;text-align:center;font-size:18px;flex-shrink:0;}
.leader-avatar{width:36px;height:36px;border-radius:50%;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.2);display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0;}
.leader-info{flex:1;min-width:0;}
.leader-name{font-size:13px;font-weight:700;display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.leader-sub{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:1px;}
.leader-uploads{text-align:right;flex-shrink:0;}
.leader-num{font-family:'Bebas Neue',sans-serif;font-size:24px;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.leader-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);}
.badge-me{background:rgba(0,229,200,0.12);border:1px solid rgba(0,229,200,0.3);color:var(--teal);font-family:'DM Mono',monospace;font-size:8px;padding:2px 6px;border-radius:4px;}
/* REFERRAL */
.ref-card{background:linear-gradient(135deg,rgba(201,168,76,0.08),rgba(201,168,76,0.02));border:1px solid rgba(201,168,76,0.25);border-radius:17px;padding:18px;margin-bottom:12px;}
.ref-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;color:var(--gold2);margin-bottom:4px;}
.ref-desc{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);line-height:1.6;margin-bottom:13px;}
.ref-code-box{background:rgba(0,0,0,0.3);border:1px solid rgba(201,168,76,0.3);border-radius:11px;padding:11px 14px;display:flex;justify-content:space-between;align-items:center;margin-bottom:9px;}
.ref-code{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:4px;color:var(--gold2);}
.ref-copy{padding:6px 12px;border:1px solid rgba(201,168,76,0.3);border-radius:8px;background:rgba(201,168,76,0.1);color:var(--gold);font-family:'DM Mono',monospace;font-size:10px;cursor:pointer;}
.ref-link-box{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:9px;padding:9px 13px;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);word-break:break-all;margin-bottom:9px;cursor:pointer;}
.ref-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;}
.ref-stat{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:11px;padding:11px;text-align:center;}
.ref-stat-num{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--gold2);}
.ref-stat-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.btn-share-wa{width:100%;padding:11px;border:none;border-radius:11px;background:linear-gradient(135deg,rgba(37,211,102,0.15),rgba(18,140,126,0.08));border:1px solid rgba(37,211,102,0.3);color:#25d366;font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;}
/* PROMO */
.promo-box{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:14px;margin-bottom:12px;}
.promo-input-row{display:flex;gap:7px;}
.btn-apply-promo{padding:11px 14px;border:none;border-radius:11px;background:rgba(167,139,250,0.15);border:1px solid rgba(167,139,250,0.3);color:var(--purple);font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;white-space:nowrap;}
/* TICKET */
.ticket-row{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;margin-bottom:9px;}
.ticket-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:7px;}
.ticket-subject{font-size:12px;font-weight:700;}
.ticket-meta{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px;}
.ticket-status{font-family:'DM Mono',monospace;font-size:9px;padding:3px 8px;border-radius:6px;white-space:nowrap;}
.ticket-status.open{background:rgba(245,158,11,0.12);border:1px solid rgba(245,158,11,0.25);color:#f59e0b;}
.ticket-status.replied{background:rgba(0,229,200,0.1);border:1px solid rgba(0,229,200,0.25);color:var(--teal);}
.ticket-status.closed{background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.25);color:var(--green);}
.ticket-msg{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2);line-height:1.7;margin-bottom:6px;}
.ticket-reply{background:rgba(0,229,200,0.05);border:1px solid rgba(0,229,200,0.15);border-radius:9px;padding:9px 13px;font-family:'DM Mono',monospace;font-size:11px;color:rgba(0,229,200,0.8);line-height:1.6;}
.ticket-reply-label{color:var(--gold);font-weight:600;}
.btn-ticket{width:100%;padding:13px;border:none;border-radius:13px;background:rgba(0,229,200,0.08);border:1px solid rgba(0,229,200,0.2);color:var(--teal);font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;cursor:pointer;margin-bottom:12px;}
.btn-ticket:disabled{opacity:0.4;cursor:not-allowed;}
/* SETTINGS */
.settings-profile{background:linear-gradient(135deg,rgba(201,168,76,0.06),rgba(201,168,76,0.02));border:1px solid rgba(201,168,76,0.2);border-radius:16px;padding:16px;margin-bottom:16px;display:flex;align-items:center;gap:13px;}
.settings-avatar-wrap{position:relative;cursor:pointer;}
.settings-avatar{width:50px;height:50px;border-radius:50%;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.3);display:flex;align-items:center;justify-content:center;font-size:26px;}
.settings-avatar-edit{position:absolute;bottom:-2px;right:-2px;width:17px;height:17px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;color:#07050a;}
.settings-name{font-size:15px;font-weight:800;margin-bottom:2px;}
.settings-email{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.settings-coins{font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:1px;color:var(--gold);margin-top:3px;}
.settings-section{margin-bottom:16px;}
.settings-section-title{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px;}
.settings-section-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(201,168,76,0.3),transparent);}
.toggle-row{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:11px;padding:11px 13px;margin-bottom:8px;}
.toggle-label{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted2);}
.toggle-label span{display:block;font-size:9px;color:var(--muted);margin-top:1px;}
.toggle{position:relative;width:44px;height:24px;flex-shrink:0;}
.toggle input{opacity:0;width:0;height:0;}
.toggle-slider{position:absolute;inset:0;background:rgba(255,255,255,0.08);border:1px solid var(--rim);border-radius:100px;cursor:pointer;transition:0.3s;}
.toggle-slider::before{content:'';position:absolute;width:18px;height:18px;left:2px;top:2px;background:var(--muted);border-radius:50%;transition:0.3s;}
.toggle input:checked+.toggle-slider{background:rgba(201,168,76,0.2);border-color:rgba(201,168,76,0.4);}
.toggle input:checked+.toggle-slider::before{transform:translateX(20px);background:var(--gold);}
.btn-save-settings{width:100%;padding:13px;border:none;border-radius:13px;background:linear-gradient(100deg,#8b6520,var(--gold),var(--gold2),var(--gold),#8b6520);background-size:300% 100%;color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;cursor:pointer;position:relative;overflow:hidden;transition:all 0.4s;margin-bottom:8px;}
.btn-save-settings:hover{background-position:100% 0;}
.btn-clear-settings{width:100%;padding:11px;border:1px solid rgba(255,68,102,0.2);border-radius:11px;background:rgba(255,68,102,0.05);color:var(--red);font-family:'Syne',sans-serif;font-size:12px;font-weight:700;cursor:pointer;}
.save-note{background:rgba(0,229,160,0.05);border:1px solid rgba(0,229,160,0.15);border-radius:9px;padding:10px 13px;font-family:'DM Mono',monospace;font-size:10px;color:rgba(0,229,160,0.6);line-height:1.7;margin-bottom:10px;}
.wa-note{background:rgba(37,211,102,0.05);border:1px solid rgba(37,211,102,0.2);border-radius:9px;padding:10px 13px;font-family:'DM Mono',monospace;font-size:10px;color:rgba(37,211,102,0.7);line-height:1.7;margin-bottom:9px;}
.btn-save-wa{width:100%;padding:11px;border:none;border-radius:11px;background:rgba(37,211,102,0.1);border:1px solid rgba(37,211,102,0.3);color:#25d366;font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;}
/* TOPUP */
.topup-hero{text-align:center;padding:14px 0 10px;}
.topup-ring{width:88px;height:88px;border-radius:50%;background:conic-gradient(var(--gold) 0deg,var(--gold2) 60deg,var(--gold) 120deg,#6a4010 180deg,var(--gold) 240deg,var(--gold2) 300deg,var(--gold) 360deg);display:flex;align-items:center;justify-content:center;box-shadow:0 0 40px rgba(201,168,76,0.3);margin:0 auto 10px;position:relative;animation:ringPulse 3s ease-in-out infinite;}
@keyframes ringPulse{0%,100%{box-shadow:0 0 40px rgba(201,168,76,0.3)}50%{box-shadow:0 0 60px rgba(201,168,76,0.5)}}
.topup-ring::before{content:'';position:absolute;inset:8px;border-radius:50%;background:var(--deep);z-index:0;}
.topup-ring-inner{position:relative;z-index:1;text-align:center;}
.topup-ring-num{font-family:'Bebas Neue',sans-serif;font-size:24px;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.topup-ring-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);}
.topup-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;color:var(--gold2);margin-bottom:3px;}
.topup-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.pkg-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:11px 0;}
.pkg{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;text-align:center;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden;}
.pkg:hover{border-color:rgba(201,168,76,0.4);transform:translateY(-2px);}
.pkg.hot{border-color:rgba(201,168,76,0.3);}
.pkg.hot::after{content:'POPULER';position:absolute;top:0;right:0;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07050a;font-family:'DM Mono',monospace;font-size:8px;font-weight:700;padding:4px 9px;border-radius:0 13px 0 9px;}
.pkg-coins{font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1;}
.pkg-coins-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-bottom:5px;}
.pkg-price{font-size:13px;font-weight:700;}
.pkg-price-note{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px;}
.pkg-bonus{font-family:'DM Mono',monospace;font-size:9px;color:var(--green);margin-top:2px;}
/* MODAL */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:200;display:none;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(8px);overflow-y:auto;}
.modal-bg.show{display:flex;animation:fadeIn 0.3s ease;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal{background:linear-gradient(145deg,#0e1828,#080f1a);border:1px solid rgba(201,168,76,0.25);border-radius:22px;padding:24px;width:100%;max-width:400px;position:relative;animation:modalIn 0.4s cubic-bezier(0.22,1,0.36,1);margin:auto;}
@keyframes modalIn{from{opacity:0;transform:translateY(30px)scale(0.95)}to{opacity:1;transform:none}}
.modal::before{content:'';position:absolute;top:0;left:20%;right:20%;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,0.8),transparent);}
.modal-close{position:absolute;top:13px;right:13px;width:30px;height:30px;background:rgba(255,255,255,0.05);border:1px solid var(--rim);border-radius:8px;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;}
.modal-title{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:3px;color:var(--gold2);margin-bottom:4px;}
.modal-sub{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);margin-bottom:16px;line-height:1.6;}
.modal-order{background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.2);border-radius:11px;padding:11px 14px;margin-bottom:14px;display:flex;justify-content:space-between;align-items:center;}
.modal-order-left .label,.modal-order-right .label{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.modal-order-left .val,.modal-order-right .val{font-size:17px;font-weight:800;color:var(--gold2);}
.modal-order-right{text-align:right;}
.bank-cards{display:flex;flex-direction:column;gap:7px;margin-bottom:13px;}
.bank-card{background:rgba(255,255,255,0.025);border:1px solid var(--rim);border-radius:11px;padding:11px;display:flex;align-items:center;gap:9px;cursor:pointer;transition:all 0.25s;}
.bank-card:hover,.bank-card.selected{border-color:rgba(201,168,76,0.4);background:rgba(201,168,76,0.04);}
.bank-logo{width:38px;height:22px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;}
.bank-logo.bca{background:#005baa;color:#fff;}
.bank-logo.dana{background:#118eea;color:#fff;}
.bank-logo.ovo{background:#4c3494;color:#fff;}
.bank-info{flex:1;}
.bank-name{font-size:12px;font-weight:700;}
.bank-num{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-top:1px;}
.bank-holder{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);margin-top:1px;}
.bank-radio{width:15px;height:15px;border-radius:50%;border:2px solid var(--rim2);transition:all 0.2s;flex-shrink:0;}
.bank-card.selected .bank-radio{border-color:var(--gold);background:var(--gold);}
.modal-note{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:9px;padding:9px 13px;margin-bottom:13px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);line-height:1.7;}
.btn-confirm{width:100%;padding:13px;border:none;border-radius:12px;background:linear-gradient(100deg,#8b6520,var(--gold),var(--gold2),var(--gold),#8b6520);background-size:300% 100%;color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;cursor:pointer;position:relative;overflow:hidden;transition:all 0.4s;}
.btn-confirm:hover{background-position:100% 0;}
.success-modal{text-align:center;padding:8px 0;}
.success-icon{width:58px;height:58px;border-radius:50%;background:rgba(0,229,160,0.1);border:2px solid rgba(0,229,160,0.3);display:flex;align-items:center;justify-content:center;font-size:24px;margin:0 auto 13px;animation:successPop 0.5s cubic-bezier(0.22,1,0.36,1);}
@keyframes successPop{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}
.success-title{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:3px;color:var(--green);margin-bottom:7px;}
.success-text{font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);line-height:1.7;margin-bottom:11px;}
.order-id{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);border-radius:7px;padding:7px 13px;margin:0 auto 11px;display:inline-block;cursor:pointer;}
/* AVATAR MODAL */
.avatar-modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:300;display:none;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(8px);}
.avatar-modal.show{display:flex;animation:fadeIn 0.3s ease;}
.avatar-box{background:linear-gradient(145deg,#0e1828,#080f1a);border:1px solid rgba(201,168,76,0.25);border-radius:22px;padding:24px;width:100%;max-width:320px;position:relative;}
.avatar-box::before{content:'';position:absolute;top:0;left:20%;right:20%;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,0.8),transparent);}
.avatar-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;color:var(--gold2);margin-bottom:3px;}
.avatar-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:16px;}
.avatar-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.avatar-opt{width:100%;aspect-ratio:1;border-radius:13px;background:rgba(255,255,255,0.03);border:1px solid var(--rim);display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;transition:all 0.2s;}
.avatar-opt:hover{background:rgba(201,168,76,0.08);border-color:rgba(201,168,76,0.3);transform:scale(1.05);}
.avatar-opt.selected{background:rgba(201,168,76,0.12);border-color:rgba(201,168,76,0.5);}
.avatar-close{position:absolute;top:13px;right:13px;width:28px;height:28px;background:rgba(255,255,255,0.05);border:1px solid var(--rim);border-radius:7px;color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;}
/* ADMIN */
.admin-wrap{position:relative;z-index:2;max-width:700px;margin:0 auto;padding:16px 16px 60px;}
.admin-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;padding-top:14px;}
.admin-title{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:5px;background:linear-gradient(135deg,#fff,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.admin-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:18px;}
.admin-stat{background:var(--glass);border:1px solid var(--rim);border-radius:15px;padding:14px;position:relative;overflow:hidden;}
.admin-stat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.admin-stat.u::before{background:linear-gradient(90deg,var(--teal),transparent);}
.admin-stat.o::before{background:linear-gradient(90deg,var(--gold),transparent);}
.admin-stat.up::before{background:linear-gradient(90deg,var(--green),transparent);}
.admin-stat.p::before{background:linear-gradient(90deg,var(--red),transparent);}
.admin-stat.r::before{background:linear-gradient(90deg,var(--purple),transparent);}
.admin-stat.t::before{background:linear-gradient(90deg,var(--teal),transparent);}
.admin-stat-num{font-family:'Bebas Neue',sans-serif;font-size:26px;line-height:1;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.admin-stat-lbl{font-family:'DM Mono',monospace;font-size:8px;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;margin-top:2px;}
.admin-section{margin-bottom:18px;}
.admin-section-title{font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;color:var(--gold2);margin-bottom:10px;display:flex;align-items:center;gap:8px;}
.admin-section-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(201,168,76,0.3),transparent);}
.admin-user-card{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:15px;padding:13px;margin-bottom:8px;}
.admin-user-card.banned{border-color:rgba(255,68,102,0.3);background:rgba(255,68,102,0.02);}
.admin-user-top{display:flex;align-items:center;gap:10px;margin-bottom:9px;}
.admin-user-avatar{width:36px;height:36px;border-radius:50%;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.2);display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0;}
.admin-user-info{flex:1;}
.admin-user-name{font-size:13px;font-weight:700;display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.admin-user-email{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:1px;}
.admin-user-coins{text-align:right;flex-shrink:0;}
.coins-display{font-family:'Bebas Neue',sans-serif;font-size:19px;background:linear-gradient(135deg,var(--gold2),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.admin-user-actions{display:flex;gap:5px;align-items:center;flex-wrap:wrap;}
.btn-add-coin,.btn-sub-coin,.btn-set-coin{padding:7px 9px;border:none;border-radius:7px;font-family:'Syne',sans-serif;font-size:10px;font-weight:700;cursor:pointer;white-space:nowrap;}
.btn-add-coin{background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.3);color:var(--green);}
.btn-sub-coin{background:rgba(255,68,102,0.1);border:1px solid rgba(255,68,102,0.3);color:var(--red);}
.btn-set-coin{background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.3);color:var(--gold);}
.badge-admin{background:rgba(201,168,76,0.15);border:1px solid rgba(201,168,76,0.3);color:var(--gold);font-family:'DM Mono',monospace;font-size:7px;padding:2px 6px;border-radius:4px;}
.badge-banned{background:rgba(255,68,102,0.15);border:1px solid rgba(255,68,102,0.3);color:var(--red);font-family:'DM Mono',monospace;font-size:7px;padding:2px 6px;border-radius:4px;}
.admin-order-card{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:13px;padding:13px;margin-bottom:8px;}
.admin-order-card.pending{border-color:rgba(245,158,11,0.2);}
.admin-order-card.confirmed{border-color:rgba(0,229,160,0.15);}
.admin-order-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;}
.admin-order-id{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);font-weight:600;}
.admin-order-user{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px;}
.admin-order-status{font-family:'DM Mono',monospace;font-size:9px;padding:3px 8px;border-radius:6px;white-space:nowrap;}
.admin-order-status.pending{background:rgba(245,158,11,0.12);border:1px solid rgba(245,158,11,0.25);color:#f59e0b;}
.admin-order-status.confirmed{background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.25);color:var(--green);}
.admin-order-detail{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);line-height:1.6;margin-bottom:7px;}
.btn-confirm-order{width:100%;padding:9px;border:none;border-radius:9px;background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.3);color:var(--green);font-family:'Syne',sans-serif;font-size:11px;font-weight:700;cursor:pointer;}
.admin-refresh{width:100%;padding:10px;border:1px solid rgba(201,168,76,0.3);border-radius:11px;background:rgba(201,168,76,0.06);color:var(--gold);font-family:'Syne',sans-serif;font-size:12px;font-weight:700;cursor:pointer;margin-bottom:16px;}
.broadcast-box{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:14px;margin-bottom:12px;}
.btn-broadcast{width:100%;padding:12px;border:none;border-radius:11px;background:rgba(167,139,250,0.12);border:1px solid rgba(167,139,250,0.3);color:var(--purple);font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;margin-top:9px;}
.btn-broadcast:disabled{opacity:0.4;cursor:not-allowed;}
#adminLoading{text-align:center;padding:50px;font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);}
.spinner{display:inline-block;width:14px;height:14px;border:2px solid rgba(0,0,0,0.2);border-top-color:rgba(0,0,0,0.7);border-radius:50%;animation:spin 0.6s linear infinite;vertical-align:middle;margin-right:6px;}
.spinner-light{border-color:rgba(201,168,76,0.2);border-top-color:var(--gold);}
@keyframes spin{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:26px;left:50%;transform:translateX(-50%)translateY(20px);background:rgba(8,14,24,0.96);border:1px solid rgba(201,168,76,0.2);border-radius:100px;padding:10px 22px;font-family:'DM Mono',monospace;font-size:12px;color:var(--text);z-index:500;opacity:0;transition:all 0.35s cubic-bezier(0.22,1,0.36,1);backdrop-filter:blur(20px);white-space:nowrap;max-width:90vw;text-align:center;}
.toast.show{opacity:1;transform:translateX(-50%)translateY(0);}
.footer{text-align:center;padding-top:36px;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;line-height:2;}
.footer-gem{color:var(--gold);}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:none}}

/* â”€â”€ LIVE CHAT â”€â”€ */
.chat-fab{position:fixed;bottom:24px;right:20px;z-index:150;width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,var(--teal),#008a7a);border:none;cursor:pointer;display:none;align-items:center;justify-content:center;font-size:22px;box-shadow:0 4px 20px rgba(0,229,200,0.4);transition:all 0.3s;}
.chat-fab:hover{transform:scale(1.1);}
.chat-fab-badge{position:absolute;top:-3px;right:-3px;min-width:18px;height:18px;border-radius:9px;background:var(--red);color:#fff;font-family:'DM Mono',monospace;font-size:9px;display:none;align-items:center;justify-content:center;padding:0 3px;}
.chat-window{position:fixed;bottom:88px;right:16px;width:320px;max-width:calc(100vw - 32px);height:460px;background:linear-gradient(145deg,#0d1a2e,#06101c);border:1px solid rgba(0,229,200,0.2);border-radius:20px;z-index:150;display:none;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,0.7);overflow:hidden;}
.chat-window.open{display:flex;animation:fadeUp 0.3s ease;}
.chat-hdr{padding:14px 16px;border-bottom:1px solid rgba(0,229,200,0.1);display:flex;align-items:center;gap:10px;background:rgba(0,229,200,0.04);}
.chat-hdr-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,rgba(0,229,200,0.3),rgba(0,229,200,0.1));display:flex;align-items:center;justify-content:center;font-size:16px;}
.chat-hdr-info{flex:1;}
.chat-hdr-name{font-size:12px;font-weight:700;color:var(--teal);}
.chat-hdr-status{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);display:flex;align-items:center;gap:4px;}
.chat-online-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:blink 2s infinite;}
.chat-close{width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,0.05);border:1px solid var(--rim);color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:12px;}
.chat-messages{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:8px;}
.chat-messages::-webkit-scrollbar{width:3px;}
.chat-messages::-webkit-scrollbar-thumb{background:rgba(0,229,200,0.2);border-radius:3px;}
.chat-msg{display:flex;gap:8px;max-width:85%;}
.chat-msg.mine{align-self:flex-end;flex-direction:row-reverse;}
.chat-msg-avatar{width:26px;height:26px;border-radius:50%;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.2);display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;align-self:flex-end;}
.chat-msg.mine .chat-msg-avatar{background:rgba(0,229,200,0.1);border-color:rgba(0,229,200,0.2);}
.chat-msg-body{background:rgba(255,255,255,0.05);border:1px solid var(--rim);border-radius:14px 14px 14px 4px;padding:9px 12px;}
.chat-msg.mine .chat-msg-body{background:rgba(0,229,200,0.1);border-color:rgba(0,229,200,0.2);border-radius:14px 14px 4px 14px;}
.chat-msg-text{font-family:'DM Mono',monospace;font-size:11px;color:var(--text);line-height:1.5;}
.chat-msg-time{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-top:3px;}
.chat-msg-sender{font-family:'DM Mono',monospace;font-size:8px;color:var(--gold);margin-bottom:2px;}
.chat-typing{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);padding:4px 8px;display:none;}
.chat-typing.show{display:block;}
.chat-input-row{padding:10px 12px;border-top:1px solid rgba(0,229,200,0.1);display:flex;gap:8px;align-items:center;}
.chat-input{flex:1;background:rgba(255,255,255,0.04);border:1px solid var(--rim);border-radius:20px;padding:9px 14px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;outline:none;}
.chat-input:focus{border-color:rgba(0,229,200,0.4);}
.chat-input::placeholder{color:var(--muted);}
.chat-send{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--teal),#008a7a);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;transition:all 0.2s;}
.chat-send:hover{transform:scale(1.1);}
.chat-empty{text-align:center;padding:30px 16px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);line-height:1.7;}

/* â”€â”€ ADMIN CHAT â”€â”€ */
.admin-chat-list{display:flex;flex-direction:column;gap:8px;}
.admin-chat-item{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:13px;cursor:pointer;transition:all 0.2s;}
.admin-chat-item:hover,.admin-chat-item.active{border-color:rgba(0,229,200,0.3);background:rgba(0,229,200,0.03);}
.admin-chat-item-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;}
.admin-chat-user{font-size:12px;font-weight:700;}
.admin-chat-time{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.admin-chat-preview{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.admin-chat-unread{min-width:18px;height:18px;border-radius:9px;background:var(--teal);color:#07050a;font-family:'DM Mono',monospace;font-size:9px;display:inline-flex;align-items:center;justify-content:center;padding:0 5px;font-weight:700;}
.admin-chat-window{background:rgba(255,255,255,0.02);border:1px solid rgba(0,229,200,0.2);border-radius:16px;padding:14px;margin-top:10px;}
.admin-chat-msgs{height:240px;overflow-y:auto;display:flex;flex-direction:column;gap:7px;margin-bottom:10px;padding-right:4px;}
.admin-chat-msgs::-webkit-scrollbar{width:3px;}
.admin-chat-msgs::-webkit-scrollbar-thumb{background:rgba(0,229,200,0.2);border-radius:3px;}

/* â”€â”€ BADGES â”€â”€ */
.badge-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px;}
.badge-card{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:14px;text-align:center;transition:all 0.25s;}
.badge-card.earned{border-color:rgba(201,168,76,0.35);background:rgba(201,168,76,0.05);}
.badge-card.locked{opacity:0.4;}
.badge-icon{font-size:28px;margin-bottom:6px;display:block;}
.badge-name{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px;}
.badge-desc{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);line-height:1.4;}
.badge-earned-tag{font-family:'DM Mono',monospace;font-size:8px;background:rgba(201,168,76,0.15);border:1px solid rgba(201,168,76,0.3);color:var(--gold);padding:2px 7px;border-radius:4px;margin-top:5px;display:inline-block;}
.badge-locked-tag{font-family:'DM Mono',monospace;font-size:8px;background:rgba(255,255,255,0.04);border:1px solid var(--rim);color:var(--muted);padding:2px 7px;border-radius:4px;margin-top:5px;display:inline-block;}
.xp-bar-wrap{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:14px;margin-bottom:12px;}
.xp-bar-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.xp-level{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--gold2);letter-spacing:2px;}
.xp-label{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.xp-track{height:8px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold2));border-radius:4px;transition:width 0.8s ease;}
.xp-nums{display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:4px;}

/* â”€â”€ MISSIONS â”€â”€ */
.mission-tabs{display:flex;gap:4px;margin-bottom:12px;}
.mission-tab{flex:1;padding:8px;border:1px solid var(--rim);border-radius:10px;background:rgba(255,255,255,0.02);color:var(--muted);font-family:'Syne',sans-serif;font-size:10px;font-weight:700;cursor:pointer;text-align:center;transition:all 0.2s;}
.mission-tab.active{border-color:rgba(201,168,76,0.4);background:rgba(201,168,76,0.08);color:var(--gold2);}
.mission-item{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:13px;margin-bottom:8px;transition:all 0.25s;}
.mission-item.done{border-color:rgba(0,229,160,0.3);background:rgba(0,229,160,0.03);}
.mission-item.claimed{opacity:0.5;}
.mission-top{display:flex;align-items:center;gap:10px;margin-bottom:8px;}
.mission-icon{width:36px;height:36px;border-radius:10px;background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.2);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.mission-info{flex:1;}
.mission-name{font-size:12px;font-weight:700;margin-bottom:1px;}
.mission-desc{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.mission-reward{font-family:'DM Mono',monospace;font-size:10px;color:var(--gold);font-weight:600;}
.mission-progress-wrap{margin-bottom:6px;}
.mission-progress-track{height:6px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;}
.mission-progress-fill{height:100%;background:linear-gradient(90deg,var(--teal),var(--green));border-radius:3px;transition:width 0.6s ease;}
.mission-progress-nums{display:flex;justify-content:space-between;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:3px;}
.btn-claim{padding:8px 16px;border:none;border-radius:9px;background:linear-gradient(135deg,rgba(0,229,160,0.2),rgba(0,229,160,0.08));border:1px solid rgba(0,229,160,0.3);color:var(--green);font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;cursor:pointer;transition:all 0.2s;width:100%;}
.btn-claim:hover{background:rgba(0,229,160,0.2);}
.btn-claim:disabled{opacity:0.4;cursor:not-allowed;}
.mission-claimed-tag{text-align:center;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);padding:6px;}
.mission-reset{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);text-align:center;margin-bottom:12px;}
.mission-reset span{color:var(--teal);}

/* â”€â”€ MIDTRANS â”€â”€ */
.payment-method-tabs{display:flex;gap:4px;margin-bottom:12px;}
.payment-method-tab{flex:1;padding:8px;border:1px solid var(--rim);border-radius:10px;background:rgba(255,255,255,0.02);color:var(--muted);font-family:'Syne',sans-serif;font-size:9px;font-weight:700;cursor:pointer;text-align:center;transition:all 0.2s;letter-spacing:0.5px;}
.payment-method-tab.active{border-color:rgba(0,229,200,0.4);background:rgba(0,229,200,0.08);color:var(--teal);}
.midtrans-box{background:rgba(0,229,200,0.04);border:1px solid rgba(0,229,200,0.15);border-radius:14px;padding:16px;margin-top:12px;}
.midtrans-logo{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:3px;color:var(--teal);margin-bottom:6px;}
.midtrans-desc{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);line-height:1.6;margin-bottom:12px;}
.btn-midtrans{width:100%;padding:13px;border:none;border-radius:12px;background:linear-gradient(135deg,rgba(0,229,200,0.2),rgba(0,229,200,0.08));border:1px solid rgba(0,229,200,0.3);color:var(--teal);font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;cursor:pointer;position:relative;overflow:hidden;transition:all 0.3s;}
.btn-midtrans:hover{background:rgba(0,229,200,0.2);}

/* â”€â”€ ADMIN TABS â”€â”€ */
.admin-tab-btn{padding:8px 14px;border:1px solid var(--rim);border-radius:9px;background:rgba(255,255,255,0.02);color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:12px;letter-spacing:1.5px;cursor:pointer;white-space:nowrap;transition:all 0.2s;flex-shrink:0;}
.admin-tab-btn:hover{border-color:rgba(201,168,76,0.3);color:var(--gold);}
.admin-tab-btn.active{background:rgba(201,168,76,0.12);border-color:rgba(201,168,76,0.4);color:var(--gold2);}
.admin-panel-section{animation:fadeUp 0.3s ease;}

/* â”€â”€ LANDING PAGE â”€â”€ */
#screen-landing{display:none;min-height:100vh;background:var(--void);position:relative;overflow-x:hidden;}
.landing-nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;background:rgba(2,4,8,0.85);backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,0.04);}
.landing-logo{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:4px;background:linear-gradient(135deg,var(--gold),var(--gold2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.landing-nav-btns{display:flex;gap:8px;}
.btn-landing-login{padding:9px 20px;border:1px solid rgba(201,168,76,0.4);border-radius:10px;background:rgba(201,168,76,0.08);color:var(--gold);font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;cursor:pointer;}
.btn-landing-signup{padding:9px 20px;border:none;border-radius:10px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;cursor:pointer;}
.landing-hero{padding:120px 20px 60px;text-align:center;max-width:700px;margin:0 auto;}
.landing-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 16px;border:1px solid rgba(0,229,200,0.3);border-radius:20px;background:rgba(0,229,200,0.05);font-family:'DM Mono',monospace;font-size:10px;color:var(--teal);letter-spacing:2px;margin-bottom:20px;}
.landing-h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(48px,10vw,80px);letter-spacing:6px;line-height:1;background:linear-gradient(135deg,#fff 0%,var(--gold2) 40%,var(--gold) 70%,var(--teal) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:16px;}
.landing-sub{font-family:'Syne',sans-serif;font-size:16px;color:rgba(255,255,255,0.5);line-height:1.7;margin-bottom:32px;}
.landing-cta-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:48px;}
.btn-cta-primary{padding:16px 36px;border:none;border-radius:14px;background:linear-gradient(100deg,#8b6520,var(--gold),var(--gold2));color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:3px;cursor:pointer;box-shadow:0 4px 24px rgba(201,168,76,0.3);}
.btn-cta-secondary{padding:16px 36px;border:1px solid rgba(255,255,255,0.15);border-radius:14px;background:rgba(255,255,255,0.04);color:#fff;font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:3px;cursor:pointer;}
.landing-stats-row{display:flex;gap:32px;justify-content:center;flex-wrap:wrap;margin-bottom:60px;}
.landing-stat{text-align:center;}
.landing-stat-num{font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;color:var(--gold2);}
.landing-stat-lbl{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);text-transform:uppercase;}
.landing-features{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;padding:0 20px 60px;max-width:900px;margin:0 auto;}
.landing-feature-card{background:linear-gradient(145deg,rgba(255,255,255,0.04),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.07);border-radius:20px;padding:24px;position:relative;overflow:hidden;}
.landing-feature-icon{font-size:36px;margin-bottom:12px;}
.landing-feature-title{font-family:'Syne',sans-serif;font-size:16px;font-weight:700;color:#fff;margin-bottom:8px;}
.landing-feature-desc{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);line-height:1.7;}
.landing-footer{text-align:center;padding:30px 20px;border-top:1px solid var(--rim);font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}

/* â”€â”€ MARKETPLACE â”€â”€ */
.market-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;margin-bottom:12px;}
.market-card{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:16px;overflow:hidden;transition:all 0.25s;cursor:pointer;}
.market-card:hover{border-color:rgba(201,168,76,0.3);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.market-card-thumb{background:rgba(0,0,0,0.4);height:120px;display:flex;align-items:center;justify-content:center;font-size:40px;position:relative;}
.market-card-type{position:absolute;top:8px;right:8px;padding:3px 8px;border-radius:6px;font-family:'DM Mono',monospace;font-size:8px;background:rgba(0,0,0,0.6);color:var(--teal);}
.market-card-body{padding:12px;}
.market-card-name{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:#fff;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.market-card-seller{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-bottom:8px;}
.market-card-foot{display:flex;align-items:center;justify-content:space-between;}
.market-price{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--gold2);}
.market-price-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);}
.btn-market-buy{padding:6px 14px;border:none;border-radius:8px;background:rgba(201,168,76,0.15);border:1px solid rgba(201,168,76,0.3);color:var(--gold);font-family:'Bebas Neue',sans-serif;font-size:12px;cursor:pointer;}
.market-filters{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;}
.market-filter-chip{padding:6px 14px;border:1px solid var(--rim);border-radius:20px;background:rgba(255,255,255,0.02);color:var(--muted);font-family:'DM Mono',monospace;font-size:10px;cursor:pointer;transition:all 0.2s;}
.market-filter-chip.on{border-color:rgba(201,168,76,0.4);background:rgba(201,168,76,0.08);color:var(--gold);}
.market-sell-box{background:rgba(0,229,160,0.03);border:1px solid rgba(0,229,160,0.15);border-radius:14px;padding:14px;margin-bottom:12px;}

/* â”€â”€ REAL-TIME NOTIF BELL â”€â”€ */
.notif-bell-wrap{position:relative;cursor:pointer;}
.notif-bell-dot{position:absolute;top:-3px;right:-3px;width:10px;height:10px;border-radius:50%;background:var(--red);border:2px solid var(--void);display:none;animation:pulse 2s infinite;}
.notif-bell-dot.show{display:block;}
.notif-toast-popup{position:fixed;top:70px;right:16px;z-index:500;max-width:300px;background:linear-gradient(145deg,#0d1a2e,#060d18);border:1px solid rgba(201,168,76,0.3);border-radius:16px;padding:14px 16px;box-shadow:0 8px 32px rgba(0,0,0,0.5);transform:translateX(120%);transition:transform 0.35s cubic-bezier(0.34,1.56,0.64,1);}
.notif-toast-popup.show{transform:translateX(0);}
.notif-toast-icon{font-size:24px;margin-bottom:6px;}
.notif-toast-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:#fff;margin-bottom:3px;}
.notif-toast-msg{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);line-height:1.6;}

/* â”€â”€ SEARCH HISTORY â”€â”€ */
.search-history-wrap{display:flex;gap:8px;margin-bottom:10px;}
.history-search-input{flex:1;background:rgba(255,255,255,0.03);border:1px solid var(--rim);border-radius:10px;padding:9px 12px;color:var(--text);font-family:'DM Mono',monospace;font-size:11px;outline:none;}
.history-search-input:focus{border-color:rgba(201,168,76,0.3);}
.history-filter-select{background:rgba(255,255,255,0.03);border:1px solid var(--rim);border-radius:10px;padding:9px 12px;color:var(--muted);font-family:'DM Mono',monospace;font-size:11px;outline:none;}

/* â”€â”€ PROFILE PAGE â”€â”€ */
.profile-hero{background:linear-gradient(145deg,rgba(201,168,76,0.08),rgba(0,229,200,0.04));border:1px solid rgba(201,168,76,0.15);border-radius:20px;padding:20px;text-align:center;margin-bottom:12px;position:relative;overflow:hidden;}
.profile-avatar-big{font-size:56px;margin-bottom:8px;filter:drop-shadow(0 4px 12px rgba(201,168,76,0.4));}
.profile-name-big{font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:4px;color:#fff;margin-bottom:4px;}
.profile-joined{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.profile-stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px;}
.profile-stat-box{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:12px;padding:12px;text-align:center;}
.profile-stat-num{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--gold2);}
.profile-stat-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);}
.profile-edit-box{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:14px;margin-bottom:12px;}
.profile-badges-row{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px;}

/* â”€â”€ DARK MODE TOGGLE â”€â”€ */
.dark-mode-toggle{position:fixed;bottom:80px;right:16px;z-index:300;width:44px;height:44px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid var(--rim);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;transition:all 0.2s;box-shadow:0 4px 12px rgba(0,0,0,0.3);}
.dark-mode-toggle:hover{background:rgba(255,255,255,0.1);}
body.light-mode{--void:#f0f2f5;--deep:#e8eaed;--glass:rgba(0,0,0,0.03);--rim:rgba(0,0,0,0.1);--text:#1a1a2e;--muted:#6b7280;--muted2:#4b5563;}
body.light-mode .card{background:rgba(255,255,255,0.9);}

/* â”€â”€ ADMIN REPLY TICKET INLINE â”€â”€ */
.ticket-reply-form{margin-top:10px;padding:10px;background:rgba(0,0,0,0.2);border-radius:10px;border:1px solid var(--rim);}
.ticket-reply-input{width:100%;background:rgba(255,255,255,0.03);border:1px solid var(--rim);border-radius:8px;padding:8px 12px;color:var(--text);font-family:'DM Mono',monospace;font-size:11px;margin-bottom:6px;resize:vertical;min-height:60px;outline:none;}
.ticket-reply-actions{display:flex;gap:6px;}

.upload-progress-wrap{background:rgba(0,0,0,0.3);border:1px solid var(--rim);border-radius:14px;padding:14px;margin-bottom:12px;display:none;}
.upload-progress-wrap.show{display:block;animation:fadeUp 0.3s ease;}
.upload-progress-title{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:10px;display:flex;justify-content:space-between;}
.upload-progress-track{height:8px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;margin-bottom:6px;}
.upload-progress-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--gold2));border-radius:4px;width:0%;transition:width 0.3s ease;position:relative;overflow:hidden;}
.upload-progress-fill::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmerProg 1.5s infinite;}
@keyframes shimmerProg{to{left:100%;}}
.upload-progress-steps{display:flex;gap:6px;flex-direction:column;}
.upload-step{display:flex;align-items:center;gap:8px;font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);padding:4px 0;}
.upload-step.active{color:var(--gold);}
.upload-step.done{color:var(--green);}
.upload-step.error{color:var(--red);}
.upload-step-icon{width:18px;text-align:center;flex-shrink:0;}
.upload-step-bar{flex:1;height:3px;background:rgba(255,255,255,0.06);border-radius:2px;overflow:hidden;}
.upload-step-bar-fill{height:100%;background:var(--green);border-radius:2px;width:0%;transition:width 0.5s ease;}

/* â”€â”€ PREVIEW MODAL â”€â”€ */
.preview-modal{position:fixed;inset:0;z-index:200;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);padding:20px;}
.preview-modal.show{display:flex;animation:fadeUp 0.3s ease;}
.preview-box{background:linear-gradient(145deg,#0d1a2e,#06101c);border:1px solid rgba(201,168,76,0.2);border-radius:24px;padding:24px;width:100%;max-width:460px;position:relative;}
.preview-close{position:absolute;top:14px;right:14px;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid var(--rim);color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;}
.preview-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;color:var(--gold2);margin-bottom:4px;}
.preview-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:16px;}
.preview-img-wrap{background:rgba(0,0,0,0.4);border:1px solid var(--rim);border-radius:14px;overflow:hidden;margin-bottom:14px;display:flex;align-items:center;justify-content:center;min-height:180px;}
.preview-img{max-width:100%;max-height:280px;object-fit:contain;border-radius:10px;}
.preview-audio-wrap{background:rgba(0,0,0,0.3);border:1px solid var(--rim);border-radius:14px;padding:16px;margin-bottom:14px;}
.preview-audio-icon{font-size:40px;text-align:center;margin-bottom:10px;}
.preview-audio-player{width:100%;}
.preview-file-info{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
.preview-info-item{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:10px;padding:10px;text-align:center;}
.preview-info-val{font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--gold2);}
.preview-info-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);}
.preview-fbx-wrap{background:rgba(0,0,0,0.3);border:1px solid var(--rim);border-radius:14px;padding:20px;text-align:center;margin-bottom:14px;}
.preview-fbx-icon{font-size:48px;margin-bottom:8px;}
.btn-preview-upload{width:100%;padding:14px;border:none;border-radius:13px;background:linear-gradient(100deg,#8b6520,var(--gold),var(--gold2),var(--gold),#8b6520);background-size:300% 100%;color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:3px;cursor:pointer;transition:all 0.4s;}
.btn-preview-upload:hover{background-position:100% 0;}

/* â”€â”€ SHARE MODAL â”€â”€ */
.share-modal{position:fixed;inset:0;z-index:200;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);padding:20px;}
.share-modal.show{display:flex;animation:fadeUp 0.3s ease;}
.share-box{background:linear-gradient(145deg,#0d1a2e,#06101c);border:1px solid rgba(0,229,200,0.2);border-radius:24px;padding:24px;width:100%;max-width:420px;position:relative;}
.share-close{position:absolute;top:14px;right:14px;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid var(--rim);color:var(--muted);cursor:pointer;display:flex;align-items:center;justify-content:center;}
.share-title{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;color:var(--teal);margin-bottom:4px;}
.share-asset-name{font-family:'DM Mono',monospace;font-size:11px;color:var(--gold);margin-bottom:14px;padding:8px 12px;background:rgba(201,168,76,0.05);border:1px solid rgba(201,168,76,0.15);border-radius:8px;}
.share-link-wrap{display:flex;gap:8px;margin-bottom:14px;}
.share-link-input{flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(0,229,200,0.2);border-radius:10px;padding:10px 12px;color:var(--teal);font-family:'DM Mono',monospace;font-size:10px;outline:none;}
.btn-copy-link{padding:10px 14px;border:none;border-radius:10px;background:rgba(0,229,200,0.12);border:1px solid rgba(0,229,200,0.3);color:var(--teal);font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:1px;cursor:pointer;white-space:nowrap;transition:all 0.2s;}
.btn-copy-link:hover{background:rgba(0,229,200,0.22);}
.share-platforms{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.share-platform-btn{padding:12px 8px;border:1px solid var(--rim);border-radius:12px;background:rgba(255,255,255,0.02);color:var(--text);font-family:'Syne',sans-serif;font-size:11px;font-weight:700;cursor:pointer;text-align:center;transition:all 0.2s;}
.share-platform-btn:hover{border-color:rgba(0,229,200,0.3);background:rgba(0,229,200,0.05);}
.share-platform-icon{font-size:22px;display:block;margin-bottom:4px;}
.share-qr{background:rgba(255,255,255,0.95);border-radius:12px;padding:10px;margin-top:14px;display:flex;align-items:center;justify-content:center;}

/* â”€â”€ SPIN WHEEL â”€â”€ */
.spin-wrap{text-align:center;padding:10px 0;}
.spin-wheel-container{position:relative;width:260px;height:260px;margin:0 auto 16px;}
.spin-canvas{border-radius:50%;box-shadow:0 0 30px rgba(201,168,76,0.3),0 0 60px rgba(201,168,76,0.1);cursor:pointer;}
.spin-pointer{position:absolute;top:-16px;left:50%;transform:translateX(-50%);font-size:28px;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5));}
.spin-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 0 20px rgba(201,168,76,0.5);border:3px solid rgba(0,0,0,0.3);}
.btn-spin{padding:14px 32px;border:none;border-radius:14px;background:linear-gradient(100deg,#8b6520,var(--gold),var(--gold2));color:#07050a;font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:3px;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 20px rgba(201,168,76,0.3);}
.btn-spin:hover:not(:disabled){transform:scale(1.05);}
.btn-spin:disabled{opacity:0.4;cursor:not-allowed;}
.spin-cooldown{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);margin-top:8px;}
.spin-cooldown span{color:var(--teal);}
.spin-result{background:rgba(201,168,76,0.08);border:1px solid rgba(201,168,76,0.25);border-radius:14px;padding:14px;margin-top:12px;font-family:'DM Mono',monospace;font-size:12px;color:var(--gold2);text-align:center;display:none;}
.spin-result.show{display:block;animation:fadeUp 0.4s ease;}
.spin-history{margin-top:12px;}
.spin-history-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--rim);font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);}
.spin-history-item span{color:var(--gold);}

/* â”€â”€ VIP MEMBERSHIP â”€â”€ */
.vip-tiers{display:flex;flex-direction:column;gap:10px;margin-bottom:12px;}
.vip-tier{border-radius:16px;padding:16px;position:relative;overflow:hidden;cursor:pointer;transition:all 0.3s;}
.vip-tier.free{background:rgba(255,255,255,0.02);border:1px solid var(--rim);}
.vip-tier.silver{background:linear-gradient(135deg,rgba(192,192,192,0.08),rgba(148,163,184,0.04));border:1px solid rgba(192,192,192,0.25);}
.vip-tier.gold{background:linear-gradient(135deg,rgba(201,168,76,0.12),rgba(240,208,128,0.06));border:1px solid rgba(201,168,76,0.35);}
.vip-tier.diamond{background:linear-gradient(135deg,rgba(0,229,200,0.1),rgba(167,139,250,0.08));border:1px solid rgba(0,229,200,0.3);}
.vip-tier-shine{position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.04),transparent);animation:vipShine 3s infinite;}
@keyframes vipShine{to{left:150%;}}
.vip-tier-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.vip-tier-name{font-family:'Bebas Neue',sans-serif;font-size:20px;letter-spacing:3px;}
.vip-tier.free .vip-tier-name{color:var(--muted2);}
.vip-tier.silver .vip-tier-name{color:#c0c0c0;}
.vip-tier.gold .vip-tier-name{color:var(--gold2);}
.vip-tier.diamond .vip-tier-name{color:var(--teal);}
.vip-tier-price{font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);}
.vip-tier-icon{font-size:28px;}
.vip-perks{display:flex;flex-direction:column;gap:4px;margin-bottom:10px;}
.vip-perk{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2);display:flex;align-items:center;gap:6px;}
.vip-perk-check{color:var(--green);}
.vip-perk-x{color:var(--muted);}
.btn-vip-subscribe{width:100%;padding:10px;border:none;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer;transition:all 0.2s;}
.vip-tier.free .btn-vip-subscribe{background:rgba(255,255,255,0.04);border:1px solid var(--rim);color:var(--muted);cursor:default;}
.vip-tier.silver .btn-vip-subscribe{background:rgba(192,192,192,0.12);border:1px solid rgba(192,192,192,0.3);color:#c0c0c0;}
.vip-tier.gold .btn-vip-subscribe{background:linear-gradient(135deg,rgba(201,168,76,0.2),rgba(201,168,76,0.08));border:1px solid rgba(201,168,76,0.4);color:var(--gold2);}
.vip-tier.diamond .btn-vip-subscribe{background:linear-gradient(135deg,rgba(0,229,200,0.15),rgba(167,139,250,0.1));border:1px solid rgba(0,229,200,0.35);color:var(--teal);}
.vip-badge{display:inline-flex;align-items:center;gap:4px;padding:2px 10px;border-radius:20px;font-family:'DM Mono',monospace;font-size:9px;font-weight:700;margin-left:8px;}
.vip-badge.silver{background:rgba(192,192,192,0.15);border:1px solid rgba(192,192,192,0.3);color:#c0c0c0;}
.vip-badge.gold{background:rgba(201,168,76,0.15);border:1px solid rgba(201,168,76,0.3);color:var(--gold2);}
.vip-badge.diamond{background:rgba(0,229,200,0.1);border:1px solid rgba(0,229,200,0.3);color:var(--teal);}
.current-vip-banner{border-radius:14px;padding:14px;margin-bottom:12px;display:flex;align-items:center;gap:12px;}
.current-vip-banner.free{background:rgba(255,255,255,0.02);border:1px solid var(--rim);}
.current-vip-banner.silver{background:rgba(192,192,192,0.06);border:1px solid rgba(192,192,192,0.2);}
.current-vip-banner.gold{background:rgba(201,168,76,0.06);border:1px solid rgba(201,168,76,0.2);}
.current-vip-banner.diamond{background:rgba(0,229,200,0.06);border:1px solid rgba(0,229,200,0.2);}

/* â”€â”€ REVENUE ENHANCED â”€â”€ */
.rev-stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px;}
.rev-stat-card{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:12px;padding:12px;text-align:center;}
.rev-stat-val{font-family:'Bebas Neue',sans-serif;font-size:22px;color:var(--green);}
.rev-stat-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;}
.rev-chart-wrap{background:rgba(0,0,0,0.3);border:1px solid var(--rim);border-radius:14px;padding:14px;margin-bottom:12px;}
.rev-line-canvas{width:100%;height:120px;display:block;}

.audio-editor{background:linear-gradient(145deg,rgba(167,139,250,0.06),rgba(167,139,250,0.02));border:1px solid rgba(167,139,250,0.2);border-radius:18px;padding:18px;margin-bottom:12px;}
.audio-editor-title{font-family:'Bebas Neue',sans-serif;font-size:18px;letter-spacing:3px;color:var(--purple);margin-bottom:4px;}
.audio-editor-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:14px;line-height:1.6;}
.waveform-wrap{background:rgba(0,0,0,0.4);border:1px solid rgba(167,139,250,0.15);border-radius:12px;padding:12px;margin-bottom:12px;position:relative;overflow:hidden;cursor:crosshair;}
.waveform-canvas{width:100%;height:80px;display:block;}
.waveform-overlay{position:absolute;top:12px;left:12px;right:12px;height:80px;pointer-events:none;}
.waveform-progress-bar{position:absolute;top:0;left:0;height:100%;background:rgba(167,139,250,0.12);}
.waveform-cursor-line{position:absolute;top:0;width:2px;height:100%;background:var(--purple);box-shadow:0 0 6px rgba(167,139,250,0.8);}
.waveform-sel{position:absolute;top:0;height:100%;background:rgba(167,139,250,0.18);border-left:1px solid rgba(167,139,250,0.5);border-right:1px solid rgba(167,139,250,0.5);}
.waveform-empty{display:flex;align-items:center;justify-content:center;height:80px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);flex-direction:column;gap:6px;}
.audio-controls{display:flex;gap:7px;align-items:center;margin-bottom:12px;flex-wrap:wrap;}
.btn-audio{padding:8px 13px;border:1px solid rgba(167,139,250,0.3);border-radius:9px;background:rgba(167,139,250,0.08);color:var(--purple);font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:1px;cursor:pointer;transition:all 0.2s;white-space:nowrap;}
.btn-audio:hover{background:rgba(167,139,250,0.18);}
.btn-audio:disabled{opacity:0.35;cursor:not-allowed;}
.btn-audio-green{border-color:rgba(0,229,160,0.3);background:rgba(0,229,160,0.06);color:var(--green);}
.btn-audio-red{border-color:rgba(255,68,102,0.3);background:rgba(255,68,102,0.06);color:var(--red);}
.audio-time-display{font-family:'DM Mono',monospace;font-size:11px;color:var(--teal);padding:7px 11px;background:rgba(0,0,0,0.3);border:1px solid var(--rim);border-radius:8px;margin-left:auto;}
.audio-sliders{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:12px;}
.audio-slider-group{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:11px;padding:11px;}
input[type=range]{touch-action:pan-y;-webkit-tap-highlight-color:transparent;}
input[type=range]::-webkit-slider-thumb{touch-action:none;}

.aslider-val{color:var(--purple);font-weight:700;font-size:11px;}
.aslider{width:100%;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:rgba(167,139,250,0.2);outline:none;cursor:pointer;touch-action:pan-y;display:block;}
.aslider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#a78bfa,#7c3aed);cursor:pointer;box-shadow:0 0 0 4px rgba(167,139,250,0.15),0 2px 8px rgba(124,58,237,0.4);transition:box-shadow 0.2s;margin-top:-11px;}
.aslider::-webkit-slider-thumb:active{box-shadow:0 0 0 8px rgba(167,139,250,0.25),0 4px 16px rgba(124,58,237,0.5);}
.aslider::-moz-range-thumb{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#a78bfa,#7c3aed);cursor:pointer;border:none;box-shadow:0 0 0 4px rgba(167,139,250,0.15);}
.aslider::-webkit-slider-runnable-track{height:6px;border-radius:3px;}
.aslider::-moz-range-track{height:6px;border-radius:3px;background:rgba(167,139,250,0.2);}
.audio-slider-group{background:rgba(255,255,255,0.02);border:1px solid rgba(167,139,250,0.15);border-radius:14px;padding:14px 14px 16px;}
.audio-effects-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;}
.effect-chip{padding:6px 12px;border:1px solid rgba(167,139,250,0.2);border-radius:20px;background:rgba(167,139,250,0.04);color:var(--muted2);font-family:'DM Mono',monospace;font-size:10px;cursor:pointer;transition:all 0.2s;}
.effect-chip:hover,.effect-chip.on{border-color:rgba(167,139,250,0.5);background:rgba(167,139,250,0.14);color:var(--purple);}
.audio-info-bar{display:grid;grid-template-columns:repeat(4,1fr);gap:7px;margin-bottom:12px;}
.ainfo-box{background:rgba(0,0,0,0.3);border:1px solid var(--rim);border-radius:10px;padding:9px;text-align:center;}
.ainfo-val{font-family:'Bebas Neue',sans-serif;font-size:15px;color:var(--purple);line-height:1;}
.ainfo-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-top:2px;}
.export-box{background:rgba(0,229,160,0.03);border:1px solid rgba(0,229,160,0.15);border-radius:12px;padding:13px;}
.export-title{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--green);text-transform:uppercase;margin-bottom:9px;}
.export-formats{display:flex;gap:6px;margin-bottom:10px;}
.fmt-btn{padding:6px 14px;border:1px solid var(--rim);border-radius:7px;background:rgba(255,255,255,0.02);color:var(--muted);font-family:'DM Mono',monospace;font-size:10px;cursor:pointer;transition:all 0.2s;}
.fmt-btn.sel{border-color:rgba(0,229,160,0.4);background:rgba(0,229,160,0.08);color:var(--green);}
.btn-export{width:100%;padding:12px;border:none;border-radius:10px;background:linear-gradient(135deg,rgba(0,229,160,0.18),rgba(0,229,160,0.06));border:1px solid rgba(0,229,160,0.3);color:var(--green);font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;cursor:pointer;transition:all 0.2s;}
.btn-export:hover{background:rgba(0,229,160,0.22);}
.btn-export:disabled{opacity:0.35;cursor:not-allowed;}
.audio-tips-box{background:rgba(245,158,11,0.03);border:1px solid rgba(245,158,11,0.15);border-radius:11px;padding:11px 14px;font-family:'DM Mono',monospace;font-size:10px;color:rgba(245,158,11,0.65);line-height:1.9;margin-top:10px;}
/* â”€â”€ ADMIN ENHANCED DASHBOARD â”€â”€ */
.admin-dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.admin-dash-card{background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:14px;padding:14px;}
.admin-dash-title{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:12px;}
.retention-bar{display:flex;align-items:center;gap:8px;margin-bottom:6px;}
.retention-label{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);width:60px;flex-shrink:0;}
.retention-track{flex:1;height:6px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;}
.retention-fill{height:100%;border-radius:3px;transition:width 0.6s ease;}
.retention-pct{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted2);width:30px;text-align:right;flex-shrink:0;}
.activity-heatmap{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
.heatmap-cell{aspect-ratio:1;border-radius:3px;background:rgba(255,255,255,0.04);transition:all 0.2s;cursor:default;}
.heatmap-cell:hover{transform:scale(1.3);}
.heatmap-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);text-align:center;margin-bottom:4px;display:grid;grid-template-columns:repeat(7,1fr);gap:3px;}
/* â•â• PREMIUM REDESIGN â•â• */
/* Card premium glow effect */
.card{background:linear-gradient(145deg,rgba(255,255,255,0.035),rgba(255,255,255,0.008));border:1px solid rgba(255,255,255,0.07);border-radius:24px;padding:22px;position:relative;overflow:hidden;margin-bottom:12px;box-shadow:0 8px 32px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.06);}
.card::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,rgba(201,168,76,0.8),rgba(240,208,128,0.4),transparent);}
/* Topbar premium */
.topbar{background:rgba(1,3,6,0.92);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,255,255,0.05);box-shadow:0 4px 24px rgba(0,0,0,0.5);}
/* Coin ring */
.coin-ring{border:2px solid rgba(201,168,76,0.4);box-shadow:0 0 12px rgba(201,168,76,0.2),inset 0 0 8px rgba(201,168,76,0.05);transition:border-color 0.5s,box-shadow 0.5s;}
/* Tab bar */
.tab-bar{background:rgba(1,3,6,0.95);backdrop-filter:blur(24px);border-top:1px solid rgba(255,255,255,0.06);box-shadow:0 -4px 32px rgba(0,0,0,0.5);}
.tab-btn{transition:color 0.2s;}
.tab-btn.active .ti{filter:drop-shadow(0 0 6px currentColor);}
/* Buttons */
.btn-up{background:linear-gradient(135deg,#8b6520 0%,var(--gold) 40%,var(--gold2) 60%,#8b6520 100%);background-size:200% 100%;box-shadow:0 4px 20px rgba(201,168,76,0.35);transition:background-position 0.4s,transform 0.15s,box-shadow 0.2s;}
.btn-up:hover{background-position:100% 0;box-shadow:0 6px 28px rgba(201,168,76,0.5);}
.btn-up:active{transform:scale(0.97);}
/* Finput */
.finput{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:12px;transition:border-color 0.2s,box-shadow 0.2s;}
.finput:focus{border-color:rgba(201,168,76,0.4);box-shadow:0 0 0 3px rgba(201,168,76,0.08);outline:none;}
/* History items */
.hist-item{border-radius:16px;transition:all 0.2s;border:1px solid rgba(255,255,255,0.05);}
.hist-item:hover{border-color:rgba(201,168,76,0.2);background:rgba(201,168,76,0.02);transform:translateX(2px);}
/* Panel panels */
.panel-wrap{scrollbar-width:thin;scrollbar-color:rgba(201,168,76,0.2) transparent;}
/* Toast */
.toast-msg{background:linear-gradient(135deg,rgba(10,20,36,0.98),rgba(5,12,22,0.98));border:1px solid rgba(201,168,76,0.25);box-shadow:0 8px 32px rgba(0,0,0,0.6),0 0 0 1px rgba(255,255,255,0.03);}
/* Waveform canvas */
#waveformCanvas{border-radius:12px;}
/* Spin wheel */
.spin-canvas{filter:drop-shadow(0 0 20px rgba(201,168,76,0.25));}
/* Admin tab active */
.admin-tab-btn.active{box-shadow:0 2px 12px rgba(201,168,76,0.2);}
/* VIP tiers premium shine */
.vip-tier.gold{box-shadow:0 4px 24px rgba(201,168,76,0.12);}
.vip-tier.diamond{box-shadow:0 4px 24px rgba(0,229,200,0.08);}
/* Market cards */
.market-card{box-shadow:0 4px 16px rgba(0,0,0,0.3);}
.market-card:hover{box-shadow:0 8px 32px rgba(201,168,76,0.15);}
/* Ctitle icon */
.ctitle-icon{width:44px;height:44px;background:linear-gradient(135deg,rgba(201,168,76,0.15),rgba(201,168,76,0.05));border:1px solid rgba(201,168,76,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;box-shadow:0 2px 8px rgba(201,168,76,0.1);}
/* Landing hero gradient text animation */
.landing-h1{animation:hueShift 8s ease infinite;}
@keyframes hueShift{0%,100%{filter:hue-rotate(0deg)}50%{filter:hue-rotate(15deg)}}
/* Premium scrollbar */
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(201,168,76,0.25);border-radius:2px;}
::-webkit-scrollbar-thumb:hover{background:rgba(201,168,76,0.45);}
/* Notif toast premium */
.notif-toast-popup{backdrop-filter:blur(20px);box-shadow:0 16px 48px rgba(0,0,0,0.7),0 0 0 1px rgba(201,168,76,0.15);}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="scanlines"></div>
<div class="vignette"></div>
<div class="toast" id="toast"></div>

<!-- AVATAR MODAL -->
<div class="avatar-modal" id="avatarModal">
  <div class="avatar-box">
    <button class="avatar-close" onclick="closeAvatarModal()">âœ•</button>
    <div class="avatar-title">Pilih Avatar</div>
    <div class="avatar-sub">Tap emoji untuk ganti avatar</div>
    <div class="avatar-grid" id="avatarGrid"></div>
  </div>
</div>

<!-- PAYMENT MODAL -->
<div class="modal-bg" id="modalBg">
  <div class="modal"><button class="modal-close" onclick="closeModal()">âœ•</button><div id="modalInner"></div></div>
</div>

<!-- NOTIF PANEL -->
<div class="notif-panel" id="notifPanel">
  <div class="notif-panel-hdr">
    <div class="notif-panel-title">ðŸ”” Notifikasi</div>
    <div class="notif-panel-clear" onclick="markAllRead()">Baca semua</div>
  </div>
  <div class="notif-scroll"><div id="notifList"></div></div>
</div>

<!-- LANDING PAGE -->
<div id="screen-landing" style="display:none">
  <nav class="landing-nav">
    <div class="landing-logo">âš¡ DEV</div>
    <div class="landing-nav-btns">
      <button class="btn-landing-login" onclick="hideLanding()">LOGIN</button>
      <button class="btn-landing-signup" onclick="hideLanding()">DAFTAR GRATIS</button>
    </div>
  </nav>
  <div class="landing-hero">
    <div class="landing-badge">ðŸš€ PLATFORM UPLOAD ASSET ROBLOX #1</div>
    <div class="landing-h1">DEV<br>UPLOADER</div>
    <div class="landing-sub">Upload asset Roblox dengan mudah, cepat, dan aman.<br>Decal, Audio, Mesh â€” semua dalam satu platform premium.</div>
    <div class="landing-cta-row">
      <button class="btn-cta-primary" onclick="hideLanding()">âš¡ DAFTAR</button>
      <button class="btn-cta-secondary" onclick="document.getElementById('landingFeatures').scrollIntoView({behavior:'smooth'})">ðŸ“– Lihat Fitur</button>
    </div>
    <div class="landing-stats-row">
      <div class="landing-stat"><div class="landing-stat-num" id="landingStatUsers">500+</div><div class="landing-stat-lbl">User Aktif</div></div>
      <div class="landing-stat"><div class="landing-stat-num" id="landingStatUploads">10K+</div><div class="landing-stat-lbl">Total Upload</div></div>
      <div class="landing-stat"><div class="landing-stat-num">99%</div><div class="landing-stat-lbl">Uptime</div></div>
    </div>
  </div>
  <div class="landing-features" id="landingFeatures">
    <div class="landing-feature-card"><div class="landing-feature-icon">ðŸš€</div><div class="landing-feature-title">Upload Instan</div><div class="landing-feature-desc">Upload Decal, Audio, dan Mesh ke Roblox dalam hitungan detik via Open Cloud API.</div></div>
    <div class="landing-feature-card"><div class="landing-feature-icon">ðŸ“¦</div><div class="landing-feature-title">Bulk Upload</div><div class="landing-feature-desc">Upload banyak file sekaligus dengan progress real-time untuk setiap file.</div></div>
    <div class="landing-feature-card"><div class="landing-feature-icon">ðŸŽµ</div><div class="landing-feature-title">Audio Editor</div><div class="landing-feature-desc">Edit audio langsung di browser â€” trim, pitch shift, noise, fade in/out, dan export.</div></div>
    <div class="landing-feature-card"><div class="landing-feature-icon">ðŸŽ°</div><div class="landing-feature-title">Spin Wheel</div><div class="landing-feature-desc">Putar wheel setiap hari untuk mendapatkan coin gratis dan hadiah eksklusif.</div></div>
    <div class="landing-feature-card"><div class="landing-feature-icon">ðŸ‘‘</div><div class="landing-feature-title">VIP Membership</div><div class="landing-feature-desc">Upgrade ke Silver, Gold, atau Diamond untuk bonus coin dan upload gratis harian.</div></div>
    <div class="landing-feature-card"><div class="landing-feature-icon">ðŸª</div><div class="landing-feature-title">Marketplace</div><div class="landing-feature-desc">Jual dan beli asset Roblox dari developer lain di marketplace eksklusif kami.</div></div>
  </div>
  <div class="landing-footer">Â© 2025 DEV Uploader Â· <a href="#" onclick="hideLanding()" style="color:var(--gold)">Masuk Sekarang â†’</a></div>
</div>

<!-- â•â• AUTH â•â• -->
<div id="screen-auth" style="display:none">
  <div style="position:fixed;inset:0;background:radial-gradient(ellipse at 30% 40%,rgba(201,168,76,0.06) 0%,transparent 60%),radial-gradient(ellipse at 70% 70%,rgba(0,229,200,0.04) 0%,transparent 50%)"></div>
  <div class="auth-box" style="position:relative;z-index:1">
    <span class="auth-logo">DEV</span>
    <div class="auth-tagline">Premium Asset Platform</div>
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchAuthTab('login')">Masuk</button>
      <button class="auth-tab" onclick="switchAuthTab('register')">Daftar</button>
    </div>
    <div class="auth-err" id="authErr"></div>
    <div class="auth-form active" id="form-login">
      <div class="auth-field"><label class="auth-label">Email</label><input class="auth-input" type="email" id="loginEmail" placeholder="email@kamu.com"></div>
      <div class="auth-field"><label class="auth-label">Password</label><input class="auth-input" type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doLogin()"></div>
      <button class="btn-auth" id="btnLogin" onclick="doLogin()"><div class="shim"></div>MASUK SEKARANG</button>
      <div class="auth-divider"><div class="auth-divider-line"></div><div class="auth-divider-txt">ATAU</div><div class="auth-divider-line"></div></div>
      <button class="btn-google" onclick="doGoogle()"><svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Masuk dengan Google</button>
    </div>
    <div class="auth-form" id="form-register">
      <div class="ref-hint" id="refHint">ðŸŽ Daftar via referral! Kamu dapat bonus coin gratis!</div>
      <div class="auth-field"><label class="auth-label">Nama</label><input class="auth-input" type="text" id="regName" placeholder="Nama kamu"></div>
      <div class="auth-field"><label class="auth-label">Email</label><input class="auth-input" type="email" id="regEmail" placeholder="email@kamu.com"></div>
      <div class="auth-field"><label class="auth-label">Password</label><input class="auth-input" type="password" id="regPass" placeholder="Minimal 6 karakter"></div>
      <div class="auth-field"><label class="auth-label">Ulangi Password</label><input class="auth-input" type="password" id="regPass2" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')doRegister()"></div>
      <button class="btn-auth" id="btnRegister" onclick="doRegister()"><div class="shim"></div>DAFTAR SEKARANG</button>
      <div class="auth-divider"><div class="auth-divider-line"></div><div class="auth-divider-txt">ATAU</div><div class="auth-divider-line"></div></div>
      <button class="btn-google" onclick="doGoogle()"><svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>Daftar dengan Google</button>
    </div>
  </div>
</div>

<!-- â•â• APP â•â• -->
<div id="screen-app">
<div class="wrap">
  <div class="topbar">
    <div class="topbar-user">
      <div class="user-avatar" id="userAvatar" onclick="openAvatarPicker()" title="Ganti avatar">âš¡</div>
      <div><div class="user-name" id="userName">Loading...</div><div class="user-email" id="userEmail"></div></div>
    </div>
    <div class="topbar-btns">
      <div class="notif-btn" onclick="toggleNotifPanel()">ðŸ””<div class="notif-badge" id="notifBadge">0</div></div>
      <button class="btn-sm btn-sm-gold" id="adminTabBtn" onclick="goAdmin()" style="display:none">ðŸ‘‘ Admin</button>
      <button class="btn-sm btn-sm-red" onclick="doLogout()">Logout</button>
    </div>
  </div>
  <div class="hdr">
    <div class="hdr-eyebrow"><div class="hdr-eyebrow-dot"></div> Premium Asset Platform</div>
    <span class="hdr-logo">DEV</span>
    <div class="hdr-tagline">Roblox Open Cloud Â· Asset Upload Tool</div>
    <div class="hdr-rule"><div class="hdr-rule-line"></div><div class="hdr-rule-gem"></div><div class="hdr-rule-line"></div></div>
  </div>
  <div class="coin-bar">
    <div class="coin-bar-left"><div class="coin-icon"><span>âœ¦</span></div><div><div class="coin-lbl">Saldo Coin</div><div class="coin-val" id="coinVal">0</div></div></div>
    <div class="coin-bar-right">
      <button class="btn-pwa" id="pwaBtn" onclick="installPWA()">ðŸ“± Install</button>
      <button class="btn-topup-quick" onclick="switchTab(document.querySelectorAll('.tab-btn')[2],'topup')">+ Topup</button>
    </div>
  </div>
  <!-- TABS -->
  <div class="tabs-wrap">
    <div class="tabs" id="tabs">
      <div class="tab-slider" id="tabSlider"></div>
      <button class="tab-btn active" onclick="switchTab(this,'upload')"><span class="ti">â¬†</span> Upload</button>
      <button class="tab-btn" onclick="switchTab(this,'bulk')"><span class="ti">ðŸ“Ž</span> Bulk</button>
      <button class="tab-btn" onclick="switchTab(this,'topup')"><span class="ti">â—ˆ</span> Topup</button>
      <button class="tab-btn" onclick="switchTab(this,'history')"><span class="ti">â—Ž</span> History</button>
      <button class="tab-btn" onclick="switchTab(this,'dashboard')"><span class="ti">ðŸ“Š</span> Stats</button>
      <button class="tab-btn" onclick="switchTab(this,'leaderboard')"><span class="ti">ðŸ†</span> Board</button>
      <button class="tab-btn" onclick="switchTab(this,'referral')"><span class="ti">ðŸŽ</span> Referral</button>
      <button class="tab-btn" onclick="switchTab(this,'market')"><span class="ti">ðŸª</span> Market</button>
      <button class="tab-btn" onclick="switchTab(this,'profile')"><span class="ti">ðŸ‘¤</span> Profil</button>
      <button class="tab-btn" onclick="switchTab(this,'vip')"><span class="ti">ðŸ‘‘</span> VIP</button>
      <button class="tab-btn" onclick="switchTab(this,'spin')"><span class="ti">ðŸŽ°</span> Spin</button>
      <button class="tab-btn" onclick="switchTab(this,'audio')"><span class="ti">ðŸŽµ</span> Audio</button>
      <button class="tab-btn" onclick="switchTab(this,'badges')"><span class="ti">ðŸ…</span> Badge</button>
      <button class="tab-btn" onclick="switchTab(this,'missions')"><span class="ti">ðŸŽ¯</span> Misi</button>
      <button class="tab-btn" onclick="switchTab(this,'support')"><span class="ti">ðŸ’¬</span> Support</button>
      <button class="tab-btn" onclick="switchTab(this,'settings')"><span class="ti">âš™</span> Settings</button>
    </div>
  </div>

  <!-- UPLOAD -->
  <div class="panel active" id="panel-upload">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ“¤</div><div><div class="ctitle-text">Upload Asset</div><div class="ctitle-sub">Single file Â· 1 Coin per upload</div></div></div>
      <div class="infobox">API Key â†’ <a href="https://create.roblox.com/dashboard/credentials" target="_blank">create.roblox.com/dashboard/credentials</a><br>Permission: <strong>Assets: Read + Write</strong></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Roblox User ID</div><input class="finput" type="text" id="userId" placeholder="Contoh: 3493541426" inputmode="numeric"></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Open Cloud API Key</div><input class="finput" type="password" id="apiKey" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <div class="div"></div>
      <div class="field">
        <div class="flabel"><span class="flabel-gem"></span> File Asset</div>
        <div class="dz" id="dz">
          <input type="file" id="fi" accept=".png,.jpg,.jpeg,.mp3,.ogg,.wav,.fbx" onchange="handleFile(this)">
          <div class="dz-orb">â˜ï¸</div>
          <div class="dz-title">Tap atau Drop File</div>
          <div class="dz-sub">PNG JPG MP3 OGG WAV FBX</div>
          <div class="dz-formats"><span class="dz-fmt img">PNG</span><span class="dz-fmt img">JPG</span><span class="dz-fmt audio">MP3</span><span class="dz-fmt audio">WAV</span><span class="dz-fmt mesh">FBX</span></div>
        </div>
        <div class="fchip" id="fchip"><div class="fchip-ico" id="fchipIco">ðŸ“„</div><div class="fchip-info"><div class="fchip-name" id="fName">â€”</div><div class="fchip-size" id="fSize">â€”</div></div><button class="fchip-rm" onclick="removeFile()">âœ•</button></div>
        <div class="rbxm-notice" id="rbxmNotice"><strong>âš  .rbxm tidak bisa via API!</strong> Gunakan Roblox Studio.</div>
      </div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Nama Asset</div><input class="finput" type="text" id="assetName" placeholder="Nama asset..."></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Tipe Asset</div>
        <select class="finput" id="assetType">
          <option value="Decal">ðŸ–¼ Image / Decal</option>
          <option value="Audio">ðŸŽµ Audio</option>
          <option value="MeshPart">ðŸ“¦ Mesh (.fbx)</option>
        </select>
      </div>
      <div class="cost-preview"><div class="cost-label">Biaya Upload</div><div class="cost-val">âœ¦ 1 Coin</div></div>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <button class="btn-up" id="btnPreview" onclick="openPreview()" style="flex:1;background:rgba(201,168,76,0.1);border:1px solid rgba(201,168,76,0.3);color:var(--gold)"><div class="shim"></div>ðŸ‘ï¸ &nbsp; PREVIEW</button>
        <button class="btn-up" id="btnUp" onclick="doUpload()" style="flex:2"><div class="shim"></div>ðŸš€ &nbsp; UPLOAD</button>
      </div>
      <!-- UPLOAD PROGRESS -->
      <div class="upload-progress-wrap" id="uploadProgressWrap">
        <div class="upload-progress-title"><span>âš¡ Uploading...</span><span id="uploadProgressPct">0%</span></div>
        <div class="upload-progress-track"><div class="upload-progress-fill" id="uploadProgressFill"></div></div>
        <div class="upload-progress-steps">
          <div class="upload-step" id="step1"><div class="upload-step-icon">ðŸ“</div><span>Membaca file</span><div class="upload-step-bar"><div class="upload-step-bar-fill" id="step1fill"></div></div></div>
          <div class="upload-step" id="step2"><div class="upload-step-icon">â˜ï¸</div><span>Upload ke Roblox</span><div class="upload-step-bar"><div class="upload-step-bar-fill" id="step2fill"></div></div></div>
          <div class="upload-step" id="step3"><div class="upload-step-icon">ðŸ”„</div><span>Proses asset</span><div class="upload-step-bar"><div class="upload-step-bar-fill" id="step3fill"></div></div></div>
          <div class="upload-step" id="step4"><div class="upload-step-icon">âœ…</div><span>Selesai!</span><div class="upload-step-bar"><div class="upload-step-bar-fill" id="step4fill"></div></div></div>
        </div>
      </div>
      <div class="result" id="result"><div class="result-hdr" id="resultHdr"></div><div class="result-body" id="resultBody"></div></div>
      <div class="warnbox"><div class="warnbox-t">âš  Info</div>Coin dipotong setelah upload berhasil. Settingan tersimpan otomatis di Settings.</div>
    </div>
  </div>

  <!-- BULK -->
  <div class="panel" id="panel-bulk">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ“Ž</div><div><div class="ctitle-text">Bulk Upload</div><div class="ctitle-sub">Upload banyak file sekaligus</div></div></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Roblox User ID</div><input class="finput" type="text" id="bulkUserId" placeholder="Contoh: 3493541426" inputmode="numeric"></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Open Cloud API Key</div><input class="finput" type="password" id="bulkApiKey" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <div class="div"></div>
      <div class="bulk-drop">
        <input type="file" multiple accept=".png,.jpg,.jpeg,.mp3,.ogg,.wav,.fbx" onchange="handleBulkFiles(this)">
        <div style="font-size:26px;margin-bottom:7px">ðŸ“Ž</div>
        <div style="font-size:13px;font-weight:700;margin-bottom:2px">Pilih Banyak File</div>
        <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">PNG JPG MP3 WAV FBX</div>
      </div>
      <div class="bulk-list" id="bulkList"><div style="text-align:center;padding:18px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">Belum ada file</div></div>
      <div class="bulk-cost"><span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">Total Biaya</span><span style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--gold)">âœ¦ <span id="bulkCoinCost">0</span> Coin</span></div>
      <button class="btn-bulk-go" id="btnBulk" onclick="doBulkUpload()"><div class="shim"></div>ðŸ“Ž &nbsp; BULK UPLOAD SEKARANG</button>
      <div class="warnbox" style="margin-top:10px"><div class="warnbox-t">âš  Info</div>1 file = 1 Coin. Nama asset otomatis = nama file. File diupload satu per satu.</div>
    </div>
  </div>

  <!-- TOPUP -->
  <div class="panel" id="panel-topup">
    <div class="card"><div class="card-glow"></div>
      <div class="topup-hero">
        <div class="topup-ring"><div class="topup-ring-inner"><div class="topup-ring-num" id="ringNum">0</div><div class="topup-ring-lbl">COINS</div></div></div>
        <div class="topup-title">Topup Coins</div>
        <div class="topup-sub">1 Coin = 1x Upload Â· Transfer / E-Wallet</div>
      </div>
      <div class="promo-box">
        <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--purple);text-transform:uppercase;margin-bottom:8px">ðŸŽŸï¸ Kode Promo</div>
        <div class="promo-input-row">
          <input class="finput" type="text" id="promoInput" placeholder="Masukkan kode promo..." style="text-transform:uppercase;flex:1">
          <button class="btn-apply-promo" onclick="applyPromoCode()">PAKAI</button>
        </div>
      </div>
      <!-- Payment Method Toggle -->
      <div class="payment-method-tabs">
        <button class="payment-method-tab active" id="pmTabManual" onclick="switchPaymentMethod('manual')">ðŸ¦ Transfer Manual</button>
        <button class="payment-method-tab" id="pmTabMidtrans" onclick="switchPaymentMethod('midtrans')">âš¡ Auto (Midtrans)</button>
      </div>
      <!-- MANUAL TOPUP -->
      <div id="manualPaySection">
      <div class="pkg-grid">
        <div class="pkg" onclick="openPayment(10,'Rp 5.000')"><div class="pkg-coins">10</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 5.000</div><div class="pkg-price-note">Rp 500/coin</div></div>
        <div class="pkg hot" onclick="openPayment(25,'Rp 10.000')"><div class="pkg-coins">25</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 10.000</div><div class="pkg-price-note">Rp 400/coin</div><div class="pkg-bonus">+5 Bonus</div></div>
        <div class="pkg" onclick="openPayment(60,'Rp 20.000')"><div class="pkg-coins">60</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 20.000</div><div class="pkg-price-note">Rp 333/coin</div><div class="pkg-bonus">+10 Bonus</div></div>
        <div class="pkg" onclick="openPayment(150,'Rp 40.000')"><div class="pkg-coins">150</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 40.000</div><div class="pkg-price-note">Rp 267/coin</div><div class="pkg-bonus">+30 Bonus</div></div>
      </div>
      </div>
      <!-- MIDTRANS TOPUP -->
      <div id="midtransSection" style="display:none">
      <div class="midtrans-box">
        <div class="midtrans-logo">âš¡ AUTO PAYMENT</div>
        <div class="midtrans-desc">Bayar otomatis via Midtrans. Coin langsung masuk setelah pembayaran berhasil!<br>Tersedia: GoPay, OVO, QRIS, VA Bank, dll.</div>
        <div class="pkg-grid" style="margin-bottom:12px">
          <div class="pkg" onclick="openMidtrans(10,5000)"><div class="pkg-coins">10</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 5.000</div></div>
          <div class="pkg hot" onclick="openMidtrans(25,10000)"><div class="pkg-coins">25</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 10.000</div><div class="pkg-bonus">+5 Bonus</div></div>
          <div class="pkg" onclick="openMidtrans(60,20000)"><div class="pkg-coins">60</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 20.000</div><div class="pkg-bonus">+10 Bonus</div></div>
          <div class="pkg" onclick="openMidtrans(150,40000)"><div class="pkg-coins">150</div><div class="pkg-coins-lbl">COINS</div><div class="pkg-price">Rp 40.000</div><div class="pkg-bonus">+30 Bonus</div></div>
        </div>
        <div style="background:rgba(0,229,200,0.05);border:1px solid rgba(0,229,200,0.15);border-radius:10px;padding:10px 13px;font-family:'DM Mono',monospace;font-size:10px;color:rgba(0,229,200,0.6);line-height:1.7;">âš¡ Pembayaran langsung diproses. Coin masuk otomatis + notifikasi email & WA!</div>
      </div>
      </div>

      <div class="warnbox"><div class="warnbox-t">ðŸ“‹ Cara Topup</div>Pilih paket â†’ Pilih bank â†’ Transfer â†’ Chat Admin WA â†’ Kirim bukti<br><strong style="color:var(--gold)">âœ¦ Coin masuk + Notifikasi otomatis</strong></div>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="panel" id="panel-history">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ“‹</div><div><div class="ctitle-text">History Upload</div><div class="ctitle-sub">Tap â˜… untuk kasih rating</div></div></div>
      <div class="hist-stats">
        <div class="stat-box"><div class="stat-num" id="statTotal">0</div><div class="stat-lbl">Total</div></div>
        <div class="stat-box"><div class="stat-num" id="statSuccess">0</div><div class="stat-lbl">Berhasil</div></div>
        <div class="stat-box"><div class="stat-num" id="statCoins">0</div><div class="stat-lbl">Coin</div></div>
      </div>
      <div class="search-history-wrap">
        <input class="history-search-input" id="histSearchInput" placeholder="ðŸ” Cari nama asset..." oninput="searchHistory()">
        <select class="history-filter-select" id="histTypeFilter" onchange="searchHistory()">
          <option value="all">Semua</option>
          <option value="Decal">ðŸ–¼ Decal</option>
          <option value="Audio">ðŸŽµ Audio</option>
          <option value="MeshPart">ðŸ“¦ Mesh</option>
        </select>
      </div>
      <div id="histList"><div class="hist-empty"><div class="hist-empty-ico">â—Ž</div><div class="hist-empty-t">Belum ada history.</div></div></div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="panel" id="panel-dashboard">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ“Š</div><div><div class="ctitle-text">Dashboard Statistik</div><div class="ctitle-sub">Analisis upload kamu</div></div></div>
      <div class="dash-stats">
        <div class="dash-stat s1"><div class="dash-stat-num" id="dashTotalUploads">0</div><div class="dash-stat-lbl">Total Upload</div></div>
        <div class="dash-stat s2"><div class="dash-stat-num" id="dashThisWeek">0</div><div class="dash-stat-lbl">Minggu Ini</div></div>
        <div class="dash-stat s3"><div class="dash-stat-num" id="dashAvgRating">â€”</div><div class="dash-stat-lbl">Avg Rating</div></div>
        <div class="dash-stat s4"><div class="dash-stat-num" id="dashRatedCount">0</div><div class="dash-stat-lbl">Sudah Dirating</div></div>
      </div>
      <div class="chart-wrap"><div class="chart-title">ðŸ“ˆ Upload 7 Hari Terakhir</div><div class="bar-chart" id="barChart"><div style="padding:20px;text-align:center;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">Memuat...</div></div></div>
      <div class="type-breakdown"><div class="type-breakdown-title">ðŸ“¦ Tipe Asset</div><div id="typeBreakdown"></div></div>
    </div>
  </div>

  <!-- LEADERBOARD -->
  <div class="panel" id="panel-leaderboard">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ†</div><div><div class="ctitle-text">Leaderboard</div><div class="ctitle-sub">Top uploader DEV Platform</div></div></div>
      <div id="leaderList"><div class="hist-empty"><div class="hist-empty-ico">ðŸ†</div><div class="hist-empty-t">Memuat...</div></div></div>
    </div>
  </div>

  <!-- REFERRAL -->
  <div class="panel" id="panel-referral">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸŽ</div><div><div class="ctitle-text">Program Referral</div><div class="ctitle-sub">Ajak teman, dapat bonus coin!</div></div></div>
      <div class="ref-card">
        <div class="ref-title">Kode Referral Kamu</div>
        <div class="ref-desc">Bagikan kode/link ini ke teman. Jika mereka daftar pakai link kamu:<br>âœ¦ Kamu dapat <strong style="color:var(--gold)">+5 Coin</strong> Â· Teman dapat <strong style="color:var(--green)">+3 Coin</strong> gratis!</div>
        <div class="ref-code-box"><span class="ref-code" id="myRefCode">â€”</span><button class="ref-copy" onclick="copyRefLink()">ðŸ“‹ Copy Link</button></div>
        <div class="ref-link-box" id="myRefLink" onclick="copyRefLink()">â€”</div>
        <div class="ref-stats">
          <div class="ref-stat"><div class="ref-stat-num" id="myRefCount">0</div><div class="ref-stat-lbl">Teman Diundang</div></div>
          <div class="ref-stat"><div class="ref-stat-num" id="myRefEarned">0</div><div class="ref-stat-lbl">Coin Earned</div></div>
        </div>
        <button class="btn-share-wa" onclick="shareRefWA()">ðŸ’¬ &nbsp; SHARE VIA WHATSAPP</button>
      </div>
      <div class="warnbox"><div class="warnbox-t">ðŸ“‹ Cara Kerja Referral</div>1. Copy link referral kamu<br>2. Bagikan ke teman<br>3. Teman daftar pakai link kamu<br>4. Kamu +5 Coin, teman +3 Coin otomatis!</div>
    </div>
  </div>

  <!-- MARKETPLACE -->
  <div class="panel" id="panel-market">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸª</div><div><div class="ctitle-text">Asset Marketplace</div><div class="ctitle-sub">Jual & beli asset dari developer lain</div></div></div>
      <!-- Filters -->
      <div class="market-filters">
        <div class="market-filter-chip on" id="mf-all" onclick="filterMarket('all',this)">ðŸŒ Semua</div>
        <div class="market-filter-chip" id="mf-Decal" onclick="filterMarket('Decal',this)">ðŸ–¼ Decal</div>
        <div class="market-filter-chip" id="mf-Audio" onclick="filterMarket('Audio',this)">ðŸŽµ Audio</div>
        <div class="market-filter-chip" id="mf-MeshPart" onclick="filterMarket('MeshPart',this)">ðŸ“¦ Mesh</div>
        <div class="market-filter-chip" id="mf-free" onclick="filterMarket('free',this)">ðŸ†“ Gratis</div>
      </div>
      <div style="display:flex;gap:8px;margin-bottom:12px">
        <input class="history-search-input" id="marketSearch" placeholder="ðŸ” Cari asset..." oninput="searchMarket()">
        <select class="history-filter-select" id="marketSort" onchange="renderMarket()">
          <option value="newest">Terbaru</option>
          <option value="cheapest">Termurah</option>
          <option value="popular">Terpopuler</option>
        </select>
      </div>
      <!-- Sell Box -->
      <div class="market-sell-box">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--green);letter-spacing:2px;margin-bottom:8px">ðŸ’¼ JUAL ASSET KAMU</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px">
          <div><div class="flabel" style="font-size:9px;margin-bottom:4px">Nama Asset</div><input class="finput" id="sellName" placeholder="Nama asset..." style="padding:8px 10px;font-size:11px"></div>
          <div><div class="flabel" style="font-size:9px;margin-bottom:4px">Asset ID Roblox</div><input class="finput" id="sellAssetId" placeholder="Asset ID..." style="padding:8px 10px;font-size:11px"></div>
          <div><div class="flabel" style="font-size:9px;margin-bottom:4px">Tipe</div>
            <select class="finput" id="sellType" style="padding:8px 10px;font-size:11px">
              <option>Decal</option><option>Audio</option><option>MeshPart</option>
            </select>
          </div>
          <div><div class="flabel" style="font-size:9px;margin-bottom:4px">Harga (Coin, 0=Gratis)</div><input class="finput" type="number" id="sellPrice" placeholder="5" min="0" style="padding:8px 10px;font-size:11px"></div>
        </div>
        <div><div class="flabel" style="font-size:9px;margin-bottom:4px">Deskripsi</div><input class="finput" id="sellDesc" placeholder="Deskripsi singkat..." style="padding:8px 10px;font-size:11px;margin-bottom:8px"></div>
        <button onclick="listAssetForSale()" style="padding:10px 20px;border:none;border-radius:10px;background:linear-gradient(135deg,rgba(0,229,160,0.2),rgba(0,229,160,0.08));border:1px solid rgba(0,229,160,0.3);color:var(--green);font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:2px;cursor:pointer">ðŸ’¼ LISTING SEKARANG</button>
      </div>
      <!-- Market Grid -->
      <div class="market-grid" id="marketGrid"></div>
      <div id="marketEmpty" style="display:none;text-align:center;padding:30px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">Belum ada asset di marketplace ðŸª</div>
    </div>
  </div>

  <!-- PROFILE -->
  <div class="panel" id="panel-profile">
    <div class="card"><div class="card-glow"></div>
      <div class="profile-hero" id="profileHero">
        <div class="profile-avatar-big" id="profileAvatarBig">âš¡</div>
        <div class="profile-name-big" id="profileNameBig">â€”</div>
        <div style="display:flex;gap:6px;justify-content:center;margin-top:6px" id="profileBadgesRow"></div>
        <div class="profile-joined" id="profileJoined">Bergabung â€”</div>
      </div>
      <div class="profile-stats-row">
        <div class="profile-stat-box"><div class="profile-stat-num" id="profStatUploads">0</div><div class="profile-stat-lbl">Upload</div></div>
        <div class="profile-stat-box"><div class="profile-stat-num" id="profStatCoins">0</div><div class="profile-stat-lbl">Coins</div></div>
        <div class="profile-stat-box"><div class="profile-stat-num" id="profStatRefs">0</div><div class="profile-stat-lbl">Referral</div></div>
      </div>
      <div class="profile-edit-box">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--gold);letter-spacing:2px;margin-bottom:10px">âœï¸ EDIT PROFIL</div>
        <div class="field"><div class="flabel">Display Name</div><input class="finput" id="profileDisplayName" placeholder="Nama kamu..."></div>
        <div class="field"><div class="flabel">Bio Singkat</div><input class="finput" id="profileBio" placeholder="Cerita tentang kamu..."></div>
        <div class="field"><div class="flabel">WhatsApp Number</div><input class="finput" id="profileWa" placeholder="628xxxx..." inputmode="numeric"></div>
        <button onclick="saveProfile()" style="width:100%;padding:12px;border:none;border-radius:11px;background:linear-gradient(135deg,rgba(201,168,76,0.2),rgba(201,168,76,0.06));border:1px solid rgba(201,168,76,0.3);color:var(--gold);font-family:'Bebas Neue',sans-serif;font-size:15px;letter-spacing:3px;cursor:pointer">ðŸ’¾ SIMPAN PROFIL</button>
      </div>
      <div class="admin-dash-card" style="margin-bottom:12px">
        <div class="admin-dash-title">ðŸ† Badges Kamu</div>
        <div id="profileBadgesFull" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- VIP MEMBERSHIP -->
  <div class="panel" id="panel-vip">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ‘‘</div><div><div class="ctitle-text">VIP Membership</div><div class="ctitle-sub">Upgrade akun, dapat lebih banyak!</div></div></div>
      <div class="current-vip-banner free" id="currentVipBanner">
        <div style="font-size:32px" id="currentVipIcon">âš¡</div>
        <div><div style="font-size:13px;font-weight:700" id="currentVipName">FREE</div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)" id="currentVipDesc">Akun standar</div></div>
      </div>
      <div class="vip-tiers">
        <div class="vip-tier free">
          <div class="vip-tier-shine"></div>
          <div class="vip-tier-head"><div><div class="vip-tier-name">âš¡ FREE</div><div class="vip-tier-price">Gratis selamanya</div></div><div class="vip-tier-icon">âš¡</div></div>
          <div class="vip-perks">
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> 1 Coin per upload</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Max 20MB per file</div>
            <div class="vip-perk"><span class="vip-perk-x">âœ—</span> Priority queue</div>
            <div class="vip-perk"><span class="vip-perk-x">âœ—</span> Bonus coin topup</div>
          </div>
          <button class="btn-vip-subscribe" disabled>Plan Saat Ini</button>
        </div>
        <div class="vip-tier silver">
          <div class="vip-tier-shine"></div>
          <div class="vip-tier-head"><div><div class="vip-tier-name">ðŸ¥ˆ SILVER</div><div class="vip-tier-price">Rp 15.000 / bulan</div></div><div class="vip-tier-icon">ðŸ¥ˆ</div></div>
          <div class="vip-perks">
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Semua fitur Free</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> +10% bonus coin topup</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Max 50MB per file</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Badge Silver eksklusif</div>
          </div>
          <button class="btn-vip-subscribe" onclick="subscribeVip('silver','Rp 15.000')">ðŸ¥ˆ Upgrade Silver</button>
        </div>
        <div class="vip-tier gold">
          <div class="vip-tier-shine"></div>
          <div class="vip-tier-head"><div><div class="vip-tier-name">ðŸ‘‘ GOLD</div><div class="vip-tier-price">Rp 30.000 / bulan</div></div><div class="vip-tier-icon">ðŸ‘‘</div></div>
          <div class="vip-perks">
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Semua fitur Silver</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> +25% bonus coin topup</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Priority upload queue</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Spin wheel 2x sehari</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Badge Gold eksklusif</div>
          </div>
          <button class="btn-vip-subscribe" onclick="subscribeVip('gold','Rp 30.000')">ðŸ‘‘ Upgrade Gold</button>
        </div>
        <div class="vip-tier diamond">
          <div class="vip-tier-shine"></div>
          <div class="vip-tier-head"><div><div class="vip-tier-name">ðŸ’Ž DIAMOND</div><div class="vip-tier-price">Rp 60.000 / bulan</div></div><div class="vip-tier-icon">ðŸ’Ž</div></div>
          <div class="vip-perks">
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Semua fitur Gold</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> +50% bonus coin topup</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Upload gratis 5x/hari</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Spin wheel 3x sehari</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Support prioritas 24/7</div>
            <div class="vip-perk"><span class="vip-perk-check">âœ“</span> Badge Diamond eksklusif</div>
          </div>
          <button class="btn-vip-subscribe" onclick="subscribeVip('diamond','Rp 60.000')">ðŸ’Ž Upgrade Diamond</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SPIN WHEEL -->
  <div class="panel" id="panel-spin">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸŽ°</div><div><div class="ctitle-text">Spin Wheel</div><div class="ctitle-sub">Putar wheel, menangkan coin gratis!</div></div></div>
      <div class="spin-wrap">
        <div class="spin-wheel-container">
          <div class="spin-pointer">â–¼</div>
          <canvas id="spinCanvas" class="spin-canvas" width="260" height="260"></canvas>
          <div class="spin-center">ðŸŽ°</div>
        </div>
        <div id="spinCooldownInfo" class="spin-cooldown">Loading...</div>
        <button class="btn-spin" id="btnSpin" onclick="doSpin()" disabled>ðŸŽ° PUTAR!</button>
        <div class="spin-result" id="spinResult"></div>
        <div class="spin-history" id="spinHistory"></div>
      </div>
    </div>
  </div>

  <!-- AUDIO EDITOR -->
  <div class="panel" id="panel-audio">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸŽµ</div><div><div class="ctitle-text">Audio Editor</div><div class="ctitle-sub">Edit audio agar lolos moderasi Roblox</div></div></div>

      <!-- DROP FILE -->
      <div class="dz" id="audioDz" style="margin-bottom:12px">
        <input type="file" id="audioFileInput" accept=".mp3,.ogg,.wav" onchange="loadAudioFile(this)">
        <div class="dz-orb">ðŸŽµ</div>
        <div class="dz-title">Drop file audio di sini</div>
        <div class="dz-sub">MP3 Â· OGG Â· WAV Â· Max 20MB</div>
      </div>

      <!-- AUDIO INFO -->
      <div class="audio-info-bar" id="audioInfoBar" style="display:none">
        <div class="ainfo-box"><div class="ainfo-val" id="aDuration">â€”</div><div class="ainfo-lbl">Durasi</div></div>
        <div class="ainfo-box"><div class="ainfo-val" id="aSampleRate">â€”</div><div class="ainfo-lbl">Sample Rate</div></div>
        <div class="ainfo-box"><div class="ainfo-val" id="aChannels">â€”</div><div class="ainfo-lbl">Channel</div></div>
        <div class="ainfo-box"><div class="ainfo-val" id="aFileSize">â€”</div><div class="ainfo-lbl">Ukuran</div></div>
      </div>

      <!-- WAVEFORM -->
      <div class="audio-editor" id="audioEditorMain" style="display:none">
        <div class="audio-editor-title">ðŸŽ› Waveform Editor</div>
        <div class="audio-editor-sub">Klik & drag untuk pilih area Â· Kanan klik untuk deselect</div>

        <div class="waveform-wrap" id="waveformWrap">
          <canvas id="waveformCanvas" class="waveform-canvas" height="80"></canvas>
          <div class="waveform-overlay">
            <div class="waveform-progress-bar" id="waveProgressBar"></div>
            <div class="waveform-cursor-line" id="waveformCursor" style="display:none"></div>
            <div class="waveform-sel" id="waveformSel" style="display:none"></div>
          </div>
        </div>

        <!-- PLAYBACK CONTROLS -->
        <div class="audio-controls">
          <button class="btn-audio" id="btnPlay" onclick="togglePlay()">â–¶ Play</button>
          <button class="btn-audio" onclick="stopAudio()">â–  Stop</button>
          <button class="btn-audio" id="btnLoop" onclick="toggleLoop()">ðŸ” Loop</button>
          <button class="btn-audio btn-audio-red" onclick="trimAudio()" id="btnTrim">âœ‚ Trim Seleksi</button>
          <button class="btn-audio btn-audio-red" onclick="resetAudio()">â†º Reset</button>
          <div class="audio-time-display" id="audioTimeDisplay">0:00 / 0:00</div>
        </div>

        <!-- SLIDERS -->
        <div class="audio-sliders">
          <div class="audio-slider-group">
            <div class="aslider-label">Volume <span class="aslider-val" id="volVal">100%</span></div>
            <input class="aslider" type="range" id="volSlider" min="0" max="200" value="100" oninput="updateVol(this.value)">
          </div>
          <div class="audio-slider-group">
            <div class="aslider-label">Pitch <span class="aslider-val" id="pitchVal">0 st</span></div>
            <input class="aslider" type="range" id="pitchSlider" min="-12" max="12" value="0" oninput="updatePitch(this.value)">
          </div>
          <div class="audio-slider-group">
            <div class="aslider-label">Speed <span class="aslider-val" id="speedVal">1.0x</span></div>
            <input class="aslider" type="range" id="speedSlider" min="50" max="200" value="100" oninput="updateSpeed(this.value)">
          </div>
          <div class="audio-slider-group">
            <div class="aslider-label">Fade In <span class="aslider-val" id="fadeInVal">0s</span></div>
            <input class="aslider" type="range" id="fadeInSlider" min="0" max="50" value="0" oninput="updateFadeIn(this.value)">
          </div>
          <div class="audio-slider-group">
            <div class="aslider-label">Fade Out <span class="aslider-val" id="fadeOutVal">0s</span></div>
            <input class="aslider" type="range" id="fadeOutSlider" min="0" max="50" value="0" oninput="updateFadeOut(this.value)">
          </div>
          <div class="audio-slider-group">
            <div class="aslider-label">Noise Level <span class="aslider-val" id="noiseVal">0%</span></div>
            <input class="aslider" type="range" id="noiseSlider" min="0" max="20" value="0" oninput="updateNoise(this.value)">
          </div>
        </div>

        <!-- EFFECTS -->
        <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:8px">âœ¨ Quick Effects</div>
        <div class="audio-effects-row">
          <div class="effect-chip" id="fx-reverse" onclick="toggleEffect('reverse')">â†© Reverse</div>
          <div class="effect-chip" id="fx-normalize" onclick="applyNormalize()">ðŸ“Š Normalize</div>
          <div class="effect-chip" id="fx-stereo" onclick="toggleEffect('stereo')">ðŸ”Š Stereo Enhance</div>
          <div class="effect-chip" id="fx-bass" onclick="toggleEffect('bass')">ðŸŽ¸ Bass Boost</div>
          <div class="effect-chip" id="fx-treble" onclick="toggleEffect('treble')">ðŸŽµ Treble Boost</div>
          <div class="effect-chip" id="fx-echo" onclick="toggleEffect('echo')">ðŸŒŠ Echo</div>
        </div>

        <!-- EXPORT -->
        <div class="export-box">
          <div class="export-title">ðŸ“¥ Export & Download</div>
          <div class="export-formats">
            <div class="fmt-btn sel" id="fmt-wav" onclick="selectFmt('wav')">WAV</div>
            <div class="fmt-btn" id="fmt-mp3" onclick="selectFmt('mp3')">MP3</div>
            <div class="fmt-btn" id="fmt-ogg" onclick="selectFmt('ogg')">OGG</div>
          </div>
          <button class="btn-export" id="btnExport" onclick="exportAudio()"><div class="shim"></div>ðŸ“¥ &nbsp; DOWNLOAD HASIL EDIT</button>
        </div>

        <div class="audio-tips-box">
          <div style="color:#f59e0b;font-weight:600;margin-bottom:4px">ðŸ’¡ Tips Lolos Moderasi Roblox</div>
          âœ¦ Tambah <strong>Noise 2-5%</strong> untuk mengacak fingerprint audio<br>
          âœ¦ Ubah <strong>Pitch Â±1-2 semitone</strong> supaya tidak terdeteksi sama<br>
          âœ¦ <strong>Speed 1.05x</strong> mengubah durasi sedikit<br>
          âœ¦ Tambah <strong>Fade In/Out</strong> di awal & akhir lagu<br>
          âœ¦ Kombinasi beberapa efek = lebih aman âš¡<br>
          âœ¦ Tidak ada jaminan 100% lolos â€” tergantung kebijakan Roblox
        </div>
      </div>
    </div>
  </div>

  <!-- BADGES -->

  <div class="panel" id="panel-badges">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ…</div><div><div class="ctitle-text">Badge & Achievement</div><div class="ctitle-sub">Kumpulkan badge, naik level!</div></div></div>
      <div class="xp-bar-wrap">
        <div class="xp-bar-top">
          <div><div class="xp-level">LVL <span id="userLevel">1</span></div><div class="xp-label">LEVEL KAMU</div></div>
          <div style="text-align:right"><div style="font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--gold2)"><span id="userXP">0</span> XP</div><div class="xp-label">TOTAL EXP</div></div>
        </div>
        <div class="xp-track"><div class="xp-fill" id="xpFill" style="width:0%"></div></div>
        <div class="xp-nums"><span id="xpCurrent">0</span><span id="xpNext">100</span></div>
      </div>
      <div class="badge-grid" id="badgeGrid">
        <div class="hist-empty" style="grid-column:1/-1"><div class="hist-empty-ico">â³</div></div>
      </div>
    </div>
  </div>

  <!-- MISSIONS -->
  <div class="panel" id="panel-missions">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸŽ¯</div><div><div class="ctitle-text">Daily & Weekly Mission</div><div class="ctitle-sub">Selesaikan misi, dapat coin!</div></div></div>
      <div class="mission-tabs">
        <button class="mission-tab active" onclick="switchMissionTab(this,'daily')">â˜€ï¸ Harian</button>
        <button class="mission-tab" onclick="switchMissionTab(this,'weekly')">ðŸ“… Mingguan</button>
      </div>
      <div class="mission-reset" id="missionReset">Reset dalam: <span id="missionCountdown">â€”</span></div>
      <div id="missionList"></div>
    </div>
  </div>


  <div class="panel" id="panel-support">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">ðŸ’¬</div><div><div class="ctitle-text">Support</div><div class="ctitle-sub">Kirim ticket ke admin</div></div></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Tipe Masalah</div>
        <select class="finput" id="ticketType">
          <option value="Bug Report">ðŸ› Bug Report</option>
          <option value="Pembayaran">ðŸ’° Masalah Pembayaran</option>
          <option value="Upload Error">ðŸ“¤ Upload Error</option>
          <option value="Pertanyaan">â“ Pertanyaan Umum</option>
          <option value="Fitur Baru">âœ¨ Request Fitur</option>
          <option value="Lainnya">ðŸ“ Lainnya</option>
        </select>
      </div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Subject</div><input class="finput" type="text" id="ticketSubject" placeholder="Ringkasan masalah..."></div>
      <div class="field"><div class="flabel"><span class="flabel-gem"></span> Pesan</div><textarea class="finput" id="ticketMsg" placeholder="Jelaskan detail masalahmu..."></textarea></div>
      <button class="btn-ticket" id="btnTicket" onclick="sendTicket()">ðŸ“¨ &nbsp; KIRIM TICKET</button>
      <div class="div"></div>
      <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:10px;">ðŸ“¬ Ticket Saya</div>
      <div id="myTicketList"><div style="text-align:center;padding:18px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">Buka tab Support untuk lihat ticket.</div></div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="panel" id="panel-settings">
    <div class="card"><div class="card-glow"></div>
      <div class="ctitle"><div class="ctitle-icon">âš™ï¸</div><div><div class="ctitle-text">Settings</div><div class="ctitle-sub">Konfigurasi akun kamu</div></div></div>
      <div class="settings-profile">
        <div class="settings-avatar-wrap" onclick="openAvatarPicker()">
          <div class="settings-avatar" id="settingsAvatar">âš¡</div>
          <div class="settings-avatar-edit">âœ</div>
        </div>
        <div><div class="settings-name" id="sDisplayName">â€”</div><div class="settings-email" id="sDisplayEmail">â€”</div><div class="settings-coins">âœ¦ <span id="sDisplayCoins">0</span> Coins</div></div>
      </div>
      <div class="settings-section">
        <div class="settings-section-title">ðŸ”” Notifikasi WhatsApp</div>
        <div class="wa-note">Masukkan nomor WA supaya admin bisa kirim notifikasi saat coin masuk atau ticket dibalas!</div>
        <div class="field"><div class="flabel"><span class="flabel-gem"></span> Nomor WhatsApp</div><input class="finput" type="tel" id="sWaNumber" placeholder="628123456789 (awali 62)"></div>
        <button class="btn-save-wa" onclick="saveWaNumber()">ðŸ“± &nbsp; SIMPAN NOMOR WA</button>
      </div>
      <div class="settings-section">
        <div class="settings-section-title">ðŸŽ® Roblox Config</div>
        <div class="save-note">âœ“ Isi sekali, tersimpan otomatis. Tidak perlu isi ulang setiap upload!</div>
        <div class="field"><div class="flabel"><span class="flabel-gem"></span> Roblox User ID</div><input class="finput" type="text" id="sUserId" placeholder="Contoh: 3493541426" inputmode="numeric"></div>
        <div class="field"><div class="flabel"><span class="flabel-gem"></span> Open Cloud API Key</div><input class="finput" type="password" id="sApiKey" placeholder="Paste API Key kamu..."></div>
        <div class="field"><div class="flabel"><span class="flabel-gem"></span> Default Tipe Asset</div>
          <select class="finput" id="sDefType"><option value="Decal">ðŸ–¼ Image / Decal</option><option value="Audio">ðŸŽµ Audio</option><option value="MeshPart">ðŸ“¦ Mesh</option></select>
        </div>
      </div>
      <div class="settings-section">
        <div class="settings-section-title">ðŸ”’ Keamanan</div>
        <div class="toggle-row"><div class="toggle-label">Tampilkan API Key<span>Lihat API Key sebagai teks</span></div><label class="toggle"><input type="checkbox" id="sShowApiKey" onchange="toggleApiKeyVisibility()"><span class="toggle-slider"></span></label></div>
      </div>
      <button class="btn-save-settings" onclick="saveSettings()"><div class="shim"></div>ðŸ’¾ &nbsp; SIMPAN SETTINGAN</button>
      <button class="btn-clear-settings" onclick="clearSettings()">ðŸ—‘ Hapus Semua Settingan</button>
    </div>
  </div>

  <div class="footer"><span class="footer-gem">âœ¦</span> DEV UPLOADER <span class="footer-gem">âœ¦</span><br>Premium Edition Â· Firebase Powered</div>
</div>
</div>

<!-- PREVIEW MODAL -->
<div class="preview-modal" id="previewModal">
  <div class="preview-box">
    <button class="preview-close" onclick="closePreview()">âœ•</button>
    <div class="preview-title">ðŸ–¼ï¸ PREVIEW ASSET</div>
    <div class="preview-sub" id="previewFileName">â€”</div>
    <div id="previewContent"></div>
    <div class="preview-file-info" id="previewInfo"></div>
    <button class="btn-preview-upload" onclick="confirmUploadFromPreview()">âš¡ UPLOAD SEKARANG</button>
  </div>
</div>

<!-- SHARE MODAL -->
<div class="share-modal" id="shareModal">
  <div class="share-box">
    <button class="share-close" onclick="closeShare()">âœ•</button>
    <div class="share-title">ðŸ”— SHARE ASSET</div>
    <div class="share-asset-name" id="shareAssetName">â€”</div>
    <div class="share-link-wrap">
      <input class="share-link-input" id="shareLinkInput" readonly>
      <button class="btn-copy-link" onclick="copyShareLink()">ðŸ“‹ Copy</button>
    </div>
    <div class="share-platforms">
      <div class="share-platform-btn" onclick="shareToWA()"><span class="share-platform-icon">ðŸ’¬</span>WhatsApp</div>
      <div class="share-platform-btn" onclick="shareToTelegram()"><span class="share-platform-icon">âœˆï¸</span>Telegram</div>
      <div class="share-platform-btn" onclick="shareToTwitter()"><span class="share-platform-icon">ðŸ¦</span>Twitter/X</div>
    </div>
  </div>
</div>

<!-- REAL-TIME NOTIF POPUP -->
<div class="notif-toast-popup" id="notifToastPopup">
  <div class="notif-toast-icon" id="notifToastIcon">ðŸ””</div>
  <div class="notif-toast-title" id="notifToastTitle">â€”</div>
  <div class="notif-toast-msg" id="notifToastMsg">â€”</div>
</div>

<!-- DARK MODE TOGGLE -->
<div class="dark-mode-toggle" id="darkModeToggle" onclick="toggleDarkMode()" title="Toggle Dark/Light Mode">ðŸŒ™</div>

<!-- LIVE CHAT FAB -->
<button class="chat-fab" id="chatFab" onclick="toggleChat()">ðŸ’¬<div class="chat-fab-badge" id="chatFabBadge">0</div></button>

<!-- LIVE CHAT WINDOW -->
<div class="chat-window" id="chatWindow">
  <div class="chat-hdr">
    <div class="chat-hdr-avatar">ðŸ‘‘</div>
    <div class="chat-hdr-info">
      <div class="chat-hdr-name">Admin DEV</div>
      <div class="chat-hdr-status"><div class="chat-online-dot"></div> Online Â· Biasanya balas cepat</div>
    </div>
    <button class="chat-close" onclick="toggleChat()">âœ•</button>
  </div>
  <div class="chat-messages" id="chatMessages">
    <div class="chat-empty">ðŸ’¬ Chat langsung dengan Admin.<br>Tanya apapun tentang DEV Uploader!</div>
  </div>
  <div class="chat-typing" id="chatTyping">Admin sedang mengetik...</div>
  <div class="chat-input-row">
    <input class="chat-input" id="chatInput" placeholder="Ketik pesan..." onkeydown="if(event.key==='Enter')sendChatMsg()">
    <button class="chat-send" onclick="sendChatMsg()">âž¤</button>
  </div>
</div>


<div id="screen-admin">
<div class="admin-wrap">
  <div class="admin-header">
    <div class="admin-title">ðŸ‘‘ ADMIN PANEL</div>
    <div style="display:flex;gap:8px;align-items:center">
      <div id="adminOnlineBadge" style="display:flex;align-items:center;gap:5px;font-family:'DM Mono',monospace;font-size:10px;color:var(--green);padding:5px 10px;background:rgba(0,229,160,0.06);border:1px solid rgba(0,229,160,0.2);border-radius:8px"><span style="width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;box-shadow:0 0 6px var(--green)"></span><span id="onlineCount">0</span> online</div>
      <button class="btn-sm btn-sm-gold" onclick="goApp()">â† Kembali</button>
    </div>
  </div>

  <!-- ADMIN TABS -->
  <div style="display:flex;gap:6px;overflow-x:auto;padding-bottom:8px;margin-bottom:14px;scrollbar-width:none">
    <button class="admin-tab-btn active" id="atab-overview" onclick="switchAdminTab('overview',this)">ðŸ“Š Overview</button>
    <button class="admin-tab-btn" id="atab-analytics" onclick="switchAdminTab('analytics',this)">ðŸ“ˆ Analytics</button>
    <button class="admin-tab-btn" id="atab-users" onclick="switchAdminTab('users',this)">ðŸ‘¥ Users</button>
    <button class="admin-tab-btn" id="atab-orders" onclick="switchAdminTab('orders',this)">ðŸ“¦ Orders</button>
    <button class="admin-tab-btn" id="atab-tickets" onclick="switchAdminTab('tickets',this)">ðŸŽ« Tickets</button>
    <button class="admin-tab-btn" id="atab-broadcast" onclick="switchAdminTab('broadcast',this)">ðŸ“¢ Broadcast</button>
    <button class="admin-tab-btn" id="atab-promo" onclick="switchAdminTab('promo',this)">ðŸŽŸï¸ Promo</button>
    <button class="admin-tab-btn" id="atab-chat" onclick="switchAdminTab('chat',this)">ðŸ’¬ Chat</button>
    <button class="admin-tab-btn" id="atab-uploads" onclick="switchAdminTab('uploads',this)">ðŸ“¤ Uploads</button>
    <button class="admin-tab-btn" id="atab-vip" onclick="switchAdminTab('vip',this)">ðŸ‘‘ VIP</button>
  </div>

  <div id="adminLoading"><span class="spinner spinner-light"></span> Memuat data...</div>
  <div id="adminContent" style="display:none">

    <!-- â•â•â• OVERVIEW â•â•â• -->
    <div class="admin-panel-section" id="asec-overview">
      <div class="admin-stats">
        <div class="admin-stat u"><div class="admin-stat-num" id="adminStatUsers">0</div><div class="admin-stat-lbl">Users</div></div>
        <div class="admin-stat o"><div class="admin-stat-num" id="adminStatOrders">0</div><div class="admin-stat-lbl">Orders</div></div>
        <div class="admin-stat up"><div class="admin-stat-num" id="adminStatUploads">0</div><div class="admin-stat-lbl">Uploads</div></div>
        <div class="admin-stat p"><div class="admin-stat-num" id="adminStatPending">0</div><div class="admin-stat-lbl">Pending</div></div>
        <div class="admin-stat r"><div class="admin-stat-num" id="adminStatRevenue" style="font-size:16px">Rp 0</div><div class="admin-stat-lbl">Revenue</div></div>
        <div class="admin-stat t"><div class="admin-stat-num" id="adminStatTickets">0</div><div class="admin-stat-lbl">Tickets</div></div>
      </div>
      <!-- Quick stats row -->
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px">
        <div class="admin-dash-card"><div class="admin-dash-title">ðŸ†• New Users Today</div><div class="admin-stat-num" id="adminStatNewToday" style="font-size:24px;color:var(--teal)">0</div></div>
        <div class="admin-dash-card"><div class="admin-dash-title">ðŸ’° Revenue Today</div><div class="admin-stat-num" id="adminStatRevToday" style="font-size:18px;color:var(--green)">Rp 0</div></div>
        <div class="admin-dash-card"><div class="admin-dash-title">ðŸ“¤ Uploads Today</div><div class="admin-stat-num" id="adminStatUpToday" style="font-size:24px;color:var(--purple)">0</div></div>
        <div class="admin-dash-card"><div class="admin-dash-title">ðŸ”“ Open Tickets</div><div class="admin-stat-num" id="adminStatOpenTickets" style="font-size:24px;color:var(--red)">0</div></div>
      </div>
      <button class="admin-refresh" onclick="loadAdminData()">ðŸ”„ &nbsp; Refresh Data</button>
      <!-- Recent activity -->
      <div class="admin-section" style="margin-top:12px">
        <div class="admin-section-title">âš¡ Aktivitas Terbaru</div>
        <div id="adminRecentActivity"></div>
      </div>
    </div>

    <!-- â•â•â• ANALYTICS â•â•â• -->
    <div class="admin-panel-section" id="asec-analytics" style="display:none">
      <div class="admin-section">
        <div class="admin-section-title">ðŸ“ˆ Revenue 6 Bulan</div>
        <div class="rev-chart-wrap"><canvas id="adminRevChart" style="width:100%;height:140px;display:block"></canvas></div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ‘¥ Registrasi User (7 Hari)</div>
        <div class="rev-chart-wrap"><canvas id="adminUserChart" style="width:100%;height:120px;display:block"></canvas></div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ“¤ Upload Activity (28 Hari)</div>
        <div class="admin-dash-grid">
          <div class="admin-dash-card">
            <div class="admin-dash-title">Upload Heatmap</div>
            <div class="heatmap-label" id="heatmapDays"></div>
            <div class="activity-heatmap" id="activityHeatmap"></div>
          </div>
          <div class="admin-dash-card">
            <div class="admin-dash-title">Asset Type Split</div>
            <div id="adminTypeChart"></div>
          </div>
        </div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ‘¤ User Retention</div>
        <div id="retentionChart"></div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ’¹ Revenue Bulanan</div>
        <div class="chart-wrap"><div class="bar-chart" id="revenueChart"></div></div>
      </div>
    </div>

    <!-- â•â•â• USERS â•â•â• -->
    <div class="admin-panel-section" id="asec-users" style="display:none">
      <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
        <input class="finput" id="adminUserSearch" placeholder="ðŸ” Cari nama / email..." style="flex:1;min-width:150px;padding:9px 12px;font-size:12px" oninput="filterAdminUsers()">
        <select class="finput" id="adminUserFilter" style="padding:9px 12px;font-size:12px" onchange="filterAdminUsers()">
          <option value="all">Semua</option>
          <option value="active">Aktif</option>
          <option value="banned">Banned</option>
          <option value="vip">VIP</option>
        </select>
      </div>
      <div id="adminUserStats" style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap"></div>
      <div id="adminUserList"></div>
    </div>

    <!-- â•â•â• ORDERS â•â•â• -->
    <div class="admin-panel-section" id="asec-orders" style="display:none">
      <div style="display:flex;gap:8px;margin-bottom:10px">
        <select class="finput" id="adminOrderFilter" style="padding:9px 12px;font-size:12px;flex:1" onchange="filterAdminOrders()">
          <option value="all">Semua Order</option>
          <option value="pending">â³ Pending</option>
          <option value="confirmed">âœ… Confirmed</option>
          <option value="rejected">âŒ Rejected</option>
        </select>
      </div>
      <div id="adminOrderList"></div>
    </div>

    <!-- â•â•â• TICKETS â•â•â• -->
    <div class="admin-panel-section" id="asec-tickets" style="display:none">
      <div style="display:flex;gap:8px;margin-bottom:10px">
        <select class="finput" id="adminTicketFilter" style="padding:9px 12px;font-size:12px;flex:1" onchange="filterAdminTickets()">
          <option value="all">Semua</option>
          <option value="open">â³ Open</option>
          <option value="replied">ðŸ’¬ Replied</option>
          <option value="closed">âœ… Closed</option>
        </select>
      </div>
      <div id="adminTicketList"></div>
    </div>

    <!-- â•â•â• BROADCAST â•â•â• -->
    <div class="admin-panel-section" id="asec-broadcast" style="display:none">
      <div class="admin-section">
        <div class="admin-section-title">ðŸ“¢ Kirim Broadcast</div>
        <div class="broadcast-box">
          <div style="display:grid;grid-template-columns:80px 1fr;gap:8px;margin-bottom:8px">
            <div class="field" style="margin:0"><div class="flabel">Icon</div><input class="finput" type="text" id="broadIcon" placeholder="ðŸ“¢" style="font-size:18px;text-align:center"></div>
            <div class="field" style="margin:0"><div class="flabel">Target</div>
              <select class="finput" id="broadTarget" style="padding:10px 12px;font-size:12px">
                <option value="all">ðŸŒ Semua User</option>
                <option value="vip">ðŸ‘‘ VIP Users Only</option>
                <option value="active">âœ… User Aktif (30 hari)</option>
              </select>
            </div>
          </div>
          <div class="field"><div class="flabel">Judul</div><input class="finput" type="text" id="broadTitle" placeholder="Judul broadcast..."></div>
          <div class="field"><div class="flabel">Pesan</div><textarea class="finput" id="broadMsg" placeholder="Isi pesan..." style="min-height:80px;resize:vertical"></textarea></div>
          <div style="display:flex;gap:8px">
            <button class="btn-broadcast" id="btnBroadcast" onclick="sendBroadcast()" style="flex:1">ðŸ“¢ KIRIM BROADCAST</button>
            <button class="btn-broadcast" onclick="previewBroadcast()" style="background:rgba(255,255,255,0.05);border:1px solid var(--rim);color:var(--muted);flex:1">ðŸ‘ PREVIEW</button>
          </div>
        </div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ“‹ Riwayat Broadcast</div>
        <div id="broadcastHistory"></div>
      </div>
    </div>

    <!-- â•â•â• PROMO â•â•â• -->
    <div class="admin-panel-section" id="asec-promo" style="display:none">
      <div class="admin-section">
        <div class="admin-section-title">ðŸŽŸï¸ Buat Kode Promo</div>
        <div class="broadcast-box">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div class="field" style="margin-bottom:8px"><div class="flabel">Kode</div><input class="finput" id="promoCode" placeholder="HEMAT20" style="text-transform:uppercase"></div>
            <div class="field" style="margin-bottom:8px"><div class="flabel">+Coin Bonus</div><input class="finput" type="number" id="promoBonusCoin" placeholder="10"></div>
            <div class="field" style="margin-bottom:8px"><div class="flabel">Diskon (%)</div><input class="finput" type="number" id="promoDiscount" placeholder="0" min="0" max="100"></div>
            <div class="field" style="margin-bottom:8px"><div class="flabel">Max Pakai</div><input class="finput" type="number" id="promoMaxUses" placeholder="0=âˆž"></div>
            <div class="field" style="margin-bottom:8px"><div class="flabel">Expired (opsional)</div><input class="finput" type="date" id="promoExpiry"></div>
            <div class="field" style="margin-bottom:8px"><div class="flabel">Deskripsi</div><input class="finput" id="promoDesc" placeholder="Deskripsi promo..."></div>
          </div>
          <button class="btn-broadcast" onclick="createPromo()">ðŸŽŸï¸ BUAT KODE PROMO</button>
        </div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ“‹ Daftar Promo Aktif</div>
        <div id="promoList"></div>
      </div>
    </div>

    <!-- â•â•â• CHAT â•â•â• -->
    <div class="admin-panel-section" id="asec-chat" style="display:none">
      <div style="display:grid;grid-template-columns:1fr 1.8fr;gap:10px;min-height:400px">
        <div>
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:8px">CONVERSATIONS</div>
          <div id="adminChatList"></div>
        </div>
        <div>
          <div id="adminChatWindowWrap" style="display:none">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;padding:8px 12px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px solid var(--rim)">
              <div style="font-size:12px;font-weight:700;color:var(--teal)" id="adminChatTarget">â€”</div>
              <button class="btn-set-coin" onclick="document.getElementById('adminChatWindowWrap').style.display='none';document.getElementById('adminChatWindowWrap').style.display='none'">âœ•</button>
            </div>
            <div class="admin-chat-window">
              <div class="admin-chat-msgs" id="adminChatMsgs"></div>
              <div style="display:flex;gap:7px;margin-top:8px">
                <input class="finput" id="adminChatInput" placeholder="Ketik balasan..." style="flex:1;padding:9px 12px;font-size:12px" onkeydown="if(event.key==='Enter')adminSendChat()">
                <button class="btn-confirm-order" onclick="adminSendChat()">Kirim âœˆ</button>
              </div>
            </div>
          </div>
          <div id="adminChatEmpty" style="display:flex;align-items:center;justify-content:center;height:300px;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);text-align:center">Pilih percakapan<br>untuk membalas ðŸ’¬</div>
        </div>
      </div>
    </div>

    <!-- â•â•â• UPLOADS â•â•â• -->
    <div class="admin-panel-section" id="asec-uploads" style="display:none">
      <div style="display:flex;gap:8px;margin-bottom:10px">
        <input class="finput" id="adminUploadSearch" placeholder="ðŸ” Cari nama asset..." style="flex:1;padding:9px 12px;font-size:12px" oninput="filterAdminUploads()">
        <select class="finput" id="adminUploadTypeFilter" style="padding:9px 12px;font-size:12px" onchange="filterAdminUploads()">
          <option value="all">Semua</option>
          <option value="Decal">ðŸ–¼ Decal</option>
          <option value="Audio">ðŸŽµ Audio</option>
          <option value="MeshPart">ðŸ“¦ Mesh</option>
        </select>
      </div>
      <div id="adminUploadList"></div>
    </div>

    <!-- â•â•â• VIP MANAGEMENT â•â•â• -->
    <div class="admin-panel-section" id="asec-vip" style="display:none">
      <div class="admin-section">
        <div class="admin-section-title">ðŸ‘‘ Kelola VIP User</div>
        <div id="adminVipList"></div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ðŸ“Š VIP Stats</div>
        <div id="adminVipStats" style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px"></div>
      </div>
    </div>

  </div><!-- end adminContent -->
  <div class="footer"><span class="footer-gem">âœ¦</span> DEV UPLOADER ADMIN <span class="footer-gem">âœ¦</span></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, orderBy, getDocs, addDoc, serverTimestamp, increment, where, limit, writeBatch, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const firebaseConfig={apiKey:"AIzaSyDyi8FXoJDf-_VvMkmnHcQ7dBGKPJULnmc",authDomain:"dev-uploader-5bd4b.firebaseapp.com",projectId:"dev-uploader-5bd4b",storageBucket:"dev-uploader-5bd4b.firebasestorage.app",messagingSenderId:"534864483602",appId:"1:534864483602:web:965fdae6f377e2239b0fcb"};
const ADMIN_EMAIL='rhokimkecil@gmail.com',ADMIN_WA='6287729035761';
const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app),googleProvider=new GoogleAuthProvider();
let currentUser=null,currentUserData=null,isAdmin=false;

// PWA
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;document.getElementById('pwaBtn').style.display='flex';});
window.installPWA=async function(){if(!deferredPrompt)return toast('Sudah terinstall atau tidak support PWA');deferredPrompt.prompt();const{outcome}=await deferredPrompt.userChoice;if(outcome==='accepted')toast('âœ“ App berhasil diinstall!');deferredPrompt=null;document.getElementById('pwaBtn').style.display='none';};

// AUTH
onAuthStateChanged(auth,async user=>{
  if(user){currentUser=user;await loadUserData(user);showApp();}
  else{currentUser=null;currentUserData=null;isAdmin=false;showAuth();}
});
async function loadUserData(user){
  const ref=doc(db,'users',user.uid),snap=await getDoc(ref);
  if(!snap.exists()){
    const isAdm=user.email===ADMIN_EMAIL,rc=genCode(user.uid);
    const pendRef=localStorage.getItem('dev_pending_referral');
    let coins=isAdm?999:0;if(pendRef&&!isAdm)coins+=3;
    await setDoc(ref,{uid:user.uid,email:user.email,name:user.displayName||user.email.split('@')[0],coins,totalUploads:0,createdAt:serverTimestamp(),isAdmin:isAdm,waNumber:'',referralCode:rc,referralCount:0,referralEarned:0,avatarEmoji:'âš¡',isBanned:false});
    currentUserData={coins,name:user.displayName||user.email.split('@')[0],isAdmin:isAdm,totalUploads:0,waNumber:'',referralCode:rc,referralCount:0,referralEarned:0,avatarEmoji:'âš¡',isBanned:false};
    if(pendRef&&!isAdm){try{const rs=await getDocs(query(collection(db,'users'),where('referralCode','==',pendRef)));if(!rs.empty){const rd=rs.docs[0];await updateDoc(doc(db,'users',rd.id),{coins:increment(5),referralCount:increment(1),referralEarned:increment(5)});await addDoc(collection(db,'referrals'),{referrerId:rd.id,newUserId:user.uid,newUserEmail:user.email,code:pendRef,createdAt:serverTimestamp()});await addDoc(collection(db,'notifications'),{uid:rd.id,title:'ðŸŽ Referral Bonus!',message:`+5 Coin dari referral ke ${user.email}`,icon:'ðŸŽ',read:false,createdAt:serverTimestamp()});}}catch(e){}localStorage.removeItem('dev_pending_referral');}
  } else {
    currentUserData=snap.data();
    if(user.email===ADMIN_EMAIL&&!currentUserData.isAdmin){await updateDoc(ref,{isAdmin:true});currentUserData.isAdmin=true;}
    if(!currentUserData.referralCode){const rc=genCode(user.uid);await updateDoc(ref,{referralCode:rc});currentUserData.referralCode=rc;}
    if(!currentUserData.avatarEmoji){await updateDoc(ref,{avatarEmoji:'âš¡'});currentUserData.avatarEmoji='âš¡';}
  }
  isAdmin=currentUserData.isAdmin===true;
  if(currentUserData.isBanned&&!isAdmin){await signOut(auth);alert('Akun kamu disuspend. Hubungi admin.');return;}
  const up=new URLSearchParams(window.location.search);const rf=up.get('ref');if(rf)localStorage.setItem('dev_pending_referral',rf);
}
function genCode(uid){return'DEV'+uid.slice(-6).toUpperCase();}
function showAuth(){
  // Show landing page first if user never visited
  const visited=localStorage.getItem('dev_visited');
  if(!visited){
    localStorage.setItem('dev_visited','1');
    document.getElementById('screen-landing').style.display='block';
    document.getElementById('screen-auth').style.display='none';
    // Load live stats for landing
    Promise.all([getDocs(collection(db,'users')),getDocs(collection(db,'uploads'))]).then(([u,up])=>{
      const uel=document.getElementById('landingStatUsers');const upel=document.getElementById('landingStatUploads');
      if(uel)uel.textContent=u.size+'+';if(upel)upel.textContent=up.size+'+';
    }).catch(()=>{});
  } else {
    document.getElementById('screen-landing').style.display='none';
    document.getElementById('screen-auth').style.display='flex';
  }
  document.getElementById('screen-app').style.display='none';
  document.getElementById('screen-admin').style.display='none';
  stopCanvas();
}
function showApp(){
  document.getElementById('screen-auth').style.display='none';
  document.getElementById('screen-app').style.display='block';
  document.getElementById('screen-admin').style.display='none';
  startCanvas(); updateUI(); loadHistory(); loadSettings(); loadNotifications();
  document.getElementById('adminTabBtn').style.display=isAdmin?'flex':'none';
  document.getElementById('chatFab').style.display='flex';
  initChat(); checkMissionProgress(); checkBadges();
  startMissionCountdown();
}

// â•â• EMAILJS INIT â•â•
// Setup: https://www.emailjs.com/ â€” ganti dengan Service ID & Template ID kamu
const EMAILJS_SERVICE = 'YOUR_SERVICE_ID';
const EMAILJS_TEMPLATE = 'YOUR_TEMPLATE_ID';
const EMAILJS_PUBLIC = 'YOUR_PUBLIC_KEY';
async function sendEmailNotif(toEmail, toName, subject, message) {
  try {
    if (typeof emailjs === 'undefined') return;
    emailjs.init(EMAILJS_PUBLIC);
    await emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, {
      to_email: toEmail, to_name: toName, subject, message,
      from_name: 'DEV Uploader'
    });
  } catch(e) { console.log('EmailJS:', e.message); }
}
window.sendEmailNotif = sendEmailNotif;

// â•â• PAYMENT METHOD TOGGLE â•â•
window.switchPaymentMethod = function(method) {
  document.getElementById('pmTabManual').classList.toggle('active', method==='manual');
  document.getElementById('pmTabMidtrans').classList.toggle('active', method==='midtrans');
  document.getElementById('manualPaySection').style.display = method==='manual'?'block':'none';
  document.getElementById('midtransSection').style.display = method==='midtrans'?'block':'none';
}

// â•â• MIDTRANS INTEGRATION â•â•
window.openMidtrans = async function(coins, amount) {
  if (!currentUser) return toast('âš  Login dulu!');
  const orderId = 'DEV-'+Date.now().toString(36).toUpperCase();
  await addDoc(collection(db,'orders'),{
    uid:currentUser.uid, userEmail:currentUser.email, userName:currentUserData.name,
    orderId, coins, price:'Rp '+amount.toLocaleString('id-ID'),
    method:'Midtrans', status:'pending_midtrans', createdAt:serverTimestamp()
  });
  document.getElementById('modalBg').classList.add('show');
  document.getElementById('modalInner').innerHTML = `
    <div class="modal-title">âš¡ Auto Payment</div>
    <div class="modal-sub">Midtrans Payment Gateway</div>
    <div class="modal-order">
      <div class="modal-order-left"><div class="label">Paket</div><div class="val">${coins} Coins</div></div>
      <div class="modal-order-right"><div class="label">Total</div><div class="val">Rp ${amount.toLocaleString('id-ID')}</div></div>
    </div>
    <div style="background:rgba(0,229,200,0.05);border:1px solid rgba(0,229,200,0.2);border-radius:12px;padding:14px;margin-bottom:14px;font-family:'DM Mono',monospace;font-size:11px;color:rgba(0,229,200,0.7);line-height:1.8">
      <strong style="color:var(--teal)">ðŸ”§ Setup Midtrans:</strong><br>
      1. Daftar di <a href="https://midtrans.com" target="_blank" style="color:var(--teal)">midtrans.com</a><br>
      2. Buat endpoint <code>/api/midtrans-token</code> di Vercel<br>
      3. Endpoint generate Snap token â†’ aktif otomatis<br><br>
      <strong style="color:var(--gold)">Order ID: ${orderId}</strong>
    </div>
    <button class="btn-confirm" onclick="closeModal()" style="background:rgba(255,255,255,0.05);border:1px solid var(--rim);color:var(--muted)">Tutup</button>
  `;
  toast('Order dibuat: '+orderId);
}

// â•â• LIVE CHAT â•â•
let chatUnsubscribe = null, currentChatRoom = null;

function getChatRoomId(uid) { return ['chat', uid].sort().join('_'); }

async function initChat() {
  if (!currentUser) return;
  const roomId = isAdmin ? null : getChatRoomId(currentUser.uid);
  if (!isAdmin && roomId) {
    // Listen for new messages for badge
    const chatRef = collection(db, 'chats', currentUser.uid, 'messages');
    const adminChatRef = collection(db, 'chats', 'admin_'+currentUser.uid, 'messages');
  }
  // Check unread
  checkChatUnread();
}

async function checkChatUnread() {
  if (!currentUser || isAdmin) return;
  try {
    const q = query(collection(db,'chats',currentUser.uid,'messages'), where('sender','==','admin'), where('read','==',false));
    const snap = await getDocs(q);
    const badge = document.getElementById('chatFabBadge');
    if (badge) { badge.textContent = snap.size; badge.style.display = snap.size > 0 ? 'flex' : 'none'; }
  } catch(e) {}
}

window.toggleChat = function() {
  const win = document.getElementById('chatWindow');
  win.classList.toggle('open');
  if (win.classList.contains('open')) { loadChatMessages(); markChatRead(); }
}

async function loadChatMessages() {
  if (!currentUser) return;
  const el = document.getElementById('chatMessages');
  try {
    const q = query(collection(db,'chats',currentUser.uid,'messages'), orderBy('createdAt','asc'), limit(50));
    if (chatUnsubscribe) chatUnsubscribe();
    chatUnsubscribe = onSnapshot(q, snap => {
      const msgs = []; snap.forEach(d => msgs.push({id:d.id,...d.data()}));
      if (!msgs.length) {
        el.innerHTML = '<div class="chat-empty">ðŸ’¬ Chat langsung dengan Admin.<br>Tanya apapun tentang DEV Uploader!</div>';
        return;
      }
      el.innerHTML = msgs.map(m => `
        <div class="chat-msg ${m.sender==='user'?'mine':''}">
          <div class="chat-msg-avatar">${m.sender==='user'?(currentUserData?.avatarEmoji||'âš¡'):'ðŸ‘‘'}</div>
          <div>
            ${m.sender==='admin'?`<div class="chat-msg-sender">Admin DEV</div>`:''}
            <div class="chat-msg-body">
              <div class="chat-msg-text">${m.text}</div>
              <div class="chat-msg-time">${m.createdAt?.toDate?m.createdAt.toDate().toLocaleString('id-ID',{hour:'2-digit',minute:'2-digit'}):'Baru saja'}</div>
            </div>
          </div>
        </div>`).join('');
      el.scrollTop = el.scrollHeight;
      checkChatUnread();
    });
  } catch(e) { el.innerHTML = '<div class="chat-empty">Gagal memuat chat.</div>'; }
}

async function markChatRead() {
  if (!currentUser) return;
  try {
    const q = query(collection(db,'chats',currentUser.uid,'messages'), where('sender','==','admin'), where('read','==',false));
    const snap = await getDocs(q);
    const batch = writeBatch(db);
    snap.docs.forEach(d => batch.update(d.ref, {read:true}));
    await batch.commit();
    checkChatUnread();
  } catch(e) {}
}

window.sendChatMsg = async function() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text || !currentUser) return;
  input.value = '';
  try {
    await addDoc(collection(db,'chats',currentUser.uid,'messages'), {
      text, sender:'user', senderName:currentUserData.name,
      senderAvatar:currentUserData.avatarEmoji||'âš¡',
      read:false, createdAt:serverTimestamp()
    });
    // Update chat meta for admin to see
    await setDoc(doc(db,'chatMeta',currentUser.uid), {
      uid:currentUser.uid, userEmail:currentUser.email, userName:currentUserData.name,
      avatarEmoji:currentUserData.avatarEmoji||'âš¡', lastMsg:text,
      lastMsgAt:serverTimestamp(), unreadAdmin:increment(1)
    }, {merge:true});
    // Check mission: send first chat
    await updateMissionProgress('send_chat', 1);
  } catch(e) { toast('âš  Gagal kirim pesan'); }
}

// Admin chat functions
window.openAdminChat = async function(uid, userName) {
  document.getElementById('adminChatWindowWrap').style.display = 'block';
  document.getElementById('adminChatTarget').textContent = 'ðŸ’¬ Chat dengan: '+userName;
  currentChatRoom = uid;
  const msgsEl = document.getElementById('adminChatMsgs');
  // Mark admin unread as read
  try { await updateDoc(doc(db,'chatMeta',uid), {unreadAdmin:0}); } catch(e) {}
  const q = query(collection(db,'chats',uid,'messages'), orderBy('createdAt','asc'), limit(50));
  if (chatUnsubscribe) chatUnsubscribe();
  chatUnsubscribe = onSnapshot(q, snap => {
    const msgs=[]; snap.forEach(d=>msgs.push({id:d.id,...d.data()}));
    msgsEl.innerHTML = msgs.map(m=>`
      <div class="chat-msg ${m.sender==='admin'?'mine':''}">
        <div class="chat-msg-avatar">${m.sender==='admin'?'ðŸ‘‘':(m.senderAvatar||'âš¡')}</div>
        <div>
          <div class="chat-msg-body">
            <div class="chat-msg-text">${m.text}</div>
            <div class="chat-msg-time">${m.createdAt?.toDate?m.createdAt.toDate().toLocaleString('id-ID',{hour:'2-digit',minute:'2-digit'}):'â€”'}</div>
          </div>
        </div>
      </div>`).join('');
    msgsEl.scrollTop = msgsEl.scrollHeight;
  });
}
window.adminSendChat = async function() {
  if (!currentChatRoom) return;
  const input = document.getElementById('adminChatInput');
  const text = input.value.trim(); if (!text) return;
  input.value = '';
  try {
    await addDoc(collection(db,'chats',currentChatRoom,'messages'), {
      text, sender:'admin', senderName:'Admin DEV', read:false, createdAt:serverTimestamp()
    });
    await updateDoc(doc(db,'chatMeta',currentChatRoom), {lastMsg:'[Admin] '+text, lastMsgAt:serverTimestamp()});
    // Get user's email and send notif
    const userSnap = await getDoc(doc(db,'users',currentChatRoom));
    const ud = userSnap.data();
    await addDoc(collection(db,'notifications'), {uid:currentChatRoom, title:'ðŸ’¬ Pesan dari Admin!', message:text.slice(0,80), icon:'ðŸ’¬', read:false, createdAt:serverTimestamp()});
    if (ud?.email) await sendEmailNotif(ud.email, ud.name, 'ðŸ’¬ Pesan Baru dari Admin DEV', text);
    if (ud?.waNumber) { const wm=encodeURIComponent(`ðŸ’¬ *DEV Uploader*\n\nHai ${ud.name}! Ada pesan dari Admin:\n\n"${text}"\n\nBuka: devv-uploader.vercel.app`); window.open(`https://wa.me/${ud.waNumber}?text=${wm}`,'_blank'); }
  } catch(e) { toast('âš  Gagal kirim'); }
}

// â•â• BADGE SYSTEM â•â•
const BADGE_DEFS = [
  { id:'first_upload', icon:'ðŸš€', name:'Launcher', desc:'Upload pertama!', req:1, type:'uploads', xp:50 },
  { id:'upload_5', icon:'â­', name:'Rising Star', desc:'5 kali upload', req:5, type:'uploads', xp:100 },
  { id:'upload_25', icon:'ðŸ’«', name:'Uploader Pro', desc:'25 kali upload', req:25, type:'uploads', xp:250 },
  { id:'upload_100', icon:'ðŸ’Ž', name:'Diamond', desc:'100 kali upload', req:100, type:'uploads', xp:1000 },
  { id:'topup_first', icon:'ðŸ’°', name:'Supporter', desc:'Topup pertama', req:1, type:'topups', xp:75 },
  { id:'referral_1', icon:'ðŸ‘¥', name:'Recruiter', desc:'Ajak 1 teman', req:1, type:'referrals', xp:150 },
  { id:'referral_5', icon:'ðŸŒŸ', name:'Ambassador', desc:'Ajak 5 teman', req:5, type:'referrals', xp:500 },
  { id:'rating_10', icon:'â­', name:'Critic', desc:'Rating 10 upload', req:10, type:'ratings', xp:200 },
  { id:'chat_first', icon:'ðŸ’¬', name:'Communicator', desc:'Kirim pesan pertama', req:1, type:'chats', xp:30 },
  { id:'login_streak_7', icon:'ðŸ”¥', name:'Consistent', desc:'Login 7 hari berturut', req:7, type:'streak', xp:300 },
  { id:'bulk_first', icon:'ðŸ“Ž', name:'Bulk Master', desc:'Bulk upload pertama', req:1, type:'bulk', xp:80 },
  { id:'coins_100', icon:'ðŸ†', name:'Whale', desc:'Kumpulkan 100 coin', req:100, type:'coins', xp:400 },
];

function calcLevel(xp) {
  const thresholds = [0,100,250,500,900,1400,2000,3000,4500,6500,9000];
  let level = 1;
  for (let i=0; i<thresholds.length; i++) { if (xp >= thresholds[i]) level = i+1; }
  const curThresh = thresholds[Math.min(level-1, thresholds.length-1)];
  const nextThresh = thresholds[Math.min(level, thresholds.length-1)] || curThresh+1000;
  return { level, xp, curThresh, nextThresh, pct: Math.min(100, Math.round((xp-curThresh)/(nextThresh-curThresh)*100)) };
}

async function checkBadges() {
  if (!currentUser || !currentUserData) return;
  try {
    const badgeSnap = await getDocs(collection(db,'users',currentUser.uid,'badges'));
    const earned = new Set(); badgeSnap.forEach(d=>earned.add(d.id));
    const uploads = currentUserData.totalUploads||0;
    const referrals = currentUserData.referralCount||0;
    const coins = currentUserData.coins||0;
    const xp = currentUserData.xp||0;
    const info = calcLevel(xp);
    // Update XP bar
    const lvlEl=document.getElementById('userLevel'); if(lvlEl)lvlEl.textContent=info.level;
    const xpEl=document.getElementById('userXP'); if(xpEl)xpEl.textContent=xp;
    const fillEl=document.getElementById('xpFill'); if(fillEl)fillEl.style.width=info.pct+'%';
    const curEl=document.getElementById('xpCurrent'); if(curEl)curEl.textContent=xp;
    const nxtEl=document.getElementById('xpNext'); if(nxtEl)nxtEl.textContent=info.nextThresh;
    // Render badges
    const grid = document.getElementById('badgeGrid'); if(!grid)return;
    const stats = { uploads, topups:currentUserData.totalTopups||0, referrals, ratings:currentUserData.totalRatings||0, chats:currentUserData.totalChats||0, streak:currentUserData.loginStreak||0, bulk:currentUserData.totalBulk||0, coins };
    grid.innerHTML = BADGE_DEFS.map(b => {
      const val = stats[b.type]||0;
      const isEarned = earned.has(b.id);
      const pct = Math.min(100, Math.round(val/b.req*100));
      return `<div class="badge-card ${isEarned?'earned':'locked'}">
        <span class="badge-icon">${b.icon}</span>
        <div class="badge-name">${b.name}</div>
        <div class="badge-desc">${b.desc}</div>
        <div style="margin-top:5px;font-family:'DM Mono',monospace;font-size:8px;color:var(--muted)">${val}/${b.req}</div>
        ${isEarned?`<div class="badge-earned-tag">âœ“ +${b.xp} XP</div>`:`<div class="badge-locked-tag">${pct}%</div>`}
      </div>`;
    }).join('');
    // Auto-award new badges
    for (const b of BADGE_DEFS) {
      if (!earned.has(b.id) && (stats[b.type]||0) >= b.req) {
        await setDoc(doc(db,'users',currentUser.uid,'badges',b.id), {earnedAt:serverTimestamp(), xp:b.xp});
        await updateDoc(doc(db,'users',currentUser.uid), {xp:increment(b.xp)});
        currentUserData.xp = (currentUserData.xp||0)+b.xp;
        toast(`ðŸ… Badge baru: ${b.icon} ${b.name}! +${b.xp} XP`);
        await addDoc(collection(db,'notifications'), {uid:currentUser.uid, title:`ðŸ… Badge: ${b.name}!`, message:`${b.desc} Â· +${b.xp} XP`, icon:b.icon, read:false, createdAt:serverTimestamp()});
        earned.add(b.id);
      }
    }
  } catch(e) {}
}

// â•â• MISSION SYSTEM â•â•
const DAILY_MISSIONS = [
  { id:'daily_upload_1', icon:'ðŸ“¤', name:'Upload Harian', desc:'Upload 1 asset hari ini', target:1, reward:2, type:'daily' },
  { id:'daily_upload_3', icon:'ðŸ“¦', name:'Triple Upload', desc:'Upload 3 asset hari ini', target:3, reward:5, type:'daily' },
  { id:'daily_login', icon:'â˜€ï¸', name:'Login Streak', desc:'Login hari ini', target:1, reward:1, type:'daily' },
  { id:'daily_chat', icon:'ðŸ’¬', name:'Chat Admin', desc:'Kirim 1 pesan ke admin', target:1, reward:2, type:'daily' },
];
const WEEKLY_MISSIONS = [
  { id:'weekly_upload_10', icon:'ðŸš€', name:'Grind Week', desc:'Upload 10 asset minggu ini', target:10, reward:15, type:'weekly' },
  { id:'weekly_upload_25', icon:'ðŸ’Ž', name:'Master Week', desc:'Upload 25 asset minggu ini', target:25, reward:30, type:'weekly' },
  { id:'weekly_referral', icon:'ðŸ‘¥', name:'Recruiter Week', desc:'Ajak 1 teman minggu ini', target:1, reward:10, type:'weekly' },
  { id:'weekly_rating_5', icon:'â­', name:'Critic Week', desc:'Rating 5 upload minggu ini', target:5, reward:8, type:'weekly' },
];
let currentMissionTab = 'daily';
window.switchMissionTab = function(btn, tab) {
  document.querySelectorAll('.mission-tab').forEach(t=>t.classList.remove('active'));
  btn.classList.add('active'); currentMissionTab = tab;
  renderMissions();
}
function getTodayKey() { return new Date().toISOString().split('T')[0]; }
function getWeekKey() { const d=new Date(); d.setDate(d.getDate()-d.getDay()); return d.toISOString().split('T')[0]; }
async function checkMissionProgress() {
  if (!currentUser) return;
  await updateMissionProgress('daily_login', 1);
  renderMissions();
}
async function updateMissionProgress(missionId, add) {
  if (!currentUser) return;
  try {
    const periodKey = missionId.startsWith('daily')||missionId==='daily_login'||missionId==='send_chat'||missionId==='chat_first' ? getTodayKey() : getWeekKey();
    const ref = doc(db,'users',currentUser.uid,'missions',missionId+'_'+periodKey);
    const snap = await getDoc(ref);
    if (snap.exists() && snap.data().claimed) return;
    const curr = (snap.data()?.progress||0)+add;
    await setDoc(ref, {progress:curr, claimed:false, updatedAt:serverTimestamp()}, {merge:true});
  } catch(e) {}
}
async function renderMissions() {
  const list = document.getElementById('missionList'); if (!list) return;
  const missions = currentMissionTab==='daily' ? DAILY_MISSIONS : WEEKLY_MISSIONS;
  const periodKey = currentMissionTab==='daily' ? getTodayKey() : getWeekKey();
  const msnData = {};
  try {
    for (const m of missions) {
      const snap = await getDoc(doc(db,'users',currentUser.uid,'missions',m.id+'_'+periodKey));
      msnData[m.id] = snap.exists() ? snap.data() : {progress:0,claimed:false};
    }
  } catch(e) {}
  list.innerHTML = missions.map(m => {
    const d = msnData[m.id]||{progress:0,claimed:false};
    const prog = Math.min(d.progress||0, m.target);
    const pct = Math.round(prog/m.target*100);
    const done = prog >= m.target; const claimed = d.claimed;
    return `<div class="mission-item ${done&&!claimed?'done':''} ${claimed?'claimed':''}">
      <div class="mission-top">
        <div class="mission-icon">${m.icon}</div>
        <div class="mission-info"><div class="mission-name">${m.name}</div><div class="mission-desc">${m.desc}</div></div>
        <div class="mission-reward">+${m.reward} ðŸª™</div>
      </div>
      <div class="mission-progress-wrap">
        <div class="mission-progress-track"><div class="mission-progress-fill" style="width:${pct}%"></div></div>
        <div class="mission-progress-nums"><span>${prog}/${m.target}</span><span>${pct}%</span></div>
      </div>
      ${claimed ? `<div class="mission-claimed-tag">âœ“ Reward sudah diambil</div>`
        : done ? `<button class="btn-claim" onclick="claimMission('${m.id}',${m.reward},'${periodKey}')">ðŸŽ Ambil ${m.reward} Coin</button>`
        : `<button class="btn-claim" disabled>Belum selesai</button>`}
    </div>`;
  }).join('');
}
window.claimMission = async function(missionId, reward, periodKey) {
  if (!currentUser) return;
  const ref = doc(db,'users',currentUser.uid,'missions',missionId+'_'+periodKey);
  const snap = await getDoc(ref); if (snap.data()?.claimed) return toast('Sudah diklaim!');
  await updateDoc(ref, {claimed:true, claimedAt:serverTimestamp()});
  await updateDoc(doc(db,'users',currentUser.uid), {coins:increment(reward)});
  currentUserData.coins=(currentUserData.coins||0)+reward; updateUI();
  await addDoc(collection(db,'notifications'), {uid:currentUser.uid, title:'ðŸŽ¯ Misi Selesai!', message:`+${reward} Coin dari misi`, icon:'ðŸŽ¯', read:false, createdAt:serverTimestamp()});
  // Send email
  await sendEmailNotif(currentUser.email, currentUserData.name, 'ðŸŽ¯ Misi Selesai!', `Selamat! Kamu mendapat +${reward} Coin dari misi. Total coin: ${currentUserData.coins}`);
  toast(`ðŸŽ‰ +${reward} Coin dari misi!`);
  loadNotifications(); checkBadges(); renderMissions();
}

let missionTimer = null;
function startMissionCountdown() {
  if (missionTimer) clearInterval(missionTimer);
  function tick() {
    const now=new Date(), midnight=new Date(now); midnight.setHours(24,0,0,0);
    const diff=midnight-now; const h=Math.floor(diff/3600000), m=Math.floor((diff%3600000)/60000), s=Math.floor((diff%60000)/1000);
    const el=document.getElementById('missionCountdown'); if(el) el.textContent=`${h}j ${m}m ${s}d`;
  }
  tick(); missionTimer = setInterval(tick, 1000);
}


function showAdmin(){document.getElementById('screen-auth').style.display='none';document.getElementById('screen-app').style.display='none';document.getElementById('screen-admin').style.display='block';loadAdminData();}
function updateUI(){
  if(!currentUserData)return;
  const av=currentUserData.avatarEmoji||'âš¡',coins=currentUserData.coins||0;
  const tier=currentUserData.vipTier||'free';
  ['userAvatar','settingsAvatar'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent=av;});
  document.getElementById('coinVal').textContent=coins;
  document.getElementById('ringNum').textContent=coins;
  document.getElementById('userName').textContent=currentUserData.name||'User';
  document.getElementById('userEmail').textContent=currentUser?.email||'';
  document.getElementById('sDisplayName').textContent=currentUserData.name||'User';
  document.getElementById('sDisplayEmail').textContent=currentUser?.email||'';
  document.getElementById('sDisplayCoins').textContent=coins;
  if(currentUserData.waNumber){const el=document.getElementById('sWaNumber');if(el)el.value=currentUserData.waNumber;}
  const rc=currentUserData.referralCode||'';
  const refLink=window.location.origin+window.location.pathname+'?ref='+rc;
  const e1=document.getElementById('myRefCode');if(e1)e1.textContent=rc;
  const e2=document.getElementById('myRefLink');if(e2)e2.textContent=refLink;
  const e3=document.getElementById('myRefCount');if(e3)e3.textContent=currentUserData.referralCount||0;
  const e4=document.getElementById('myRefEarned');if(e4)e4.textContent=currentUserData.referralEarned||0;
  // Always sync VIP everywhere
  _syncVipUI(tier);
}

function _syncVipUI(tier){
  const VIP={free:{name:'FREE',icon:'âš¡',color:'var(--muted2)',cls:'free',desc:'Akun standar'},silver:{name:'SILVER',icon:'ðŸ¥ˆ',color:'#c0c0c0',cls:'silver',desc:'Member Silver aktif'},gold:{name:'GOLD',icon:'ðŸ‘‘',color:'var(--gold2)',cls:'gold',desc:'Member Gold aktif'},diamond:{name:'DIAMOND',icon:'ðŸ’Ž',color:'var(--teal)',cls:'diamond',desc:'Member Diamond aktif'}};
  const t=VIP[tier]||VIP.free;
  // VIP panel banner
  const banner=document.getElementById('currentVipBanner');if(banner)banner.className='current-vip-banner '+t.cls;
  const vIcon=document.getElementById('currentVipIcon');if(vIcon)vIcon.textContent=t.icon;
  const vName=document.getElementById('currentVipName');if(vName){vName.textContent=t.icon+' '+t.name;vName.style.color=t.color;}
  const vDesc=document.getElementById('currentVipDesc');if(vDesc)vDesc.textContent=currentUserData?.vipExpiry?'Aktif hingga: '+new Date(currentUserData.vipExpiry).toLocaleDateString('id-ID'):t.desc;
  // Remove old VIP badge from topbar
  document.querySelectorAll('.topbar-vip-badge').forEach(el=>el.remove());
  if(tier!=='free'){
    const badge=document.createElement('span');badge.className='vip-badge '+tier+' topbar-vip-badge';badge.style.cssText='display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:20px;font-size:9px;font-weight:700;margin-left:6px;vertical-align:middle;';badge.textContent=t.icon+' '+tier.toUpperCase();const un=document.getElementById('userName');if(un)un.after(badge);
  }
  // Profile panel
  const pb=document.getElementById('profileBadgesRow');
  if(pb&&tier!=='free'){pb.innerHTML=`<span class="vip-badge ${tier}">${t.icon} ${tier.toUpperCase()}</span>`;}
  // Topbar coin ring color by VIP
  const ring=document.querySelector('.coin-ring');
  if(ring){ring.style.borderColor=tier==='diamond'?'rgba(0,229,200,0.6)':tier==='gold'?'rgba(201,168,76,0.8)':tier==='silver'?'rgba(192,192,192,0.5)':'rgba(201,168,76,0.3)';}
}


// AVATAR
const AVATARS=['âš¡','ðŸ”¥','ðŸ’Ž','ðŸŽ®','ðŸš€','ðŸŒ™','â­','ðŸŽ¯','ðŸ¦Š','ðŸ‰','ðŸ’€','ðŸ¤–','ðŸ‘¾','ðŸŽª','ðŸŒŠ','ðŸŽ­'];
window.openAvatarPicker=function(){document.getElementById('avatarGrid').innerHTML=AVATARS.map(a=>`<div class="avatar-opt ${a===(currentUserData?.avatarEmoji||'âš¡')?'selected':''}" onclick="selectAvatar('${a}')">${a}</div>`).join('');document.getElementById('avatarModal').classList.add('show');}
window.selectAvatar=async function(emoji){document.querySelectorAll('.avatar-opt').forEach(el=>el.classList.remove('selected'));event.target.classList.add('selected');try{await updateDoc(doc(db,'users',currentUser.uid),{avatarEmoji:emoji});currentUserData.avatarEmoji=emoji;updateUI();toast('âœ“ Avatar diupdate!');setTimeout(()=>document.getElementById('avatarModal').classList.remove('show'),300);}catch(e){toast('âš  Gagal');}}
window.closeAvatarModal=function(){document.getElementById('avatarModal').classList.remove('show');}

// NOTIFICATIONS
async function loadNotifications(){
  if(!currentUser)return;
  try{
    const q=query(collection(db,'notifications'),where('uid','==',currentUser.uid),orderBy('createdAt','desc'),limit(20));
    const snap=await getDocs(q);const notifs=[];snap.forEach(d=>notifs.push({id:d.id,...d.data()}));
    const unread=notifs.filter(n=>!n.read).length;
    const badge=document.getElementById('notifBadge');if(badge){badge.textContent=unread;badge.style.display=unread>0?'flex':'none';}
    const list=document.getElementById('notifList');
    if(!list)return;
    list.innerHTML=notifs.length?notifs.map(n=>`<div class="notif-item ${n.read?'':'unread'}" onclick="markRead('${n.id}')"><div class="notif-icon">${n.icon||'ðŸ””'}</div><div class="notif-body"><div class="notif-title">${n.title||''}</div><div class="notif-msg">${n.message||''}</div><div class="notif-time">${n.createdAt?.toDate?n.createdAt.toDate().toLocaleString('id-ID'):''}</div></div>${!n.read?'<div class="notif-dot"></div>':''}</div>`).join(''):'<div style="text-align:center;padding:28px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada notifikasi</div>';
  }catch(e){}
}
window.markRead=async function(nid){try{await updateDoc(doc(db,'notifications',nid),{read:true});loadNotifications();}catch(e){}}
window.markAllRead=async function(){try{const q=query(collection(db,'notifications'),where('uid','==',currentUser.uid),where('read','==',false));const snap=await getDocs(q);const batch=writeBatch(db);snap.docs.forEach(d=>batch.update(d.ref,{read:true}));await batch.commit();loadNotifications();toast('âœ“ Semua dibaca');}catch(e){}}
window.toggleNotifPanel=function(){document.getElementById('notifPanel').classList.toggle('show');}
document.addEventListener('click',e=>{const p=document.getElementById('notifPanel');if(p&&p.classList.contains('show')&&!p.contains(e.target)&&!e.target.classList.contains('notif-btn')&&!e.target.closest('.notif-btn')){p.classList.remove('show');}});

// REFERRAL
window.copyRefLink=function(){const rc=currentUserData?.referralCode||'',link=window.location.origin+window.location.pathname+'?ref='+rc;navigator.clipboard.writeText(link).then(()=>toast('âœ“ Link referral disalin!'));}
window.shareRefWA=function(){const rc=currentUserData?.referralCode||'',link=window.location.origin+window.location.pathname+'?ref='+rc,msg=encodeURIComponent(`Hai! Coba DEV Uploader â€” platform upload asset Roblox premium!\n\nDaftar pakai link referral aku, kamu dapat BONUS 3 Coin gratis!\n\nðŸ‘‰ ${link}`);window.open(`https://wa.me/?text=${msg}`,'_blank');}

// PROMO
window.applyPromoCode=async function(){
  const code=document.getElementById('promoInput').value.trim().toUpperCase();
  if(!code)return toast('âš  Masukkan kode promo!');
  try{
    const ps=await getDocs(query(collection(db,'promos'),where('code','==',code),where('active','==',true)));
    if(ps.empty)return toast('âœ• Kode promo tidak valid!');
    const promo=ps.docs[0],pd=promo.data();
    const us=await getDocs(query(collection(db,'promoUses'),where('uid','==',currentUser.uid),where('code','==',code)));
    if(!us.empty)return toast('âœ• Kode sudah pernah dipakai!');
    if(pd.maxUses&&(pd.usedCount||0)>=pd.maxUses)return toast('âœ• Kode promo sudah habis!');
    const bonus=pd.coinBonus||0;
    await updateDoc(doc(db,'users',currentUser.uid),{coins:increment(bonus)});
    await addDoc(collection(db,'promoUses'),{uid:currentUser.uid,code,usedAt:serverTimestamp()});
    await updateDoc(promo.ref,{usedCount:increment(1)});
    await addDoc(collection(db,'notifications'),{uid:currentUser.uid,title:'ðŸŽŸï¸ Kode Promo Valid!',message:`+${bonus} Coin dari kode ${code}`,icon:'ðŸŽŸï¸',read:false,createdAt:serverTimestamp()});
    currentUserData.coins=(currentUserData.coins||0)+bonus;updateUI();
    document.getElementById('promoInput').value='';
    toast(`ðŸŽ‰ +${bonus} Coin dari promo ${code}!`);loadNotifications();
  }catch(e){toast('âš  Gagal: '+e.message);}
}

// SETTINGS
function saveSettings(){const s={sUserId:document.getElementById('sUserId').value,sApiKey:document.getElementById('sApiKey').value,sDefType:document.getElementById('sDefType').value,sShowApiKey:document.getElementById('sShowApiKey').checked};localStorage.setItem('dev_settings',JSON.stringify(s));applySettingsToUpload();toast('âœ“ Settingan tersimpan!');}
function loadSettings(){try{const s=JSON.parse(localStorage.getItem('dev_settings')||'{}');if(s.sUserId){document.getElementById('sUserId').value=s.sUserId;document.getElementById('userId').value=s.sUserId;document.getElementById('bulkUserId').value=s.sUserId;}if(s.sApiKey){document.getElementById('sApiKey').value=s.sApiKey;document.getElementById('apiKey').value=s.sApiKey;document.getElementById('bulkApiKey').value=s.sApiKey;}if(s.sDefType){document.getElementById('sDefType').value=s.sDefType;document.getElementById('assetType').value=s.sDefType;}if(s.sShowApiKey!==undefined){document.getElementById('sShowApiKey').checked=s.sShowApiKey;const t=s.sShowApiKey?'text':'password';document.getElementById('apiKey').type=t;document.getElementById('sApiKey').type=t;}}catch(e){}}
function applySettingsToUpload(){try{const s=JSON.parse(localStorage.getItem('dev_settings')||'{}');if(s.sUserId)document.getElementById('userId').value=s.sUserId;if(s.sApiKey)document.getElementById('apiKey').value=s.sApiKey;if(s.sDefType)document.getElementById('assetType').value=s.sDefType;}catch(e){}}
window.saveSettings=saveSettings;
window.clearSettings=function(){if(!confirm('Hapus semua settingan?'))return;localStorage.removeItem('dev_settings');['sUserId','sApiKey','userId','apiKey','bulkUserId','bulkApiKey'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});toast('âœ“ Settingan dihapus!');}
window.toggleApiKeyVisibility=function(){const show=document.getElementById('sShowApiKey').checked,t=show?'text':'password';document.getElementById('apiKey').type=t;document.getElementById('sApiKey').type=t;}
window.saveWaNumber=async function(){const wa=document.getElementById('sWaNumber').value.trim().replace(/\D/g,'');if(!wa)return toast('âš  Masukkan nomor WA!');try{await updateDoc(doc(db,'users',currentUser.uid),{waNumber:wa});currentUserData.waNumber=wa;toast('âœ“ Nomor WA tersimpan!');}catch(e){toast('âš  Gagal');}}

// UPLOAD
let selFile=null;
window.handleFile=function(inp){const f=inp.files[0];if(!f)return;selFile=f;const ext=f.name.split('.').pop().toLowerCase();const ico=['png','jpg','jpeg'].includes(ext)?'ðŸ–¼ï¸':['mp3','ogg','wav'].includes(ext)?'ðŸŽµ':ext==='fbx'?'ðŸ“¦':'ðŸ“„';document.getElementById('fchipIco').textContent=ico;document.getElementById('fName').textContent=f.name;document.getElementById('fSize').textContent=fmtBytes(f.size);document.getElementById('fchip').classList.add('show');if(!document.getElementById('assetName').value)document.getElementById('assetName').value=f.name.replace(/\.[^.]+$/,'');const sel=document.getElementById('assetType'),notice=document.getElementById('rbxmNotice');if(['png','jpg','jpeg'].includes(ext)){sel.value='Decal';notice.classList.remove('show');}else if(['mp3','ogg','wav'].includes(ext)){sel.value='Audio';notice.classList.remove('show');}else if(ext==='fbx'){sel.value='MeshPart';notice.classList.remove('show');}else if(ext==='rbxm'){notice.classList.add('show');}else notice.classList.remove('show');}
window.removeFile=function(){selFile=null;document.getElementById('fi').value='';document.getElementById('fchip').classList.remove('show');document.getElementById('rbxmNotice').classList.remove('show');}
window.doUpload=async function(){
  if(!currentUser)return toast('âš  Login dulu!');
  const userId=document.getElementById('userId').value.trim(),apiKey=document.getElementById('apiKey').value.trim(),assetName=document.getElementById('assetName').value.trim(),assetType=document.getElementById('assetType').value;
  if(!userId)return toast('âš  Masukkan User ID!');if(!apiKey)return toast('âš  Masukkan API Key!');if(!selFile)return toast('âš  Pilih file!');if(!assetName)return toast('âš  Masukkan nama asset!');
  if(selFile.name.split('.').pop().toLowerCase()==='rbxm')return toast('âœ• .rbxm tidak bisa via API!');
  const ex=JSON.parse(localStorage.getItem('dev_settings')||'{}');localStorage.setItem('dev_settings',JSON.stringify({...ex,sUserId:userId,sApiKey:apiKey,sDefType:assetType}));
  const userRef=doc(db,'users',currentUser.uid);const snap=await getDoc(userRef);const freshCoins=snap.data()?.coins||0;
  if(freshCoins<=0)return toast('âœ• Coin tidak cukup!');
  const btn=document.getElementById('btnUp');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>';
  showResult('','','');
  // Show progress
  showUploadProgress(true);
  setStep(1,'active'); updateProgress(10);
  await new Promise(r=>setTimeout(r,400));
  setStep(1,'done'); setStep(2,'active'); updateProgress(30);
  try{
    const fd=new FormData();fd.append('request',JSON.stringify({assetType,displayName:assetName,description:'Uploaded via DEV Uploader',creationContext:{creator:{userId}}}));fd.append('fileContent',selFile,selFile.name);
    updateProgress(50);
    const res=await fetch('/api/upload',{method:'POST',headers:{'x-api-key':apiKey},body:fd});
    const data=await res.json();
    setStep(2,'done'); setStep(3,'active'); updateProgress(75);
    await new Promise(r=>setTimeout(r,300));
    if(res.ok){
      setStep(3,'done'); setStep(4,'active'); updateProgress(90);
      await updateDoc(userRef,{coins:increment(-1),totalUploads:increment(1)});currentUserData.coins=freshCoins-1;currentUserData.totalUploads=(currentUserData.totalUploads||0)+1;updateUI();
      const assetId=data.assetId||null,opId=data.operationId||data.path||null;
      await addDoc(collection(db,'uploads'),{uid:currentUser.uid,userEmail:currentUser.email,userName:currentUserData.name,assetName,assetType,assetId:assetId||'Processing',operationId:opId||'',fileName:selFile.name,fileSize:selFile.size,rating:0,createdAt:serverTimestamp()});
      await updateMissionProgress('daily_upload_1', 1);
      await updateMissionProgress('daily_upload_3', 1);
      await updateMissionProgress('weekly_upload_10', 1);
      await updateMissionProgress('weekly_upload_25', 1);
      await sendEmailNotif(currentUser.email, currentUserData.name, 'âœ… Upload Berhasil!', `Asset "${assetName}" berhasil diupload! ID: ${assetId||'Processing'}`);
      setStep(4,'done'); updateProgress(100);
      setTimeout(()=>showUploadProgress(false), 2000);
      loadHistory(); checkBadges();
      showResult('ok','âœ¦ UPLOAD BERHASIL',`<div class="rrow"><span class="rkey">Asset Name</span><span class="rval">${assetName}</span></div><div class="rrow"><span class="rkey">Asset ID</span><span>${assetId?`<span class="rval" onclick="cp('${assetId}')">${assetId}</span>`:'<span class="badge-proc">Processingâ€¦</span>'}</span></div><div class="rrow"><span class="rkey">Insert URL</span><span>${assetId?`<span class="rval" onclick="cp('rbxassetid://${assetId}')">rbxassetid://${assetId}</span>`:'<span style="font-size:10px;color:var(--muted)">Cek Inventory</span>'}</span></div>${opId?`<div class="rrow"><span class="rkey">Operation ID</span><span class="rval" onclick="cp('${opId}')" style="font-size:10px">${opId}</span></div>`:''}<div style="margin-top:10px"><button onclick="openShare('${assetName}','${assetId||''}')" style="padding:7px 16px;border:1px solid rgba(0,229,200,0.3);border-radius:8px;background:rgba(0,229,200,0.08);color:var(--teal);font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:2px;cursor:pointer">ðŸ”— SHARE ASSET</button></div>`);
      toast('âœ“ Upload berhasil!');
    }else{
      setStep(2,'error'); updateProgress(0);
      setTimeout(()=>showUploadProgress(false),2000);
      const msg=data.message||data.error||JSON.stringify(data);
      showResult('fail','âœ• UPLOAD GAGAL',`<div style="font-family:DM Mono,monospace;font-size:12px;color:rgba(255,68,102,0.8);line-height:1.7">${msg}</div>`);
    }
  }catch(e){
    setStep(2,'error'); updateProgress(0);
    setTimeout(()=>showUploadProgress(false),2000);
    showResult('fail','âœ• CONNECTION ERROR',`<div style="font-family:DM Mono,monospace;font-size:12px;color:rgba(255,68,102,0.8)">${e.message}</div>`);
  }
  btn.disabled=false;btn.innerHTML='<div class="shim"></div>ðŸš€ &nbsp; UPLOAD';
}

// BULK UPLOAD
let bulkFiles=[];
window.handleBulkFiles=function(inp){const files=Array.from(inp.files);bulkFiles=files.filter(f=>['png','jpg','jpeg','mp3','ogg','wav','fbx'].includes(f.name.split('.').pop().toLowerCase()));renderBulkList();}
function renderBulkList(){const el=document.getElementById('bulkList');if(!bulkFiles.length){el.innerHTML='<div style="text-align:center;padding:18px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada file</div>';document.getElementById('bulkCoinCost').textContent=0;return;}el.innerHTML=bulkFiles.map((f,i)=>{const ext=f.name.split('.').pop().toLowerCase(),type=['png','jpg','jpeg'].includes(ext)?'Decal':['mp3','ogg','wav'].includes(ext)?'Audio':'MeshPart';return`<div class="bulk-item" id="bitem_${i}"><div class="bulk-item-info"><div class="bulk-name">${f.name}</div><div class="bulk-meta">${fmtBytes(f.size)} Â· ${type}</div></div><div class="bulk-status" id="bstatus_${i}">â³</div><button class="bulk-rm" onclick="removeBulkFile(${i})">âœ•</button></div>`;}).join('');document.getElementById('bulkCoinCost').textContent=bulkFiles.length;}
window.removeBulkFile=function(i){bulkFiles.splice(i,1);renderBulkList();}
window.doBulkUpload=async function(){
  if(!currentUser)return toast('âš  Login dulu!');
  if(!bulkFiles.length)return toast('âš  Pilih file dulu!');
  const userId=document.getElementById('bulkUserId').value.trim(),apiKey=document.getElementById('bulkApiKey').value.trim();
  if(!userId)return toast('âš  Masukkan User ID!');if(!apiKey)return toast('âš  Masukkan API Key!');
  const userRef=doc(db,'users',currentUser.uid);const snap=await getDoc(userRef);const freshCoins=snap.data()?.coins||0;
  if(freshCoins<bulkFiles.length)return toast(`âœ• Coin kurang! Butuh ${bulkFiles.length}, punya ${freshCoins}`);
  const btn=document.getElementById('btnBulk');btn.disabled=true;btn.innerHTML='<span class="spinner"></span> Uploading...';
  let success=0,failed=0;
  for(let i=0;i<bulkFiles.length;i++){
    const f=bulkFiles[i];const statusEl=document.getElementById('bstatus_'+i);const itemEl=document.getElementById('bitem_'+i);
    if(statusEl)statusEl.textContent='ðŸ”„';
    try{
      const ext=f.name.split('.').pop().toLowerCase(),assetType=['png','jpg','jpeg'].includes(ext)?'Decal':['mp3','ogg','wav'].includes(ext)?'Audio':'MeshPart',assetName=f.name.replace(/\.[^.]+$/,'');
      const fd=new FormData();fd.append('request',JSON.stringify({assetType,displayName:assetName,description:'Bulk via DEV Uploader',creationContext:{creator:{userId}}}));fd.append('fileContent',f,f.name);
      const res=await fetch('/api/upload',{method:'POST',headers:{'x-api-key':apiKey},body:fd});const data=await res.json();
      if(res.ok){
        await updateDoc(userRef,{coins:increment(-1),totalUploads:increment(1)});
        await addDoc(collection(db,'uploads'),{uid:currentUser.uid,userEmail:currentUser.email,userName:currentUserData.name,assetName,assetType,assetId:data.assetId||'Processing',fileName:f.name,fileSize:f.size,rating:0,createdAt:serverTimestamp()});
        if(statusEl){statusEl.textContent='âœ“';statusEl.style.color='var(--green)';}if(itemEl)itemEl.style.borderColor='rgba(0,229,160,0.3)';success++;
      }else{if(statusEl){statusEl.textContent='âœ•';statusEl.style.color='var(--red)';}if(itemEl)itemEl.style.borderColor='rgba(255,68,102,0.3)';failed++;}
    }catch(e){if(statusEl){statusEl.textContent='âœ•';statusEl.style.color='var(--red)';}failed++;}
  }
  currentUserData.coins=Math.max(0,(currentUserData.coins||0)-success);currentUserData.totalUploads=(currentUserData.totalUploads||0)+success;updateUI();loadHistory();
  toast(`âœ“ Selesai! ${success} berhasil, ${failed} gagal`);btn.disabled=false;btn.innerHTML='<div class="shim"></div>ðŸ“Ž &nbsp; BULK UPLOAD SEKARANG';
}

// HISTORY
async function loadHistory(){
  if(!currentUser)return;const el=document.getElementById('histList');
  el.innerHTML='<div class="hist-empty"><div class="hist-empty-ico">â³</div></div>';
  try{
    const q=query(collection(db,'uploads'),where('uid','==',currentUser.uid),orderBy('createdAt','desc'),limit(50));
    const snap=await getDocs(q);const items=[];snap.forEach(d=>items.push({id:d.id,...d.data()}));
    document.getElementById('statTotal').textContent=items.length;
    document.getElementById('statSuccess').textContent=items.filter(i=>i.assetId!=='Processing').length;
    document.getElementById('statCoins').textContent=currentUserData.totalUploads||items.length;
    if(!items.length){el.innerHTML='<div class="hist-empty"><div class="hist-empty-ico">â—Ž</div><div class="hist-empty-t">Belum ada history.</div></div>';return;}
    el.innerHTML=items.map(h=>`<div class="hist-item"><div class="hist-item-top"><span class="hist-name">${h.assetName}</span><span class="hist-time">${h.createdAt?.toDate?h.createdAt.toDate().toLocaleString('id-ID'):''}</span></div><div class="hist-id" onclick="cp('${h.assetId}')">ID: ${h.assetId}</div><div class="hist-tags"><span class="hist-tag">${h.assetType}</span><span class="hist-tag">${h.fileName}</span></div><div class="hist-rating"><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">RATING:</span>${[1,2,3,4,5].map(s=>`<span class="star ${(h.rating||0)>=s?'active':''}" onclick="rateUpload('${h.id}',${s})">â˜…</span>`).join('')}<button onclick="openShare('${h.assetName}','${h.assetId}')" style="margin-left:auto;padding:3px 10px;border:1px solid rgba(0,229,200,0.3);border-radius:6px;background:rgba(0,229,200,0.06);color:var(--teal);font-family:'DM Mono',monospace;font-size:9px;cursor:pointer">ðŸ”— Share</button></div></div>`).join('');
  }catch(e){el.innerHTML='<div class="hist-empty"><div class="hist-empty-t">Gagal memuat.</div></div>';}
}
window.rateUpload=async function(docId,stars){
  try{
    await updateDoc(doc(db,'uploads',docId),{rating:stars});
    await updateDoc(doc(db,'users',currentUser.uid),{totalRatings:increment(1)});
    currentUserData.totalRatings=(currentUserData.totalRatings||0)+1;
    await updateMissionProgress('weekly_rating_5',1);
    toast('âœ“ Rating: '+'â˜…'.repeat(stars));loadHistory();checkBadges();
  }catch(e){}
}

// DASHBOARD
async function loadDashboard(){
  try{
    const q=query(collection(db,'uploads'),where('uid','==',currentUser.uid),orderBy('createdAt','desc'),limit(100));
    const snap=await getDocs(q);const items=[];snap.forEach(d=>items.push(d.data()));
    const types={};items.forEach(i=>{types[i.assetType]=(types[i.assetType]||0)+1;});
    const days={};const now=new Date();for(let i=6;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);days[d.toLocaleDateString('id-ID',{weekday:'short'})]=0;}
    items.forEach(i=>{if(!i.createdAt?.toDate)return;const d=i.createdAt.toDate().toLocaleDateString('id-ID',{weekday:'short'});if(days[d]!==undefined)days[d]++;});
    const maxVal=Math.max(...Object.values(days),1);
    document.getElementById('barChart').innerHTML=Object.entries(days).map(([day,val])=>`<div class="bar-col"><div class="bar-wrap"><div class="bar-fill" style="height:${(val/maxVal)*100}%">${val>0?`<span class="bar-val">${val}</span>`:''}</div></div><div class="bar-label">${day}</div></div>`).join('');
    document.getElementById('typeBreakdown').innerHTML=Object.entries(types).length?Object.entries(types).map(([t,c])=>`<div class="type-row"><span class="type-dot" style="background:${t==='Decal'?'var(--teal)':t==='Audio'?'var(--gold)':'var(--purple)'}"></span><span class="type-name">${t}</span><span class="type-count">${c}</span></div>`).join(''):'<div style="font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada data</div>';
    const rated=items.filter(i=>i.rating>0);
    document.getElementById('dashAvgRating').textContent=rated.length?(rated.reduce((a,b)=>a+(b.rating||0),0)/rated.length).toFixed(1):'â€”';
    document.getElementById('dashTotalUploads').textContent=items.length;
    document.getElementById('dashThisWeek').textContent=Object.values(days).reduce((a,b)=>a+b,0);
    document.getElementById('dashRatedCount').textContent=rated.length;
    // Monthly revenue (1 coin = Rp 1000 approx)
    const monthlyRev={};
    items.forEach(i=>{
      if(!i.createdAt?.toDate)return;
      const d=i.createdAt.toDate();
      const key=d.toLocaleDateString('id-ID',{month:'short',year:'2-digit'});
      monthlyRev[key]=(monthlyRev[key]||0)+1000;
    });
    // Inject revenue stats + chart into dashboard if not already there
    let revSection = document.getElementById('revEnhancedSection');
    if(!revSection){
      revSection = document.createElement('div');
      revSection.id = 'revEnhancedSection';
      revSection.style.marginTop = '12px';
      const dashCard = document.querySelector('#panel-dashboard .card');
      if(dashCard) dashCard.appendChild(revSection);
    }
    const totalRev = Object.values(monthlyRev).reduce((a,b)=>a+b,0);
    const thisMonth = new Date().toLocaleDateString('id-ID',{month:'short',year:'2-digit'});
    const thisMonthRev = monthlyRev[thisMonth]||0;
    revSection.innerHTML=`
      <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:8px">ðŸ“ˆ Revenue Overview</div>
      <div class="rev-stat-grid">
        <div class="rev-stat-card"><div class="rev-stat-val">Rp${(totalRev/1000).toFixed(0)}k</div><div class="rev-stat-lbl">Total Estimasi</div></div>
        <div class="rev-stat-card"><div class="rev-stat-val">Rp${(thisMonthRev/1000).toFixed(0)}k</div><div class="rev-stat-lbl">Bulan Ini</div></div>
        <div class="rev-stat-card"><div class="rev-stat-val">${items.length}</div><div class="rev-stat-lbl">Total Upload</div></div>
        <div class="rev-stat-card"><div class="rev-stat-val">${Object.keys(monthlyRev).length}</div><div class="rev-stat-lbl">Bulan Aktif</div></div>
      </div>
      <div class="rev-chart-wrap">
        <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-bottom:8px">GRAFIK 6 BULAN TERAKHIR</div>
        <canvas id="revLineCanvas" class="rev-line-canvas"></canvas>
      </div>
    `;
    setTimeout(()=>drawRevenueLineChart(monthlyRev), 100);
  }catch(e){console.error(e);}
}

// LEADERBOARD
async function loadLeaderboard(){
  const el=document.getElementById('leaderList');el.innerHTML='<div class="hist-empty"><div class="hist-empty-ico">â³</div></div>';
  try{
    const q=query(collection(db,'users'),orderBy('totalUploads','desc'),limit(20));const snap=await getDocs(q);const users=[];snap.forEach(d=>users.push(d.data()));
    if(!users.length){el.innerHTML='<div class="hist-empty"><div class="hist-empty-t">Belum ada data.</div></div>';return;}
    const medals=['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'];
    el.innerHTML=users.map((u,i)=>`<div class="leader-row ${u.uid===currentUser?.uid?'me':''}"><div class="leader-rank">${medals[i]||`<span style="font-family:'Bebas Neue';font-size:16px;color:var(--muted)">${i+1}</span>`}</div><div class="leader-avatar">${u.avatarEmoji||'âš¡'}</div><div class="leader-info"><div class="leader-name">${u.name||'User'} ${u.uid===currentUser?.uid?'<span class="badge-me">KAMU</span>':''}</div><div class="leader-sub">âœ¦ ${u.coins||0} Coins Â· ðŸ‘¥ ${u.referralCount||0} Ref</div></div><div class="leader-uploads"><div class="leader-num">${u.totalUploads||0}</div><div class="leader-lbl">UPLOAD</div></div></div>`).join('');
  }catch(e){el.innerHTML='<div class="hist-empty"><div class="hist-empty-t">Gagal.</div></div>';}
}

// TICKET
window.sendTicket=async function(){
  if(!currentUser)return;const subject=document.getElementById('ticketSubject').value.trim(),msg=document.getElementById('ticketMsg').value.trim(),type=document.getElementById('ticketType').value;
  if(!subject||!msg)return toast('âš  Isi semua field!');
  const btn=document.getElementById('btnTicket');btn.disabled=true;btn.textContent='Mengirim...';
  try{await addDoc(collection(db,'tickets'),{uid:currentUser.uid,userEmail:currentUser.email,userName:currentUserData.name,subject,message:msg,type,status:'open',createdAt:serverTimestamp()});document.getElementById('ticketSubject').value='';document.getElementById('ticketMsg').value='';toast('âœ“ Ticket terkirim!');loadMyTickets();}catch(e){toast('âš  Gagal');}
  btn.disabled=false;btn.textContent='ðŸ“¨  KIRIM TICKET';
}
async function loadMyTickets(){
  if(!currentUser)return;const el=document.getElementById('myTicketList');
  el.innerHTML='<div style="text-align:center;padding:16px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Memuat...</div>';
  try{
    const q=query(collection(db,'tickets'),where('uid','==',currentUser.uid),orderBy('createdAt','desc'),limit(20));const snap=await getDocs(q);const tickets=[];snap.forEach(d=>tickets.push({id:d.id,...d.data()}));
    if(!tickets.length){el.innerHTML='<div style="text-align:center;padding:16px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada ticket.</div>';return;}
    el.innerHTML=tickets.map(t=>`<div class="ticket-row"><div class="ticket-top"><div><div class="ticket-subject">${t.subject}</div><div class="ticket-meta">${t.type} Â· ${t.createdAt?.toDate?t.createdAt.toDate().toLocaleString('id-ID'):''}</div></div><div class="ticket-status ${t.status}">${t.status==='open'?'â³ OPEN':t.status==='replied'?'ðŸ’¬ REPLIED':'âœ“ CLOSED'}</div></div><div class="ticket-msg">${t.message}</div>${t.adminReply?`<div class="ticket-reply"><span class="ticket-reply-label">ðŸ‘‘ Admin:</span> ${t.adminReply}</div>`:''}</div>`).join('');
  }catch(e){}
}

// TOPUP
let pendingPkg=null,selectedBank=null;
window.openPayment=function(c,p){pendingPkg={coins:c,price:p};selectedBank=null;document.getElementById('modalInner').innerHTML=`<div class="modal-title">Konfirmasi Topup</div><div class="modal-sub">Pilih metode pembayaran</div><div class="modal-order"><div class="modal-order-left"><div class="label">Paket</div><div class="val">${c} Coins</div></div><div class="modal-order-right"><div class="label">Total</div><div class="val">${p}</div></div></div><div class="bank-cards"><div class="bank-card" onclick="selBank(this,'BCA','123 4567 890','ADMIN DEV')"><div class="bank-logo bca">BCA</div><div class="bank-info"><div class="bank-name">Bank BCA</div><div class="bank-num">123 4567 890</div><div class="bank-holder">a.n. ADMIN DEV</div></div><div class="bank-radio"></div></div><div class="bank-card" onclick="selBank(this,'DANA','0877-2903-5761','ADMIN DEV')"><div class="bank-logo dana">DANA</div><div class="bank-info"><div class="bank-name">DANA</div><div class="bank-num">0877-2903-5761</div><div class="bank-holder">ADMIN DEV</div></div><div class="bank-radio"></div></div><div class="bank-card" onclick="selBank(this,'OVO','0877-2903-5761','ADMIN DEV')"><div class="bank-logo ovo">OVO</div><div class="bank-info"><div class="bank-name">OVO</div><div class="bank-num">0877-2903-5761</div><div class="bank-holder">ADMIN DEV</div></div><div class="bank-radio"></div></div></div><div class="modal-note">Setelah transfer, chat Admin WA. Coin aktif dalam <strong>1Ã—24 jam</strong>.</div><button class="btn-confirm" onclick="confirmPay()"><div class="shim"></div>KONFIRMASI</button>`;document.getElementById('modalBg').classList.add('show');}
window.selBank=function(el,bank,num,holder){document.querySelectorAll('.bank-card').forEach(b=>b.classList.remove('selected'));el.classList.add('selected');selectedBank={bank,num,holder};}
window.confirmPay=async function(){
  if(!selectedBank)return toast('âš  Pilih metode dulu!');
  const orderId='DEV-'+Date.now().toString(36).toUpperCase();
  try{await addDoc(collection(db,'orders'),{uid:currentUser.uid,userEmail:currentUser.email,userName:currentUserData.name,orderId,coins:pendingPkg.coins,price:pendingPkg.price,method:selectedBank.bank,status:'pending',createdAt:serverTimestamp()});}catch(e){}
  const waMsg=encodeURIComponent(`Halo Admin DEV! ðŸ‘‹\n\nKonfirmasi topup:\nâ”â”â”â”â”â”â”â”â”â”â”\nðŸ‘¤ ${currentUserData.name}\nðŸ“§ ${currentUser.email}\nðŸ“¦ ${pendingPkg.coins} Coins\nðŸ’° ${pendingPkg.price}\nðŸ¦ ${selectedBank.bank} (${selectedBank.num})\nðŸ†” ${orderId}\nâ”â”â”â”â”â”â”â”â”â”â”\nBukti terlampir ðŸ™`);
  document.getElementById('modalInner').innerHTML=`<div class="success-modal"><div class="success-icon">âœ“</div><div class="success-title">Order Dibuat!</div><div class="success-text">Transfer <strong style="color:var(--gold)">${pendingPkg.price}</strong> ke <strong style="color:var(--teal)">${selectedBank.bank}</strong><br>No: <strong style="color:var(--gold2)">${selectedBank.num}</strong></div><div class="order-id" onclick="cp('${orderId}')">ðŸ†” ${orderId}</div><a href="https://wa.me/${ADMIN_WA}?text=${waMsg}" target="_blank" style="display:block;text-decoration:none;margin:12px 0 8px"><button class="btn-confirm" style="background:linear-gradient(135deg,#25d366,#128c7e)"><div class="shim"></div>ðŸ’¬ CHAT ADMIN WA</button></a><button class="btn-confirm" onclick="closeModal()" style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--muted2);box-shadow:none">Tutup</button></div>`;
  toast('âœ“ Order: '+orderId);
}
window.closeModal=function(){document.getElementById('modalBg').classList.remove('show');}

// ADMIN
async function loadAdminData(){
  document.getElementById('adminLoading').style.display='block';document.getElementById('adminContent').style.display='none';
  try{
    const usersSnap=await getDocs(collection(db,'users'));const users=[];usersSnap.forEach(d=>users.push({id:d.id,...d.data()}));
    const ordersSnap=await getDocs(query(collection(db,'orders'),orderBy('createdAt','desc'),limit(100)));const orders=[];ordersSnap.forEach(d=>orders.push({id:d.id,...d.data()}));
    const uploadsSnap=await getDocs(query(collection(db,'uploads'),orderBy('createdAt','desc'),limit(50)));const uploads=[];uploadsSnap.forEach(d=>uploads.push({id:d.id,...d.data()}));
    const ticketsSnap=await getDocs(query(collection(db,'tickets'),orderBy('createdAt','desc'),limit(50)));const tickets=[];ticketsSnap.forEach(d=>tickets.push({id:d.id,...d.data()}));
    const promosSnap=await getDocs(collection(db,'promos'));const promos=[];promosSnap.forEach(d=>promos.push({id:d.id,...d.data()}));

    document.getElementById('adminStatUsers').textContent=users.length;
    document.getElementById('adminStatOrders').textContent=orders.length;
    document.getElementById('adminStatUploads').textContent=uploads.length;
    document.getElementById('adminStatPending').textContent=orders.filter(o=>o.status==='pending').length;
    document.getElementById('adminStatTickets').textContent=tickets.filter(t=>t.status==='open').length;
    const confirmed=orders.filter(o=>o.status==='confirmed');
    const revenue=confirmed.reduce((a,o)=>{const p=parseInt((o.price||'0').replace(/\D/g,''));return a+(isNaN(p)?0:p);},0);
    document.getElementById('adminStatRevenue').textContent='Rp '+revenue.toLocaleString('id-ID');

    // Revenue chart
    const mrev={};confirmed.forEach(o=>{if(!o.createdAt?.toDate)return;const m=o.createdAt.toDate().toLocaleDateString('id-ID',{month:'short'});const p=parseInt((o.price||'0').replace(/\D/g,''));mrev[m]=(mrev[m]||0)+(isNaN(p)?0:p);});
    const maxRev=Math.max(...Object.values(mrev),1);
    document.getElementById('revenueChart').innerHTML=Object.entries(mrev).slice(-6).map(([m,v])=>`<div class="bar-col"><div class="bar-wrap"><div class="bar-fill" style="height:${(v/maxRev)*100}%;background:linear-gradient(180deg,var(--green),var(--teal))">${v>0?`<span class="bar-val" style="font-size:8px">Rp${(v/1000).toFixed(0)}k</span>`:''}</div></div><div class="bar-label">${m}</div></div>`).join('')||'<div style="color:var(--muted);font-size:11px;font-family:DM Mono,monospace;padding:16px;text-align:center">Belum ada data</div>';

    // Retention chart (users by join date cohort)
    const joinByDay={};
    users.forEach(u=>{if(!u.createdAt?.toDate)return;const d=u.createdAt.toDate().toLocaleDateString('id-ID',{weekday:'short'});joinByDay[d]=(joinByDay[d]||0)+1;});
    const days7=['Min','Sen','Sel','Rab','Kam','Jum','Sab'];
    const retEl=document.getElementById('retentionChart');
    if(retEl){
      const maxJ=Math.max(...days7.map(d=>joinByDay[d]||0),1);
      retEl.innerHTML=days7.map(d=>{const v=joinByDay[d]||0;const pct=Math.round(v/maxJ*100);return`<div class="retention-bar"><div class="retention-label">${d}</div><div class="retention-track"><div class="retention-fill" style="width:${pct}%;background:linear-gradient(90deg,var(--teal),var(--green))"></div></div><div class="retention-pct">${v}</div></div>`;}).join('');
    }

    // Activity heatmap (28 days of uploads)
    const heatEl=document.getElementById('activityHeatmap');
    if(heatEl){
      const uploadsByDay={};uploads.forEach(u=>{if(!u.createdAt?.toDate)return;const d=u.createdAt.toDate().toLocaleDateString('id-ID');uploadsByDay[d]=(uploadsByDay[d]||0)+1;});
      const maxU=Math.max(...Object.values(uploadsByDay),1);
      const cells=[];
      for(let i=27;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);const key=d.toLocaleDateString('id-ID');const v=uploadsByDay[key]||0;const intensity=v===0?'rgba(255,255,255,0.04)':v<maxU*0.33?'rgba(201,168,76,0.25)':v<maxU*0.66?'rgba(201,168,76,0.5)':'var(--gold)';cells.push(`<div class="heatmap-cell" style="background:${intensity}" title="${d.toLocaleDateString('id-ID')}: ${v} upload"></div>`);}
      heatEl.innerHTML=cells.join('');
    }

    // Admin chat list
    try {
      const chatMetaSnap=await getDocs(query(collection(db,'chatMeta'),orderBy('lastMsgAt','desc'),limit(20)));
      const chatMetas=[]; chatMetaSnap.forEach(d=>chatMetas.push({id:d.id,...d.data()}));
      const chatListEl=document.getElementById('adminChatList');
      chatListEl.innerHTML=chatMetas.length?`<div class="admin-chat-list">${chatMetas.map(c=>`
        <div class="admin-chat-item" onclick="openAdminChat('${c.uid}','${c.userName}')">
          <div class="admin-chat-item-top">
            <div class="admin-chat-user">${c.avatarEmoji||'âš¡'} ${c.userName||'User'}</div>
            <div style="display:flex;align-items:center;gap:6px">
              ${c.unreadAdmin>0?`<div class="admin-chat-unread">${c.unreadAdmin}</div>`:''}
              <div class="admin-chat-time">${c.lastMsgAt?.toDate?c.lastMsgAt.toDate().toLocaleString('id-ID',{hour:'2-digit',minute:'2-digit'}):''}</div>
            </div>
          </div>
          <div class="admin-chat-preview">${c.lastMsg||'â€”'}</div>
        </div>`).join('')}</div>`
      :'<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada chat</div>';
    } catch(e){}


    // Users
    document.getElementById('adminUserList').innerHTML=users.map(u=>`<div class="admin-user-card ${u.isBanned?'banned':''}"><div class="admin-user-top"><div class="admin-user-avatar">${u.avatarEmoji||'âš¡'}</div><div class="admin-user-info"><div class="admin-user-name">${u.name||'Unknown'} ${u.isAdmin?'<span class="badge-admin">ADMIN</span>':''} ${u.isBanned?'<span class="badge-banned">BANNED</span>':''}</div><div class="admin-user-email">${u.email}</div>${u.waNumber?`<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--green)">ðŸ“± +${u.waNumber}</div>`:''}<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">ðŸ‘¥ Ref: ${u.referralCount||0} Â· ðŸ“¤ ${u.totalUploads||0}</div></div><div class="admin-user-coins"><span class="coins-display">âœ¦ ${u.coins||0}</span></div></div><div class="admin-user-actions"><input class="finput" type="number" id="coinInp_${u.id}" placeholder="Jumlah" style="flex:1;padding:7px 10px;font-size:12px"><button class="btn-add-coin" onclick="addCoins('${u.id}','${u.name}','${u.waNumber||''}')">+ Add</button><button class="btn-sub-coin" onclick="subCoins('${u.id}','${u.name}')">- Sub</button><button class="btn-set-coin" onclick="setCoins('${u.id}','${u.name}')">Set</button>${!u.isAdmin?`<button class="${u.isBanned?'btn-add-coin':'btn-sub-coin'}" onclick="toggleBan('${u.id}','${u.name}',${!!u.isBanned})">${u.isBanned?'âœ“ Unban':'ðŸš« Ban'}</button>`:''}</div></div>`).join('');

    // Orders
    document.getElementById('adminOrderList').innerHTML=orders.length?orders.map(o=>`<div class="admin-order-card ${o.status}"><div class="admin-order-top"><div><div class="admin-order-id">${o.orderId}</div><div class="admin-order-user">${o.userName} Â· ${o.userEmail}</div></div><div class="admin-order-status ${o.status}">${o.status==='pending'?'â³ PENDING':'âœ“ CONFIRMED'}</div></div><div class="admin-order-detail">${o.coins} Coins Â· ${o.price} Â· ${o.method}<br><span style="font-size:9px;color:var(--muted)">${o.createdAt?.toDate?o.createdAt.toDate().toLocaleString('id-ID'):''}</span></div>${o.status==='pending'?`<button class="btn-confirm-order" onclick="confirmOrder('${o.id}','${o.uid}',${o.coins},'${o.orderId}')">âœ“ Konfirmasi & Tambah Coin</button>`:''}</div>`).join(''):'<div style="text-align:center;padding:20px;color:var(--muted);font-family:DM Mono,monospace;font-size:11px">Belum ada order</div>';

    // Tickets
    document.getElementById('adminTicketList').innerHTML=tickets.length?tickets.map(t=>`<div class="admin-order-card ${t.status==='open'?'pending':'confirmed'}"><div class="admin-order-top"><div><div class="admin-order-id">ðŸŽ« ${t.subject}</div><div class="admin-order-user">${t.userName} Â· ${t.type}</div></div><div class="admin-order-status ${t.status==='open'?'pending':'confirmed'}">${t.status==='open'?'â³ OPEN':t.status==='replied'?'ðŸ’¬ REPLIED':'âœ“ CLOSED'}</div></div><div class="admin-order-detail" style="font-size:11px">${t.message}</div>${t.status!=='closed'?`<div style="display:flex;gap:7px;margin-top:7px"><input class="finput" id="reply_${t.id}" placeholder="Balas..." style="flex:1;padding:8px 11px;font-size:12px"><button class="btn-confirm-order" style="white-space:nowrap" onclick="replyTicket('${t.id}','${t.uid}')">Kirim</button><button class="btn-set-coin" onclick="closeTicket('${t.id}')">Tutup</button></div>`:''}${t.adminReply?`<div class="ticket-reply" style="margin-top:7px"><span class="ticket-reply-label">ðŸ‘‘ Admin:</span> ${t.adminReply}</div>`:''}</div>`).join(''):'<div style="text-align:center;padding:20px;color:var(--muted);font-family:DM Mono,monospace;font-size:11px">Belum ada ticket</div>';

    // Promos
    document.getElementById('promoList').innerHTML=promos.length?promos.map(p=>`<div class="admin-order-card ${p.active?'confirmed':''}"><div class="admin-order-top"><div><div class="admin-order-id">ðŸŽŸï¸ ${p.code}</div><div class="admin-order-user">+${p.coinBonus} Coins Â· ${p.usedCount||0}/${p.maxUses||'âˆž'} dipakai</div></div><div class="admin-order-status ${p.active?'confirmed':'pending'}">${p.active?'âœ“ AKTIF':'âœ• MATI'}</div></div><button class="${p.active?'btn-sub-coin':'btn-add-coin'}" style="width:100%;margin-top:8px" onclick="togglePromo('${p.id}',${!!p.active})">${p.active?'Nonaktifkan':'Aktifkan'}</button></div>`).join(''):'<div style="text-align:center;padding:12px;color:var(--muted);font-family:DM Mono,monospace;font-size:11px">Belum ada promo</div>';

    // Uploads
    document.getElementById('adminUploadList').innerHTML=uploads.length?uploads.map(u=>`<div class="hist-item" style="margin-bottom:7px"><div class="hist-item-top"><span class="hist-name">${u.assetName}</span><span class="hist-time">${u.createdAt?.toDate?u.createdAt.toDate().toLocaleString('id-ID'):''}</span></div><div style="font-family:DM Mono,monospace;font-size:9px;color:var(--muted2);margin-bottom:4px">${u.userName} Â· ${u.userEmail}</div><div class="hist-id" onclick="cp('${u.assetId}')">ID: ${u.assetId}</div><div class="hist-tags"><span class="hist-tag">${u.assetType}</span>${u.rating?`<span class="hist-tag" style="color:var(--gold)">${'â˜…'.repeat(u.rating)}</span>`:''}</div></div>`).join(''):'<div style="text-align:center;padding:20px;color:var(--muted);font-family:DM Mono,monospace;font-size:11px">Belum ada upload</div>';
  }catch(e){console.error(e);}
  document.getElementById('adminLoading').style.display='none';document.getElementById('adminContent').style.display='block';
}

window.addCoins=async function(uid,name,waNumber){
  const val=parseInt(document.getElementById('coinInp_'+uid).value);if(!val||val<=0)return toast('âš  Masukkan jumlah!');
  await updateDoc(doc(db,'users',uid),{coins:increment(val)});
  await addDoc(collection(db,'notifications'),{uid,title:'âœ¦ Coin Masuk!',message:`+${val} Coin telah ditambahkan`,icon:'âœ¦',read:false,createdAt:serverTimestamp()});
  toast(`âœ“ +${val} â†’ ${name}`);
  if(waNumber){const waMsg=encodeURIComponent(`ðŸ”” *DEV Uploader*\n\nHai ${name}! âœ¦ *${val} Coin* masuk!\nCek: devv-uploader.vercel.app ðŸš€`);window.open(`https://wa.me/${waNumber}?text=${waMsg}`,'_blank');}
  loadAdminData();
}
window.subCoins=async function(uid,name){const val=parseInt(document.getElementById('coinInp_'+uid).value);if(!val||val<=0)return toast('âš  Masukkan jumlah!');await updateDoc(doc(db,'users',uid),{coins:increment(-val)});toast(`âœ“ -${val} dari ${name}`);loadAdminData();}
window.setCoins=async function(uid,name){const val=parseInt(document.getElementById('coinInp_'+uid).value);if(isNaN(val))return toast('âš  Masukkan jumlah!');await updateDoc(doc(db,'users',uid),{coins:val});toast(`âœ“ Coin ${name} = ${val}`);loadAdminData();}
window.toggleBan=async function(uid,name,isBanned){if(!confirm(`${isBanned?'Unban':'Ban'} user ${name}?`))return;await updateDoc(doc(db,'users',uid),{isBanned:!isBanned});if(!isBanned)await addDoc(collection(db,'notifications'),{uid,title:'ðŸš« Akun Disuspend',message:'Akun kamu disuspend oleh admin.',icon:'ðŸš«',read:false,createdAt:serverTimestamp()});toast(`âœ“ ${isBanned?'Unban':'Ban'}: ${name}`);loadAdminData();}
window.confirmOrder=async function(orderId,uid,coins,vipTierOrCode,type){
  // Handle both old and new call signatures
  const isVip = type==='vip';
  const vipTier = isVip ? vipTierOrCode : null;
  if(!confirm(`Konfirmasi order ini?`))return;
  await updateDoc(doc(db,'orders',orderId),{status:'confirmed',confirmedAt:serverTimestamp()});
  if(isVip && vipTier){
    const expiry=new Date(Date.now()+30*24*60*60*1000).toISOString();
    await updateDoc(doc(db,'users',uid),{vipTier,vipExpiry:expiry});
    // Sync if current user
    if(currentUser&&uid===currentUser.uid){currentUserData.vipTier=vipTier;currentUserData.vipExpiry=expiry;updateUI();}
    await addDoc(collection(db,'notifications'),{uid,title:`ðŸ‘‘ VIP ${vipTier.toUpperCase()} Aktif!`,message:`VIP ${vipTier} kamu sudah aktif 30 hari!`,icon:'ðŸ‘‘',read:false,createdAt:serverTimestamp()});
  } else if(coins>0){
    await updateDoc(doc(db,'users',uid),{coins:increment(coins)});
    if(currentUser&&uid===currentUser.uid){currentUserData.coins=(currentUserData.coins||0)+coins;updateUI();}
    const userSnap=await getDoc(doc(db,'users',uid));const ud=userSnap.data();
    if(ud?.waNumber){const waMsg=encodeURIComponent(`ðŸ”” *DEV Uploader*\n\nHai ${ud.name}! âœ¦ *${coins} Coin* masuk!\nCek: devv-uploader.vercel.app ðŸš€`);window.open(`https://wa.me/${ud.waNumber}?text=${waMsg}`,'_blank');}
    if(ud?.email)await sendEmailNotif(ud.email,ud.name,'âœ¦ Topup Dikonfirmasi!',`+${coins} Coin telah masuk ke akun kamu!`);
    await addDoc(collection(db,'notifications'),{uid,title:'âœ… Topup Dikonfirmasi!',message:`+${coins} Coins sudah masuk ke akun kamu!`,icon:'âœ…',read:false,createdAt:serverTimestamp()});
  }
  toast(`âœ“ Order dikonfirmasi!`);loadAdminData();
}
window.replyTicket=async function(id,uid){
  // Support both old (reply_) and new (replyInp_) input IDs
  const reply=(document.getElementById('replyInp_'+id)||document.getElementById('reply_'+id))?.value?.trim();
  if(!reply)return toast('âš  Ketik balasan!');
  await updateDoc(doc(db,'tickets',id),{status:'replied',adminReply:reply,repliedAt:serverTimestamp()});
  await addDoc(collection(db,'notifications'),{uid,title:'ðŸ’¬ Ticket Dibalas!',message:reply.slice(0,100),icon:'ðŸ’¬',read:false,createdAt:serverTimestamp()});
  const us=await getDoc(doc(db,'users',uid));const uData=us.data();
  if(uData?.waNumber){const waMsg=encodeURIComponent(`ðŸ’¬ *Balas Ticket DEV Uploader*\n\n${reply}`);window.open(`https://wa.me/${uData.waNumber}?text=${waMsg}`,'_blank');}
  toast('âœ“ Balasan terkirim!');loadAdminData();
}
window.closeTicket=async function(id){await updateDoc(doc(db,'tickets',id),{status:'closed'});toast('âœ“ Ticket ditutup');loadAdminData();}
window.togglePromo=async function(id,active){await updateDoc(doc(db,'promos',id),{active:!active});toast(`âœ“ Promo ${active?'dinonaktifkan':'diaktifkan'}`);loadAdminData();}

// UTILS
window.cp=function(text){navigator.clipboard.writeText(text).then(()=>toast('âœ“ Copied!'));}
window.toast=function(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2800);}
function showResult(type,hdr,body){const el=document.getElementById('result');if(!type){el.className='result';return;}el.className='result show '+type;document.getElementById('resultHdr').innerHTML=hdr;document.getElementById('resultBody').innerHTML=body;}
function fmtBytes(b){if(b<1024)return b+' B';if(b<1048576)return(b/1024).toFixed(1)+' KB';return(b/1048576).toFixed(1)+' MB';}
window.doRegister=async function(){const name=document.getElementById('regName').value.trim(),email=document.getElementById('regEmail').value.trim(),pass=document.getElementById('regPass').value,pass2=document.getElementById('regPass2').value;if(!name||!email||!pass)return showAuthErr('Semua field harus diisi!');if(pass!==pass2)return showAuthErr('Password tidak sama!');if(pass.length<6)return showAuthErr('Password minimal 6 karakter!');document.getElementById('btnRegister').disabled=true;try{const c=await createUserWithEmailAndPassword(auth,email,pass);await updateProfile(c.user,{displayName:name});}catch(e){showAuthErr(getAuthError(e.code));}document.getElementById('btnRegister').disabled=false;}
window.doLogin=async function(){const email=document.getElementById('loginEmail').value.trim(),pass=document.getElementById('loginPass').value;if(!email||!pass)return showAuthErr('Isi email dan password!');document.getElementById('btnLogin').disabled=true;try{await signInWithEmailAndPassword(auth,email,pass);}catch(e){showAuthErr(getAuthError(e.code));}document.getElementById('btnLogin').disabled=false;}
window.doGoogle=async function(){try{await signInWithPopup(auth,googleProvider);}catch(e){showAuthErr('Login Google gagal');}}
window.doLogout=async function(){if(!confirm('Yakin mau logout?'))return;await signOut(auth);}
function getAuthError(code){const m={'auth/email-already-in-use':'Email sudah terdaftar!','auth/invalid-email':'Format email tidak valid!','auth/weak-password':'Password minimal 6 karakter!','auth/user-not-found':'Email tidak ditemukan!','auth/wrong-password':'Password salah!','auth/invalid-credential':'Email atau password salah!','auth/too-many-requests':'Terlalu banyak percobaan!'};return m[code]||'Error: '+code;}
function showAuthErr(msg){const el=document.getElementById('authErr');el.textContent=msg;el.style.display='block';setTimeout(()=>el.style.display='none',4000);}
window.switchTab=function(btn,panel){document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));btn.classList.add('active');document.getElementById('panel-'+panel).classList.add('active');moveSlider(btn);if(panel==='history')loadHistory();if(panel==='settings')loadSettings();if(panel==='dashboard')loadDashboard();if(panel==='leaderboard')loadLeaderboard();if(panel==='support')loadMyTickets();if(panel==='notif')loadNotifications();if(panel==='badges')checkBadges();if(panel==='missions')renderMissions();if(panel==='audio')setTimeout(drawWaveform,100);if(panel==='spin'){setTimeout(()=>{initSpinWheel();},100);}if(panel==='vip')loadVipStatus();}
function moveSlider(btn){const tabs=document.getElementById('tabs'),slider=document.getElementById('tabSlider');if(!tabs||!slider)return;const tr=tabs.getBoundingClientRect(),br=btn.getBoundingClientRect();slider.style.left=(br.left-tr.left-4)+'px';slider.style.width=br.width+'px';}
setTimeout(()=>{const a=document.querySelector('.tab-btn.active');if(a)moveSlider(a);},200);
window.switchAuthTab=function(tab){document.querySelectorAll('.auth-tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.auth-form').forEach(f=>f.classList.remove('active'));event.target.classList.add('active');document.getElementById('form-'+tab).classList.add('active');document.getElementById('authErr').style.display='none';}
window.goAdmin=function(){showAdmin();}
window.goApp=function(){showApp();}

// Show referral hint if came from ref link
const urlP=new URLSearchParams(window.location.search);
if(urlP.get('ref')){const hint=document.getElementById('refHint');if(hint)hint.style.display='block';}

// Drag and drop
const dzEl=document.getElementById('dz');
if(dzEl){dzEl.addEventListener('dragover',e=>{e.preventDefault();dzEl.classList.add('over');});dzEl.addEventListener('dragleave',()=>dzEl.classList.remove('over'));dzEl.addEventListener('drop',e=>{e.preventDefault();dzEl.classList.remove('over');const f=e.dataTransfer.files[0];if(!f)return;const dt=new DataTransfer();dt.items.add(f);document.getElementById('fi').files=dt.files;window.handleFile(document.getElementById('fi'));});}

// â•â• AUDIO EDITOR â•â•
let audioCtx=null,audioBuffer=null,originalBuffer=null;
let audioSource=null,isPlaying=false,isLooping=false;
let startTime=0,pauseOffset=0;
let selStart=-1,selEnd=-1,isDraggingWave=false,dragAnchor=0;
let gainNode=null,currentFmt='wav';
let fxState={reverse:false,stereo:false,bass:false,treble:false,echo:false};
let volVal=100,pitchVal=0,speedVal=100,fadeInVal=0,fadeOutVal=0,noiseVal=0;
let rafAudio=null,originalFileName='audio_edit';

window.loadAudioFile=async function(inp){
  const f=inp.files[0];if(!f)return;
  originalFileName=f.name.replace(/\.[^.]+$/,'');
  document.getElementById('aFileSize').textContent=fmtBytes(f.size);
  try{
    if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
    if(audioCtx.state==='suspended')await audioCtx.resume();
    const ab=await f.arrayBuffer();
    audioBuffer=await audioCtx.decodeAudioData(ab);
    originalBuffer=audioBuffer;
    document.getElementById('audioInfoBar').style.display='grid';
    document.getElementById('audioEditorMain').style.display='block';
    document.getElementById('aDuration').textContent=fmtTime(audioBuffer.duration);
    document.getElementById('aSampleRate').textContent=(audioBuffer.sampleRate/1000).toFixed(1)+'k';
    document.getElementById('aChannels').textContent=audioBuffer.numberOfChannels===1?'Mono':'Stereo';
    selStart=-1;selEnd=-1;pauseOffset=0;
    setTimeout(()=>{drawWaveform();initWaveEvents();},200);
    toast('âœ“ Audio dimuat: '+f.name);
  }catch(e){toast('âœ• Gagal: '+e.message);console.error(e);}
};

function drawWaveform(){
  const canvas=document.getElementById('waveformCanvas');
  if(!canvas)return;
  const wrap=document.getElementById('waveformWrap');
  const W=wrap.clientWidth-24,H=80;
  canvas.width=W;canvas.height=H;
  const ctx=canvas.getContext('2d');
  ctx.clearRect(0,0,W,H);
  if(!audioBuffer){
    ctx.fillStyle='rgba(167,139,250,0.2)';
    ctx.fillRect(0,H/2-1,W,2);
    return;
  }
  const data=audioBuffer.getChannelData(0);
  const step=Math.max(1,Math.floor(data.length/W));
  // grid
  ctx.strokeStyle='rgba(167,139,250,0.1)';ctx.lineWidth=1;
  for(let i=1;i<4;i++){ctx.beginPath();ctx.moveTo(0,(H/4)*i);ctx.lineTo(W,(H/4)*i);ctx.stroke();}
  // waveform gradient
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,'rgba(200,160,255,1)');
  grad.addColorStop(0.5,'rgba(167,139,250,0.8)');
  grad.addColorStop(1,'rgba(200,160,255,1)');
  ctx.fillStyle=grad;
  for(let i=0;i<W;i++){
    let mn=1,mx=-1;
    for(let j=0;j<step;j++){const v=data[Math.min(i*step+j,data.length-1)]||0;if(v<mn)mn=v;if(v>mx)mx=v;}
    const y=((1+mn)/2)*H,h=Math.max(2,((mx-mn)/2)*H);
    ctx.fillRect(i,y,1,h);
  }
  // center line
  ctx.strokeStyle='rgba(167,139,250,0.3)';ctx.beginPath();ctx.moveTo(0,H/2);ctx.lineTo(W,H/2);ctx.stroke();
  // selection overlay
  const sel=document.getElementById('waveformSel');
  if(sel&&selStart>=0&&selEnd>selStart){
    const dur=audioBuffer.duration;
    sel.style.display='block';
    sel.style.left=(selStart/dur)*W+'px';
    sel.style.width=((selEnd-selStart)/dur)*W+'px';
  }else if(sel)sel.style.display='none';
}

function getEvtX(e,el){
  const r=el.getBoundingClientRect();
  const cx=e.touches?e.touches[0].clientX:e.clientX;
  return Math.max(0,Math.min(1,(cx-r.left)/r.width));
}

function initWaveEvents(){
  const canvas=document.getElementById('waveformCanvas');
  if(!canvas||canvas._waveInit)return;
  canvas._waveInit=true;
  function onStart(e){
    if(!audioBuffer)return;
    e.preventDefault();
    isDraggingWave=true;
    dragAnchor=getEvtX(e,canvas)*audioBuffer.duration;
    selStart=dragAnchor;selEnd=dragAnchor;
    drawWaveform();
  }
  function onMove(e){
    if(!isDraggingWave||!audioBuffer)return;
    e.preventDefault();
    const t=getEvtX(e,canvas)*audioBuffer.duration;
    selStart=Math.min(dragAnchor,t);
    selEnd=Math.max(dragAnchor,t);
    drawWaveform();
  }
  function onEnd(){isDraggingWave=false;}
  canvas.addEventListener('mousedown',onStart);
  window.addEventListener('mousemove',onMove);
  window.addEventListener('mouseup',onEnd);
  canvas.addEventListener('touchstart',onStart,{passive:false});
  window.addEventListener('touchmove',onMove,{passive:false});
  window.addEventListener('touchend',onEnd);
  canvas.addEventListener('contextmenu',e=>{e.preventDefault();selStart=-1;selEnd=-1;drawWaveform();});
}

function tickProgress(){
  if(!audioBuffer||!audioCtx)return;
  const cur=isPlaying?(audioCtx.currentTime-startTime+pauseOffset):pauseOffset;
  const c=Math.min(cur,audioBuffer.duration);
  const td=document.getElementById('audioTimeDisplay');
  if(td)td.textContent=fmtTime(c)+' / '+fmtTime(audioBuffer.duration);
  const pb=document.getElementById('waveProgressBar');
  if(pb)pb.style.width=(c/audioBuffer.duration*100)+'%';
  if(isPlaying)rafAudio=requestAnimationFrame(tickProgress);
}

window.togglePlay=async function(){
  if(!audioBuffer)return toast('âš  Load audio dulu!');
  if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  if(audioCtx.state==='suspended')await audioCtx.resume();
  isPlaying?pauseAudio():playAudio();
};

function playAudio(){
  stopAudio(true);
  const buf=buildProcessedBuffer();
  audioSource=audioCtx.createBufferSource();
  audioSource.buffer=buf;
  audioSource.loop=isLooping;
  audioSource.playbackRate.value=speedVal/100;
  gainNode=audioCtx.createGain();
  gainNode.gain.value=volVal/100;
  const now=audioCtx.currentTime;
  const dur=buf.duration;
  if(fadeInVal>0){gainNode.gain.setValueAtTime(0,now);gainNode.gain.linearRampToValueAtTime(volVal/100,now+fadeInVal/10);}
  if(fadeOutVal>0&&dur>fadeOutVal/10){gainNode.gain.setValueAtTime(volVal/100,now+dur-fadeOutVal/10);gainNode.gain.linearRampToValueAtTime(0,now+dur);}
  audioSource.connect(gainNode);gainNode.connect(audioCtx.destination);
  const offset=Math.min(pauseOffset,dur-0.01);
  audioSource.start(0,offset);
  startTime=audioCtx.currentTime;isPlaying=true;
  const btn=document.getElementById('btnPlay');if(btn)btn.textContent='â¸ Pause';
  audioSource.onended=()=>{
    if(!isLooping){isPlaying=false;pauseOffset=0;const b=document.getElementById('btnPlay');if(b)b.textContent='â–¶ Play';cancelAnimationFrame(rafAudio);}
  };
  tickProgress();
}

function pauseAudio(){
  if(!audioSource)return;
  pauseOffset+=audioCtx.currentTime-startTime;
  try{audioSource.stop();}catch(e){}
  isPlaying=false;
  const btn=document.getElementById('btnPlay');if(btn)btn.textContent='â–¶ Play';
  cancelAnimationFrame(rafAudio);
}

window.stopAudio=function(keep=false){
  if(audioSource){try{audioSource.stop();}catch(e){}audioSource=null;}
  isPlaying=false;if(!keep)pauseOffset=0;
  const btn=document.getElementById('btnPlay');if(btn)btn.textContent='â–¶ Play';
  cancelAnimationFrame(rafAudio);
};

window.toggleLoop=function(){
  isLooping=!isLooping;
  const btn=document.getElementById('btnLoop');if(btn)btn.classList.toggle('active',isLooping);
  if(audioSource)audioSource.loop=isLooping;
};

function buildProcessedBuffer(){
  if(!audioBuffer||!audioCtx)return audioBuffer;
  const sr=audioBuffer.sampleRate,ch=audioBuffer.numberOfChannels,len=audioBuffer.length;
  const nb=audioCtx.createBuffer(ch,len,sr);
  for(let c=0;c<ch;c++){
    const src=audioBuffer.getChannelData(c);
    const dst=nb.getChannelData(c);
    for(let i=0;i<len;i++){
      let s=fxState.reverse?src[len-1-i]:src[i];
      if(noiseVal>0)s+=(Math.random()*2-1)*(noiseVal/100)*0.25;
      if(fxState.bass&&i>0)s=s*0.6+(dst[i-1]||0)*0.6;
      if(fxState.treble&&i>0)s=s+(s-(src[i-1]||0))*1.5;
      dst[i]=Math.max(-1,Math.min(1,s));
    }
    if(fadeInVal>0){const fs=Math.floor(sr*fadeInVal/10);for(let i=0;i<Math.min(fs,len);i++)dst[i]*=(i/fs);}
    if(fadeOutVal>0){const fs=Math.floor(sr*fadeOutVal/10);for(let i=0;i<Math.min(fs,len);i++)dst[len-1-i]*=(i/fs);}
  }
  return nb;
}

window.trimAudio=function(){
  if(!audioBuffer||selStart<0||selEnd<=selStart)return toast('âš  Klik & drag di waveform untuk pilih area!');
  const sr=audioBuffer.sampleRate,ch=audioBuffer.numberOfChannels;
  const s=Math.floor(selStart*sr),e=Math.floor(selEnd*sr);
  if(e<=s)return toast('âš  Area terlalu kecil!');
  const nb=audioCtx.createBuffer(ch,e-s,sr);
  for(let c=0;c<ch;c++)nb.getChannelData(c).set(audioBuffer.getChannelData(c).slice(s,e));
  audioBuffer=nb;selStart=-1;selEnd=-1;
  document.getElementById('aDuration').textContent=fmtTime(audioBuffer.duration);
  setTimeout(drawWaveform,50);toast('âœ“ Di-trim!');
};

window.resetAudio=function(){
  if(!originalBuffer)return;
  audioBuffer=originalBuffer;selStart=-1;selEnd=-1;pauseOffset=0;
  stopAudio();
  // reset sliders
  const resets=[['volSlider',100,window.updateVol],['pitchSlider',0,window.updatePitch],
    ['speedSlider',100,window.updateSpeed],['fadeInSlider',0,window.updateFadeIn],
    ['fadeOutSlider',0,window.updateFadeOut],['noiseSlider',0,window.updateNoise]];
  resets.forEach(([id,v,fn])=>{const el=document.getElementById(id);if(el)el.value=v;fn(v);});
  fxState={reverse:false,stereo:false,bass:false,treble:false,echo:false};
  ['reverse','stereo','bass','treble','echo'].forEach(f=>{const el=document.getElementById('fx-'+f);if(el)el.classList.remove('on');});
  document.getElementById('aDuration').textContent=fmtTime(audioBuffer.duration);
  setTimeout(drawWaveform,50);toast('âœ“ Reset!');
};

window.applyNormalize=function(){
  if(!audioBuffer)return;
  let maxAmp=0;
  for(let c=0;c<audioBuffer.numberOfChannels;c++){const d=audioBuffer.getChannelData(c);for(let i=0;i<d.length;i++)if(Math.abs(d[i])>maxAmp)maxAmp=Math.abs(d[i]);}
  if(maxAmp===0||maxAmp>=0.95)return toast('Sudah ternormalisasi!');
  const factor=0.95/maxAmp;
  const nb=audioCtx.createBuffer(audioBuffer.numberOfChannels,audioBuffer.length,audioBuffer.sampleRate);
  for(let c=0;c<audioBuffer.numberOfChannels;c++){const s=audioBuffer.getChannelData(c),d=nb.getChannelData(c);for(let i=0;i<s.length;i++)d[i]=s[i]*factor;}
  audioBuffer=nb;setTimeout(drawWaveform,50);toast('âœ“ Normalized!');
};

window.toggleEffect=function(fx){
  fxState[fx]=!fxState[fx];
  const el=document.getElementById('fx-'+fx);if(el)el.classList.toggle('on',fxState[fx]);
  toast((fxState[fx]?'âœ“ ON: ':'âœ• OFF: ')+fx);
};

// Sliders â€” update display langsung
window.updateVol=function(v){
  volVal=parseInt(v);
  const el=document.getElementById('volVal');if(el)el.textContent=v+'%';
  if(gainNode)gainNode.gain.value=v/100;
};
window.updatePitch=function(v){
  pitchVal=parseInt(v);
  const el=document.getElementById('pitchVal');if(el)el.textContent=(v>0?'+':'')+v+' st';
  // pitch shift hanya berlaku saat export / play ulang
};
window.updateSpeed=function(v){
  speedVal=parseInt(v);
  const el=document.getElementById('speedVal');if(el)el.textContent=(v/100).toFixed(2)+'x';
  if(audioSource)audioSource.playbackRate.value=v/100;
};
window.updateFadeIn=function(v){
  fadeInVal=parseInt(v);
  const el=document.getElementById('fadeInVal');if(el)el.textContent=(v/10).toFixed(1)+'s';
};
window.updateFadeOut=function(v){
  fadeOutVal=parseInt(v);
  const el=document.getElementById('fadeOutVal');if(el)el.textContent=(v/10).toFixed(1)+'s';
};
window.updateNoise=function(v){
  noiseVal=parseInt(v);
  const el=document.getElementById('noiseVal');if(el)el.textContent=v+'%';
};

window.selectFmt=function(fmt){
  currentFmt=fmt;
  document.querySelectorAll('.fmt-btn').forEach(b=>b.classList.remove('sel'));
  const fb=document.getElementById('fmt-'+fmt);if(fb)fb.classList.add('sel');
};

window.exportAudio=async function(){
  if(!audioBuffer)return toast('âš  Load audio dulu!');
  const btn=document.getElementById('btnExport');
  if(btn){btn.disabled=true;btn.textContent='â³ Memproses...';}
  try{
    const processed=buildProcessedBuffer();
    const wav=audioBufferToWav(processed);
    const blob=new Blob([wav],{type:'audio/wav'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download=originalFileName+'_edited.wav';a.click();
    URL.revokeObjectURL(url);
    toast('âœ“ Download dimulai!');
  }catch(e){toast('âœ• Gagal: '+e.message);console.error(e);}
  if(btn){btn.disabled=false;btn.innerHTML='ðŸ“¥ &nbsp; DOWNLOAD HASIL EDIT';}
};

function audioBufferToWav(buf){
  const ch=buf.numberOfChannels,sr=buf.sampleRate,len=buf.length,bLen=len*ch*2;
  const ab=new ArrayBuffer(44+bLen),v=new DataView(ab);
  function ws(o,s){for(let i=0;i<s.length;i++)v.setUint8(o+i,s.charCodeAt(i));}
  ws(0,'RIFF');v.setUint32(4,36+bLen,true);ws(8,'WAVE');ws(12,'fmt ');
  v.setUint32(16,16,true);v.setUint16(20,1,true);v.setUint16(22,ch,true);
  v.setUint32(24,sr,true);v.setUint32(28,sr*ch*2,true);v.setUint16(32,ch*2,true);
  v.setUint16(34,16,true);ws(36,'data');v.setUint32(40,bLen,true);
  let off=44;
  for(let i=0;i<len;i++)for(let c=0;c<ch;c++){
    const s=Math.max(-1,Math.min(1,buf.getChannelData(c)[i]));
    v.setInt16(off,s<0?s*0x8000:s*0x7FFF,true);off+=2;
  }
  return ab;
}

function fmtTime(s){const m=Math.floor(s/60),sc=Math.floor(s%60);return m+':'+(sc<10?'0':'')+sc;}

// â•â• UPLOAD PROGRESS BAR â•â•
function showUploadProgress(show) {
  const wrap = document.getElementById('uploadProgressWrap');
  if (!wrap) return;
  wrap.classList.toggle('show', show);
  if (show) { setStep(1,'active'); setStep(2,''); setStep(3,''); setStep(4,''); updateProgress(5); }
}
function setStep(n, state) {
  const el = document.getElementById('step'+n);
  if (!el) return;
  el.className = 'upload-step ' + state;
  el.querySelector('.upload-step-icon').textContent = state==='done'?'âœ…':state==='error'?'âŒ':state==='active'?['ðŸ“','â˜ï¸','ðŸ”„','âœ…'][n-1]:['ðŸ“','â˜ï¸','ðŸ”„','âœ…'][n-1];
  const fill = document.getElementById('step'+n+'fill');
  if (fill) fill.style.width = state==='done'?'100%':state==='active'?'50%':'0%';
}
function updateProgress(pct) {
  const fill = document.getElementById('uploadProgressFill');
  const pctEl = document.getElementById('uploadProgressPct');
  if (fill) fill.style.width = pct + '%';
  if (pctEl) pctEl.textContent = pct + '%';
}

// â•â• PREVIEW ASSET â•â•
let previewFile = null;
window.openPreview = function() {
  const f = selFile || (document.getElementById('fi').files[0]);
  if (!f) return toast('âš  Pilih file dulu!');
  previewFile = f;
  const ext = f.name.split('.').pop().toLowerCase();
  document.getElementById('previewFileName').textContent = f.name;
  document.getElementById('previewInfo').innerHTML = `
    <div class="preview-info-item"><div class="preview-info-val">${fmtBytes(f.size)}</div><div class="preview-info-lbl">Ukuran</div></div>
    <div class="preview-info-item"><div class="preview-info-val">${ext.toUpperCase()}</div><div class="preview-info-lbl">Format</div></div>
  `;
  const content = document.getElementById('previewContent');
  if (['png','jpg','jpeg'].includes(ext)) {
    const url = URL.createObjectURL(f);
    content.innerHTML = `<div class="preview-img-wrap"><img class="preview-img" src="${url}" onload="URL.revokeObjectURL(this.src)"></div>`;
  } else if (['mp3','ogg','wav'].includes(ext)) {
    const url = URL.createObjectURL(f);
    content.innerHTML = `<div class="preview-audio-wrap"><div class="preview-audio-icon">ðŸŽµ</div><audio class="preview-audio-player" controls src="${url}"></audio></div>`;
  } else if (ext === 'fbx') {
    content.innerHTML = `<div class="preview-fbx-wrap"><div class="preview-fbx-icon">ðŸ“¦</div><div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--muted)">File FBX (3D Mesh)<br>Preview tidak tersedia</div></div>`;
  }
  document.getElementById('previewModal').classList.add('show');
}
window.closePreview = function() { document.getElementById('previewModal').classList.remove('show'); }
window.confirmUploadFromPreview = function() { closePreview(); doUpload(); }

// â•â• SHARE ASSET â•â•
let shareAssetData = { name: '', id: '' };
window.openShare = function(name, assetId) {
  if (!assetId || assetId === 'Processing') return toast('âš  Asset masih processing, coba lagi nanti!');
  shareAssetData = { name, id: assetId };
  document.getElementById('shareAssetName').textContent = 'ðŸ“¦ ' + name + ' Â· ID: ' + assetId;
  const link = `https://www.roblox.com/catalog/${assetId}`;
  document.getElementById('shareLinkInput').value = link;
  document.getElementById('shareModal').classList.add('show');
}
window.closeShare = function() { document.getElementById('shareModal').classList.remove('show'); }
window.copyShareLink = async function() {
  const input = document.getElementById('shareLinkInput');
  try { await navigator.clipboard.writeText(input.value); toast('âœ“ Link disalin!'); }
  catch(e) { input.select(); document.execCommand('copy'); toast('âœ“ Link disalin!'); }
}
window.shareToWA = function() {
  const msg = encodeURIComponent(`ðŸŽ® Cek asset Roblox ini!\n\n*${shareAssetData.name}*\nID: ${shareAssetData.id}\n\nðŸ”— ${document.getElementById('shareLinkInput').value}\n\n_Diupload via DEV Uploader_`);
  window.open(`https://wa.me/?text=${msg}`, '_blank');
}
window.shareToTelegram = function() {
  const url = encodeURIComponent(document.getElementById('shareLinkInput').value);
  const text = encodeURIComponent(`ðŸŽ® ${shareAssetData.name} - Asset Roblox`);
  window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank');
}
window.shareToTwitter = function() {
  const text = encodeURIComponent(`ðŸŽ® Cek asset Roblox "${shareAssetData.name}" yang saya upload!\n${document.getElementById('shareLinkInput').value}\n#Roblox #RobloxDev`);
  window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
}

// â•â• VIP MEMBERSHIP â•â•
const VIP_TIERS = {
  free: { name:'FREE', icon:'âš¡', color:'var(--muted2)', desc:'Akun standar' },
  silver: { name:'SILVER', icon:'ðŸ¥ˆ', color:'#c0c0c0', desc:'Member Silver aktif' },
  gold: { name:'GOLD', icon:'ðŸ‘‘', color:'var(--gold2)', desc:'Member Gold aktif' },
  diamond: { name:'DIAMOND', icon:'ðŸ’Ž', color:'var(--teal)', desc:'Member Diamond aktif' }
};

function loadVipStatus() {
  if(!currentUserData)return;
  // Re-read from Firestore to ensure fresh data
  getDoc(doc(db,'users',currentUser.uid)).then(snap=>{
    if(snap.exists()){
      const fresh=snap.data();
      currentUserData.vipTier=fresh.vipTier||'free';
      currentUserData.vipExpiry=fresh.vipExpiry||null;
    }
    _syncVipUI(currentUserData.vipTier||'free');
  }).catch(()=>_syncVipUI(currentUserData.vipTier||'free'));
}

window.subscribeVip = async function(tier, price) {
  const t = VIP_TIERS[tier];
  if (!confirm(`Upgrade ke ${t.icon} ${t.name.toUpperCase()}?\n\nHarga: ${price}/bulan\n\nPembayaran via Transfer Manual.\nKontak admin WA setelah bayar.`)) return;
  const orderId = 'VIP-'+Date.now().toString(36).toUpperCase();
  await addDoc(collection(db,'orders'), {
    uid:currentUser.uid, userEmail:currentUser.email, userName:currentUserData.name,
    orderId, price, method:'Transfer', status:'pending',
    type:'vip', vipTier:tier, coins:0, createdAt:serverTimestamp()
  });
  await addDoc(collection(db,'notifications'), {
    uid:currentUser.uid, title:`ðŸ‘‘ Order VIP ${t.name}!`, message:`Order ${orderId} menunggu konfirmasi admin.`, icon:t.icon, read:false, createdAt:serverTimestamp()
  });
  const waMsg = encodeURIComponent(`ðŸ‘‘ *DEV Uploader - VIP Upgrade*\n\nHai Admin!\nSaya ingin upgrade ke *${t.name}*\n\nOrder ID: ${orderId}\nHarga: ${price}/bulan\nAkun: ${currentUser.email}\n\nMohon konfirmasi pembayaran ðŸ™`);
  window.open(`https://wa.me/${ADMIN_WA}?text=${waMsg}`, '_blank');
  toast(`âœ“ Order VIP ${t.name} dibuat! Kontak admin untuk konfirmasi.`);
  loadNotifications();
}

// â•â• SPIN WHEEL â•â•
const SPIN_PRIZES = [
  { label:'1 Coin', coins:1, color:'#2d3748', prob:30 },
  { label:'2 Coin', coins:2, color:'#1a365d', prob:25 },
  { label:'3 Coin', coins:3, color:'#2c5f2e', prob:20 },
  { label:'5 Coin', coins:5, color:'#744210', prob:12 },
  { label:'10 Coin', coins:10, color:'#6b21a8', prob:8 },
  { label:'FREE', coins:0, color:'#7f1d1d', label2:'Upload', prob:3 },
  { label:'20 Coin', coins:20, color:'#92400e', prob:1.5 },
  { label:'50 Coin', coins:50, color:'#1e3a5f', prob:0.5 },
];
let spinAngle = 0, spinAnimating = false;

function drawSpinWheel() {
  const canvas = document.getElementById('spinCanvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const cx = 130, cy = 130, r = 120;
  const total = SPIN_PRIZES.length;
  const arc = (Math.PI * 2) / total;
  ctx.clearRect(0, 0, 260, 260);
  SPIN_PRIZES.forEach((p, i) => {
    const start = spinAngle + i * arc - Math.PI/2;
    const end = start + arc;
    // Slice
    ctx.beginPath(); ctx.moveTo(cx, cy);
    ctx.arc(cx, cy, r, start, end);
    ctx.closePath();
    ctx.fillStyle = p.color;
    ctx.fill();
    ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 1; ctx.stroke();
    // Text
    ctx.save();
    ctx.translate(cx, cy);
    ctx.rotate(start + arc/2);
    ctx.textAlign = 'right';
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 11px Syne, sans-serif';
    ctx.fillText(p.label, r - 8, 4);
    ctx.restore();
  });
  // Center circle
  ctx.beginPath(); ctx.arc(cx, cy, 22, 0, Math.PI*2);
  ctx.fillStyle = '#020408'; ctx.fill();
  ctx.strokeStyle = 'rgba(201,168,76,0.5)'; ctx.lineWidth = 2; ctx.stroke();
}

async function initSpinWheel() {
  drawSpinWheel();
  if (!currentUser) return;
  try {
    const spinDoc = await getDoc(doc(db,'spins',currentUser.uid));
    const data = spinDoc.exists() ? spinDoc.data() : {};
    const vip = currentUserData?.vipTier || 'free';
    const maxSpins = vip==='diamond'?3:vip==='gold'?2:1;
    const today = new Date().toDateString();
    const spinsToday = data.date === today ? (data.count||0) : 0;
    const remaining = maxSpins - spinsToday;
    const cooldownEl = document.getElementById('spinCooldownInfo');
    const btnSpin = document.getElementById('btnSpin');
    if (remaining > 0) {
      if (cooldownEl) cooldownEl.innerHTML = `Sisa spin: <span>${remaining}x</span> hari ini`;
      if (btnSpin) { btnSpin.disabled = false; btnSpin.textContent = 'ðŸŽ° PUTAR!'; }
    } else {
      const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate()+1); tomorrow.setHours(0,0,0,0);
      const diff = tomorrow - new Date();
      const h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000);
      if (cooldownEl) cooldownEl.innerHTML = `Reset dalam: <span>${h}j ${m}m</span>`;
      if (btnSpin) { btnSpin.disabled = true; btnSpin.textContent = 'Besok Lagi!'; }
    }
    // History
    const histEl = document.getElementById('spinHistory');
    if (histEl && data.history?.length) {
      histEl.innerHTML = '<div style="font-family:DM Mono,monospace;font-size:9px;color:var(--muted);letter-spacing:2px;margin-bottom:6px">RIWAYAT SPIN</div>' +
        data.history.slice(-5).reverse().map(h=>
          `<div class="spin-history-item">${h.date} <span>+${h.coins} Coin (${h.label})</span></div>`
        ).join('');
    }
  } catch(e) {}
}

window.doSpin = async function() {
  if (spinAnimating || !currentUser) return;
  const btnSpin = document.getElementById('btnSpin');
  if (btnSpin?.disabled) return;
  // Check spins
  const vip = currentUserData?.vipTier || 'free';
  const maxSpins = vip==='diamond'?3:vip==='gold'?2:1;
  const today = new Date().toDateString();
  let spinData = {};
  try {
    const spinDoc = await getDoc(doc(db,'spins',currentUser.uid));
    spinData = spinDoc.exists() ? spinDoc.data() : {};
  } catch(e) {}
  const spinsToday = spinData.date === today ? (spinData.count||0) : 0;
  if (spinsToday >= maxSpins) return toast('Spin sudah habis hari ini!');
  // Pick prize by probability
  const rand = Math.random() * 100;
  let cumulative = 0, prize = SPIN_PRIZES[0];
  for (const p of SPIN_PRIZES) { cumulative += p.prob; if (rand <= cumulative) { prize = p; break; } }
  const prizeIdx = SPIN_PRIZES.indexOf(prize);
  // Animate
  spinAnimating = true;
  if (btnSpin) btnSpin.disabled = true;
  const total = SPIN_PRIZES.length;
  const arc = (Math.PI * 2) / total;
  const targetAngle = (Math.PI * 2 * 5) + (Math.PI * 2 - (prizeIdx * arc)) - arc/2;
  const startAngle = spinAngle;
  const duration = 4000;
  const startTime = performance.now();
  function animate(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const ease = 1 - Math.pow(1 - progress, 4);
    spinAngle = startAngle + targetAngle * ease;
    drawSpinWheel();
    if (progress < 1) { requestAnimationFrame(animate); }
    else {
      spinAnimating = false;
      showSpinResult(prize, spinsToday+1, maxSpins, today, spinData);
    }
  }
  requestAnimationFrame(animate);
}

async function showSpinResult(prize, newCount, maxSpins, today, oldData) {
  // Give prize
  if (prize.coins > 0) {
    await updateDoc(doc(db,'users',currentUser.uid), {coins:increment(prize.coins)});
    currentUserData.coins = (currentUserData.coins||0) + prize.coins;
    updateUI();
  }
  // Save spin data
  const history = [...(oldData.history||[]), {date:new Date().toLocaleDateString('id-ID'), coins:prize.coins, label:prize.label}];
  await setDoc(doc(db,'spins',currentUser.uid), {date:today, count:newCount, history:history.slice(-20)});
  // Notify
  await addDoc(collection(db,'notifications'), {uid:currentUser.uid, title:'ðŸŽ° Spin Result!', message:`+${prize.coins} Coin dari Spin Wheel! (${prize.label})`, icon:'ðŸŽ°', read:false, createdAt:serverTimestamp()});
  // Show result
  const resultEl = document.getElementById('spinResult');
  if (resultEl) {
    resultEl.innerHTML = `ðŸŽ‰ Selamat! Kamu dapat <strong>${prize.label}</strong>${prize.coins>0?` (+${prize.coins} Coin)`:''}!`;
    resultEl.classList.add('show');
    setTimeout(()=>resultEl.classList.remove('show'), 4000);
  }
  toast(`ðŸŽ° +${prize.coins} Coin!`);
  loadNotifications();
  setTimeout(()=>initSpinWheel(), 500);
}

// â•â• ENHANCED REVENUE CHART â•â•
function drawRevenueLineChart(monthlyData) {
  const canvas = document.getElementById('revLineCanvas');
  if (!canvas) return;
  const W = canvas.parentElement.clientWidth - 28;
  canvas.width = W; canvas.height = 120;
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,W,120);
  const entries = Object.entries(monthlyData).slice(-6);
  if (entries.length < 2) return;
  const vals = entries.map(e=>e[1]);
  const maxV = Math.max(...vals, 1);
  const pad = 20, chartW = W - pad*2, chartH = 80;
  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.05)'; ctx.lineWidth = 1;
  for (let i=0;i<=4;i++) { const y=pad+chartH*(1-i/4); ctx.beginPath();ctx.moveTo(pad,y);ctx.lineTo(W-pad,y);ctx.stroke(); }
  // Fill area
  const grad = ctx.createLinearGradient(0,pad,0,pad+chartH);
  grad.addColorStop(0,'rgba(0,229,160,0.3)'); grad.addColorStop(1,'rgba(0,229,160,0)');
  ctx.beginPath();
  entries.forEach(([,v],i)=>{ const x=pad+i*(chartW/(entries.length-1)), y=pad+chartH*(1-v/maxV); i===0?ctx.moveTo(x,y):ctx.lineTo(x,y); });
  ctx.lineTo(pad+chartW,pad+chartH); ctx.lineTo(pad,pad+chartH); ctx.closePath();
  ctx.fillStyle=grad; ctx.fill();
  // Line
  ctx.beginPath();
  entries.forEach(([,v],i)=>{ const x=pad+i*(chartW/(entries.length-1)), y=pad+chartH*(1-v/maxV); i===0?ctx.moveTo(x,y):ctx.lineTo(x,y); });
  ctx.strokeStyle='var(--green)'; ctx.lineWidth=2; ctx.stroke();
  // Dots + labels
  entries.forEach(([m,v],i)=>{
    const x=pad+i*(chartW/(entries.length-1)), y=pad+chartH*(1-v/maxV);
    ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fillStyle='var(--green)';ctx.fill();
    ctx.fillStyle='rgba(255,255,255,0.5)';ctx.font='9px DM Mono, monospace';ctx.textAlign='center';
    ctx.fillText(m,x,pad+chartH+14);
    if(v>0){ctx.fillStyle='var(--green)';ctx.fillText('Rp'+(v/1000).toFixed(0)+'k',x,y-8);}
  });
}

// â•â• LANDING PAGE â•â•
window.showLanding = function() { document.getElementById('screen-landing').style.display='block'; document.getElementById('screen-auth').style.display='none'; }
window.hideLanding = function() { document.getElementById('screen-landing').style.display='none'; document.getElementById('screen-auth').style.display='flex'; }

// â•â• ADMIN TABS â•â•
let allAdminUsers=[], allAdminOrders=[], allAdminTickets=[], allAdminUploads=[];
window.switchAdminTab = function(tab, btn) {
  document.querySelectorAll('.admin-tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.admin-panel-section').forEach(s=>s.style.display='none');
  if(btn) btn.classList.add('active');
  const sec = document.getElementById('asec-'+tab);
  if(sec) sec.style.display='block';
  if(tab==='analytics') renderAdminAnalytics();
  if(tab==='chat') switchAdminTab_chat();
  if(tab==='vip') loadAdminVip();
};

// â•â• ENHANCED loadAdminData â•â•
const _origLoadAdminData = loadAdminData;
window.loadAdminData = async function() {
  document.getElementById('adminLoading').style.display='block';
  document.getElementById('adminContent').style.display='none';
  try {
    const [usersSnap, ordersSnap, uploadsSnap, ticketsSnap] = await Promise.all([
      getDocs(query(collection(db,'users'), orderBy('createdAt','desc'), limit(200))),
      getDocs(query(collection(db,'orders'), orderBy('createdAt','desc'), limit(200))),
      getDocs(query(collection(db,'uploads'), orderBy('createdAt','desc'), limit(200))),
      getDocs(query(collection(db,'tickets'), orderBy('createdAt','desc'), limit(100)))
    ]);
    allAdminUsers=[]; usersSnap.forEach(d=>allAdminUsers.push({id:d.id,...d.data()}));
    allAdminOrders=[]; ordersSnap.forEach(d=>allAdminOrders.push({id:d.id,...d.data()}));
    allAdminUploads=[]; uploadsSnap.forEach(d=>allAdminUploads.push({id:d.id,...d.data()}));
    allAdminTickets=[]; ticketsSnap.forEach(d=>allAdminTickets.push({id:d.id,...d.data()}));
    const pending = allAdminOrders.filter(o=>o.status==='pending');
    const revenue = allAdminOrders.filter(o=>o.status==='confirmed').reduce((a,o)=>{
      const n=parseInt((o.price||'0').replace(/\D/g,''));return a+n;},0);
    const today = new Date().toDateString();
    const newToday = allAdminUsers.filter(u=>u.createdAt?.toDate&&u.createdAt.toDate().toDateString()===today).length;
    const upToday = allAdminUploads.filter(u=>u.createdAt?.toDate&&u.createdAt.toDate().toDateString()===today).length;
    const revToday = allAdminOrders.filter(o=>o.status==='confirmed'&&o.createdAt?.toDate&&o.createdAt.toDate().toDateString()===today).reduce((a,o)=>a+parseInt((o.price||'0').replace(/\D/g,'')),0);
    const openTickets = allAdminTickets.filter(t=>t.status==='open').length;
    document.getElementById('adminStatUsers').textContent=allAdminUsers.length;
    document.getElementById('adminStatOrders').textContent=allAdminOrders.length;
    document.getElementById('adminStatUploads').textContent=allAdminUploads.length;
    document.getElementById('adminStatPending').textContent=pending.length;
    document.getElementById('adminStatRevenue').textContent='Rp '+(revenue/1000).toFixed(0)+'k';
    document.getElementById('adminStatTickets').textContent=openTickets;
    document.getElementById('adminStatNewToday').textContent=newToday;
    document.getElementById('adminStatUpToday').textContent=upToday;
    document.getElementById('adminStatRevToday').textContent='Rp '+(revToday/1000).toFixed(0)+'k';
    document.getElementById('adminStatOpenTickets').textContent=openTickets;
    renderAdminActivity(); renderAdminUsers(); renderAdminOrders(); renderAdminTickets(); renderAdminUploads();
    // Retention & heatmap
    const days={};const now2=new Date();for(let i=6;i>=0;i--){const d=new Date(now2);d.setDate(d.getDate()-i);days[d.toLocaleDateString('id-ID',{weekday:'short'})]=0;}
    allAdminUploads.forEach(i=>{if(!i.createdAt?.toDate)return;const d=i.createdAt.toDate().toLocaleDateString('id-ID',{weekday:'short'});if(days[d]!==undefined)days[d]++;});
    const maxR=Math.max(...Object.values(days),1);
    const rc=document.getElementById('retentionChart');if(rc)rc.innerHTML=Object.entries(days).map(([d,v])=>`<div class="retention-bar"><span class="retention-label">${d}</span><div class="retention-track"><div class="retention-fill" style="width:${(v/maxR)*100}%;background:${v>5?'var(--gold)':v>2?'var(--teal)':'var(--purple)'}"></div></div><span class="retention-pct">${v}</span></div>`).join('');
    // Heatmap 28 days
    const hm=document.getElementById('activityHeatmap');
    if(hm){const cells=[];const hmax=Math.max(...Array.from({length:28},(_,i)=>{const d=new Date();d.setDate(d.getDate()-i);const ds=d.toDateString();return allAdminUploads.filter(u=>u.createdAt?.toDate&&u.createdAt.toDate().toDateString()===ds).length;}),1);
    for(let i=27;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);const ds=d.toDateString();const cnt=allAdminUploads.filter(u=>u.createdAt?.toDate&&u.createdAt.toDate().toDateString()===ds).length;const intensity=cnt/hmax;cells.push(`<div class="heatmap-cell" style="background:rgba(201,168,76,${intensity>0?0.1+intensity*0.9:0.04})" title="${d.toLocaleDateString('id-ID')}: ${cnt}"></div>`);}hm.innerHTML=cells.join('');}
    // Revenue chart (monthly bar)
    const monthly={};allAdminOrders.filter(o=>o.status==='confirmed').forEach(o=>{if(!o.createdAt?.toDate)return;const m=o.createdAt.toDate().toLocaleDateString('id-ID',{month:'short',year:'2-digit'});const v=parseInt((o.price||'0').replace(/\D/g,''));monthly[m]=(monthly[m]||0)+v;});
    const revChart=document.getElementById('revenueChart');if(revChart){const mmax=Math.max(...Object.values(monthly),1);revChart.innerHTML=Object.entries(monthly).slice(-6).map(([m,v])=>`<div class="bar-col"><div class="bar-wrap"><div class="bar-fill" style="height:${(v/mmax)*100}%;background:var(--green)">${v>0?`<span class="bar-val" style="font-size:8px">Rp${(v/1000).toFixed(0)}k</span>`:''}</div></div><div class="bar-label">${m}</div></div>`).join('');}
    // Promo list
    const promoSnap=await getDocs(query(collection(db,'promos'),orderBy('createdAt','desc'),limit(20)));const promos=[];promoSnap.forEach(d=>promos.push({id:d.id,...d.data()}));
    const pl=document.getElementById('promoList');if(pl)pl.innerHTML=promos.length?promos.map(p=>`<div style="background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:12px;padding:12px;margin-bottom:8px;display:flex;align-items:center;gap:10px"><div style="flex:1"><div style="font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--gold);letter-spacing:2px">${p.code}</div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">+${p.coinBonus||0} Coin Â· ${p.discount||0}% diskon Â· ${p.usedCount||0}/${p.maxUses||'âˆž'} dipakai${p.expiry?` Â· exp: ${p.expiry}`:''}</div>${p.description?`<div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted2)">${p.description}</div>`:''}</div><div style="display:flex;gap:6px"><div class="badge-${p.active?'active':'pending'}" style="font-family:'DM Mono',monospace;font-size:9px;padding:3px 8px;border-radius:6px;background:${p.active?'rgba(0,229,160,0.1)':'rgba(255,68,102,0.1)'};color:${p.active?'var(--green)':'var(--red)'}">${p.active?'AKTIF':'OFF'}</div><button onclick="togglePromo('${p.id}',${p.active})" class="${p.active?'btn-sub-coin':'btn-add-coin'}" style="font-size:10px;padding:4px 8px">${p.active?'Matikan':'Aktifkan'}</button><button onclick="deletePromo('${p.id}')" class="btn-sub-coin" style="font-size:10px;padding:4px 8px">ðŸ—‘</button></div></div>`).join(''):'<div style="text-align:center;padding:16px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada promo</div>';
    // Broadcast history
    const bhSnap=await getDocs(query(collection(db,'broadcasts'),orderBy('createdAt','desc'),limit(10)));const bhs=[];bhSnap.forEach(d=>bhs.push({id:d.id,...d.data()}));
    const bhEl=document.getElementById('broadcastHistory');if(bhEl)bhEl.innerHTML=bhs.length?bhs.map(b=>`<div style="background:rgba(255,255,255,0.02);border:1px solid var(--rim);border-radius:11px;padding:11px;margin-bottom:7px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px"><span style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700">${b.icon||'ðŸ“¢'} ${b.title}</span><span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">${b.createdAt?.toDate?b.createdAt.toDate().toLocaleString('id-ID'):''}</span></div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">${b.message} Â· ${b.sentCount||0} penerima</div></div>`).join(''):'<div style="text-align:center;padding:16px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada broadcast</div>';
  } catch(e){ console.error(e); toast('âš  Error: '+e.message); }
  document.getElementById('adminLoading').style.display='none';
  document.getElementById('adminContent').style.display='block';
};

function renderAdminActivity() {
  const el = document.getElementById('adminRecentActivity'); if(!el) return;
  const recent = [...allAdminOrders.slice(0,3).map(o=>({time:o.createdAt,icon:'ðŸ“¦',text:`Order ${o.orderId||'â€”'} dari ${o.userName||'?'} (${o.status})`})),
    ...allAdminUsers.slice(0,3).map(u=>({time:u.createdAt,icon:'ðŸ‘¤',text:`User baru: ${u.name} (${u.email})`})),
    ...allAdminTickets.filter(t=>t.status==='open').slice(0,2).map(t=>({time:t.createdAt,icon:'ðŸŽ«',text:`Ticket: ${t.subject} dari ${t.userName}`}))]
    .sort((a,b)=>(b.time?.seconds||0)-(a.time?.seconds||0)).slice(0,8);
  el.innerHTML=recent.map(r=>`<div style="display:flex;gap:10px;align-items:flex-start;padding:8px 0;border-bottom:1px solid var(--rim)"><div style="font-size:16px;flex-shrink:0">${r.icon}</div><div><div style="font-family:'DM Mono',monospace;font-size:11px;color:var(--text)">${r.text}</div><div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">${r.time?.toDate?r.time.toDate().toLocaleString('id-ID'):''}</div></div></div>`).join('') || '<div style="font-family:DM Mono,monospace;font-size:11px;color:var(--muted);padding:12px">Belum ada aktivitas</div>';
}

function renderAdminUsers(filter='all', search='') {
  const el = document.getElementById('adminUserList'); if(!el) return;
  let users = allAdminUsers;
  if(filter==='banned') users=users.filter(u=>u.isBanned);
  else if(filter==='active') users=users.filter(u=>!u.isBanned);
  else if(filter==='vip') users=users.filter(u=>u.vipTier&&u.vipTier!=='free');
  if(search) users=users.filter(u=>(u.name||'').toLowerCase().includes(search)||(u.email||'').toLowerCase().includes(search));
  const statsEl = document.getElementById('adminUserStats');
  if(statsEl) statsEl.innerHTML=`<div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">Total: <b style="color:var(--text)">${allAdminUsers.length}</b></div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">Banned: <b style="color:var(--red)">${allAdminUsers.filter(u=>u.isBanned).length}</b></div><div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">VIP: <b style="color:var(--gold)">${allAdminUsers.filter(u=>u.vipTier&&u.vipTier!=='free').length}</b></div>`;
  el.innerHTML=users.map(u=>`<div class="admin-user-card ${u.isBanned?'banned':''}"><div class="admin-user-top"><div class="admin-user-avatar">${u.avatarEmoji||'âš¡'}</div><div class="admin-user-info"><div class="admin-user-name">${u.name||'Unknown'} ${u.isAdmin?'<span class="badge-admin">ADMIN</span>':''} ${u.isBanned?'<span class="badge-banned">BANNED</span>':''} ${u.vipTier&&u.vipTier!=='free'?`<span class="vip-badge ${u.vipTier}">${{silver:'ðŸ¥ˆ',gold:'ðŸ‘‘',diamond:'ðŸ’Ž'}[u.vipTier]} ${u.vipTier.toUpperCase()}</span>`:''}</div><div class="admin-user-email">${u.email}</div>${u.waNumber?`<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--green)">ðŸ“± +${u.waNumber}</div>`:''}<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">ðŸ‘¥ ${u.referralCount||0} ref Â· ðŸ“¤ ${u.totalUploads||0} upload</div></div><div class="admin-user-coins"><span class="coins-display">âœ¦ ${u.coins||0}</span></div></div><div class="admin-user-actions"><input class="finput" type="number" id="coinInp_${u.id}" placeholder="Jumlah" style="flex:1;padding:7px 10px;font-size:12px"><button class="btn-add-coin" onclick="addCoins('${u.id}','${u.name}','${u.waNumber||''}')">+ Add</button><button class="btn-sub-coin" onclick="subCoins('${u.id}','${u.name}')">- Sub</button><button class="btn-set-coin" onclick="setCoins('${u.id}','${u.name}')">Set</button>${!u.isAdmin?`<button class="${u.isBanned?'btn-add-coin':'btn-sub-coin'}" onclick="toggleBan('${u.id}','${u.name}',${!!u.isBanned})">${u.isBanned?'âœ“ Unban':'ðŸš« Ban'}</button><button class="btn-set-coin" onclick="setVipAdmin('${u.id}','${u.name}')">ðŸ‘‘ VIP</button>`:''}${u.waNumber?`<a href="https://wa.me/${u.waNumber}" target="_blank"><button class="btn-add-coin" style="background:rgba(37,211,102,0.1);border-color:rgba(37,211,102,0.3);color:#25d366">ðŸ’¬ WA</button></a>`:''}</div></div>`).join('') || '<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Tidak ada user</div>';
}

function renderAdminOrders(filter='all') {
  const el = document.getElementById('adminOrderList'); if(!el) return;
  let orders = allAdminOrders;
  if(filter!=='all') orders=orders.filter(o=>o.status===filter);
  el.innerHTML=orders.map(o=>`<div class="order-card"><div class="order-top"><span class="order-id">${o.orderId||'â€”'}</span><span class="order-status ${o.status}">${o.status==='pending'?'â³':o.status==='confirmed'?'âœ…':'âŒ'} ${o.status.toUpperCase()}</span></div><div class="order-info">${o.userName||'?'} Â· ${o.userEmail||''}</div><div class="order-info">${o.type==='vip'?`ðŸ‘‘ VIP ${o.vipTier||''}`:o.coins+' Coins'} Â· ${o.price} Â· ${o.method}</div><div class="order-info" style="font-size:9px;color:var(--muted)">${o.createdAt?.toDate?o.createdAt.toDate().toLocaleString('id-ID'):''}</div>${o.status==='pending'?`<div style="display:flex;gap:6px;margin-top:8px"><button class="btn-confirm-order" onclick="confirmOrder('${o.id}','${o.uid}',${o.coins},'${o.vipTier||''}','${o.type||'coin'}')">âœ… Konfirmasi</button><button class="btn-reject-order" onclick="rejectOrder('${o.id}','${o.uid}')">âŒ Tolak</button></div>`:''}${o.adminNote?`<div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:4px">Note: ${o.adminNote}</div>`:''}</div>`).join('') || '<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Tidak ada order</div>';
}

function renderAdminTickets(filter='all') {
  const el = document.getElementById('adminTicketList'); if(!el) return;
  let tickets = allAdminTickets;
  if(filter!=='all') tickets=tickets.filter(t=>t.status===filter);
  el.innerHTML=tickets.map(t=>`<div class="ticket-row"><div class="ticket-top"><div><div class="ticket-subject">${t.subject}</div><div class="ticket-meta">${t.userName||'?'} Â· ${t.type} Â· ${t.createdAt?.toDate?t.createdAt.toDate().toLocaleString('id-ID'):''}</div></div><div class="ticket-status ${t.status}">${t.status==='open'?'â³ OPEN':t.status==='replied'?'ðŸ’¬ REPLIED':'âœ“ CLOSED'}</div></div><div class="ticket-msg">${t.message}</div>${t.adminReply?`<div class="ticket-reply"><span class="ticket-reply-label">ðŸ‘‘ Admin:</span> ${t.adminReply}</div>`:''}<div class="ticket-reply-form"><textarea class="ticket-reply-input" id="replyInp_${t.id}" placeholder="Ketik balasan admin..."></textarea><div class="ticket-reply-actions"><button class="btn-confirm-order" onclick="replyTicket('${t.id}','${t.uid}')">ðŸ’¬ Balas</button><button class="btn-reject-order" onclick="closeTicket('${t.id}')">âœ… Tutup</button>${t.userEmail?`<a href="mailto:${t.userEmail}?subject=Re: ${encodeURIComponent(t.subject)}"><button class="btn-set-coin">ðŸ“§ Email</button></a>`:''}</div></div></div>`).join('') || '<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Tidak ada ticket</div>';
}

function renderAdminUploads(search='', type='all') {
  const el = document.getElementById('adminUploadList'); if(!el) return;
  let ups = allAdminUploads;
  if(type!=='all') ups=ups.filter(u=>u.assetType===type);
  if(search) ups=ups.filter(u=>(u.assetName||'').toLowerCase().includes(search)||(u.userName||'').toLowerCase().includes(search));
  el.innerHTML=ups.slice(0,50).map(u=>`<div class="hist-item" style="margin-bottom:7px"><div class="hist-item-top"><span class="hist-name">${u.assetName}</span><span class="hist-time">${u.createdAt?.toDate?u.createdAt.toDate().toLocaleString('id-ID'):''}</span></div><div style="font-family:DM Mono,monospace;font-size:9px;color:var(--muted2);margin-bottom:4px">${u.userName||'?'} Â· ${u.userEmail||''}</div><div class="hist-id" onclick="cp('${u.assetId}')">ID: ${u.assetId}</div><div class="hist-tags"><span class="hist-tag">${u.assetType}</span>${u.rating?`<span class="hist-tag" style="color:var(--gold)">${'â˜…'.repeat(u.rating)}</span>`:''}</div></div>`).join('') || '<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Tidak ada upload</div>';
}

function renderAdminAnalytics() {
  // Line chart revenue
  const monthly={};allAdminOrders.filter(o=>o.status==='confirmed').forEach(o=>{if(!o.createdAt?.toDate)return;const m=o.createdAt.toDate().toLocaleDateString('id-ID',{month:'short',year:'2-digit'});const v=parseInt((o.price||'0').replace(/\D/g,''));monthly[m]=(monthly[m]||0)+v;});
  setTimeout(()=>{
    const c=document.getElementById('adminRevChart');if(!c)return;
    const W=c.parentElement.clientWidth-28;c.width=W;c.height=140;
    drawLineChart(c,monthly,6,'rgba(0,229,160,0.8)','rgba(0,229,160,0)');
    // User chart
    const userDaily={};const now=new Date();
    for(let i=6;i>=0;i--){const d=new Date(now);d.setDate(d.getDate()-i);const k=d.toLocaleDateString('id-ID',{day:'numeric',month:'short'});userDaily[k]=allAdminUsers.filter(u=>u.createdAt?.toDate&&u.createdAt.toDate().toDateString()===d.toDateString()).length;}
    const uc=document.getElementById('adminUserChart');if(!uc)return;
    const UW=uc.parentElement.clientWidth-28;uc.width=UW;uc.height=120;
    drawLineChart(uc,userDaily,7,'rgba(0,229,200,0.8)','rgba(0,229,200,0)');
    // Type donut
    const types={};allAdminUploads.forEach(u=>types[u.assetType]=(types[u.assetType]||0)+1);
    const tc=document.getElementById('adminTypeChart');
    if(tc)tc.innerHTML=Object.entries(types).map(([t,c2])=>`<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><div style="width:10px;height:10px;border-radius:2px;background:${t==='Decal'?'var(--teal)':t==='Audio'?'var(--gold)':'var(--purple)'}"></div><span style="font-family:'DM Mono',monospace;font-size:10px;flex:1">${t}</span><span style="font-family:'Bebas Neue',sans-serif;font-size:16px;color:var(--text)">${c2}</span></div>`).join('');
  },100);
}

function drawLineChart(canvas, data, count, lineColor, fillEndColor) {
  const entries=Object.entries(data).slice(-count);if(entries.length<2)return;
  const W=canvas.width,H=canvas.height;const ctx=canvas.getContext('2d');ctx.clearRect(0,0,W,H);
  const vals=entries.map(e=>e[1]),maxV=Math.max(...vals,1);
  const pad=20,cW=W-pad*2,cH=H-pad*2-15;
  ctx.strokeStyle='rgba(255,255,255,0.05)';ctx.lineWidth=1;
  for(let i=0;i<=4;i++){const y=pad+cH*(1-i/4);ctx.beginPath();ctx.moveTo(pad,y);ctx.lineTo(W-pad,y);ctx.stroke();}
  const grad=ctx.createLinearGradient(0,pad,0,pad+cH);
  grad.addColorStop(0,lineColor.replace('0.8','0.3'));grad.addColorStop(1,fillEndColor||'transparent');
  ctx.beginPath();entries.forEach(([,v],i)=>{const x=pad+i*(cW/(entries.length-1)),y=pad+cH*(1-v/maxV);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.lineTo(pad+cW,pad+cH);ctx.lineTo(pad,pad+cH);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  ctx.beginPath();entries.forEach(([,v],i)=>{const x=pad+i*(cW/(entries.length-1)),y=pad+cH*(1-v/maxV);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.strokeStyle=lineColor;ctx.lineWidth=2;ctx.stroke();
  entries.forEach(([m,v],i)=>{const x=pad+i*(cW/(entries.length-1)),y=pad+cH*(1-v/maxV);ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fillStyle=lineColor;ctx.fill();ctx.fillStyle='rgba(255,255,255,0.5)';ctx.font='9px DM Mono,monospace';ctx.textAlign='center';ctx.fillText(m,x,pad+cH+14);if(v>0){ctx.fillStyle=lineColor;ctx.fillText(v,x,y-8);}});
}

window.filterAdminUsers=function(){const s=document.getElementById('adminUserSearch')?.value||'',f=document.getElementById('adminUserFilter')?.value||'all';renderAdminUsers(f,s);}
window.filterAdminOrders=function(){renderAdminOrders(document.getElementById('adminOrderFilter')?.value||'all');}
window.filterAdminTickets=function(){renderAdminTickets(document.getElementById('adminTicketFilter')?.value||'all');}
window.filterAdminUploads=function(){renderAdminUploads(document.getElementById('adminUploadSearch')?.value||'',document.getElementById('adminUploadTypeFilter')?.value||'all');}

window.rejectOrder=async function(orderId,uid){
  const reason=prompt('Alasan penolakan (opsional):','');
  await updateDoc(doc(db,'orders',orderId),{status:'rejected',adminNote:reason||'',rejectedAt:serverTimestamp()});
  await addDoc(collection(db,'notifications'),{uid,title:'âŒ Order Ditolak',message:`Order ditolak.${reason?' Alasan: '+reason:''}`,icon:'âŒ',read:false,createdAt:serverTimestamp()});
  toast('âœ“ Order ditolak');loadAdminData();
}

window.previewBroadcast=function(){
  const icon=document.getElementById('broadIcon').value||'ðŸ“¢';
  const title=document.getElementById('broadTitle').value||'â€”';
  const msg=document.getElementById('broadMsg').value||'â€”';
  showNotifToast(icon+' '+title, msg);
}

window.sendBroadcast=async function(){
  const icon=document.getElementById('broadIcon').value||'ðŸ“¢';
  const title=document.getElementById('broadTitle').value.trim();
  const msg=document.getElementById('broadMsg').value.trim();
  const target=document.getElementById('broadTarget')?.value||'all';
  if(!title||!msg)return toast('âš  Isi judul dan pesan!');
  if(!confirm(`Kirim broadcast ke ${target==='all'?'SEMUA user':target+' user'}?`))return;
  const btn=document.getElementById('btnBroadcast');btn.disabled=true;btn.textContent='Mengirim...';
  try{
    let users=allAdminUsers;
    if(target==='vip')users=users.filter(u=>u.vipTier&&u.vipTier!=='free');
    else if(target==='active'){const cutoff=new Date();cutoff.setDate(cutoff.getDate()-30);users=users.filter(u=>u.createdAt?.toDate&&u.createdAt.toDate()>cutoff);}
    const batch=writeBatch(db);
    users.forEach(u=>{const ref=doc(collection(db,'notifications'));batch.set(ref,{uid:u.id,title,message:msg,icon,read:false,createdAt:serverTimestamp()});});
    await batch.commit();
    await addDoc(collection(db,'broadcasts'),{title,message:msg,icon,target,sentCount:users.length,createdAt:serverTimestamp()});
    document.getElementById('broadTitle').value='';document.getElementById('broadMsg').value='';
    toast(`âœ“ Broadcast terkirim ke ${users.length} user!`);loadAdminData();
  }catch(e){toast('âš  Error: '+e.message);}
  btn.disabled=false;btn.textContent='ðŸ“¢ KIRIM BROADCAST';
}

window.createPromo=async function(){
  const code=document.getElementById('promoCode').value.trim().toUpperCase();
  const bonus=parseInt(document.getElementById('promoBonusCoin').value)||0;
  const discount=parseInt(document.getElementById('promoDiscount')?.value)||0;
  const maxUses=parseInt(document.getElementById('promoMaxUses').value)||0;
  const expiry=document.getElementById('promoExpiry')?.value||null;
  const desc=document.getElementById('promoDesc')?.value.trim()||'';
  if(!code)return toast('âš  Masukkan kode!');
  try{
    await addDoc(collection(db,'promos'),{code,coinBonus:bonus,discount,maxUses,usedCount:0,active:true,expiry,description:desc,createdAt:serverTimestamp()});
    document.getElementById('promoCode').value='';document.getElementById('promoBonusCoin').value='';document.getElementById('promoMaxUses').value='';
    toast(`âœ“ Promo ${code} dibuat!`);loadAdminData();
  }catch(e){toast('âš  Gagal: '+e.message);}
}
window.deletePromo=async function(id){if(!confirm('Hapus promo?'))return;const {deleteDoc}=await import('https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js');await deleteDoc(doc(db,'promos',id));toast('âœ“ Promo dihapus');loadAdminData();}

function switchAdminTab_chat(){const el=document.getElementById('adminChatList');if(el&&el.innerHTML.trim()==='')el.innerHTML='<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Memuat...</div>';}

window.loadAdminVip=async function(){
  const snap=await getDocs(query(collection(db,'users'),where('vipTier','!=','free'),orderBy('vipTier'),limit(50)));
  const vips=[];snap.forEach(d=>vips.push({id:d.id,...d.data()}));
  const el=document.getElementById('adminVipList');if(!el)return;
  el.innerHTML=vips.length?vips.map(u=>`<div class="admin-user-card"><div class="admin-user-top"><div class="admin-user-avatar">${u.avatarEmoji||'âš¡'}</div><div class="admin-user-info"><div class="admin-user-name">${u.name} <span class="vip-badge ${u.vipTier}">${{silver:'ðŸ¥ˆ',gold:'ðŸ‘‘',diamond:'ðŸ’Ž'}[u.vipTier]} ${u.vipTier.toUpperCase()}</span></div><div class="admin-user-email">${u.email}</div><div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">Exp: ${u.vipExpiry?new Date(u.vipExpiry).toLocaleDateString('id-ID'):'â€”'}</div></div><div><button class="btn-sub-coin" onclick="setVipAdmin('${u.id}','${u.name}')">Edit</button></div></div></div>`).join(''):'<div style="text-align:center;padding:20px;font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada VIP member</div>';
  const statsEl=document.getElementById('adminVipStats');if(!statsEl)return;
  ['free','silver','gold','diamond'].forEach(tier=>{
    const cnt=allAdminUsers.filter(u=>(u.vipTier||'free')===tier).length;
    statsEl.querySelector(`#vipStat${tier}`)||statsEl.insertAdjacentHTML('beforeend',`<div class="ainfo-box" id="vipStat${tier}"><div class="ainfo-val">${cnt}</div><div class="ainfo-lbl">${tier.toUpperCase()}</div></div>`);
    const el2=document.getElementById('vipStat'+tier);if(el2)el2.querySelector('.ainfo-val').textContent=cnt;
  });
}

// â•â• REAL-TIME NOTIF TOAST â•â•
let notifUnsub = null;
function setupRealtimeNotif() {
  if(!currentUser||notifUnsub)return;
  const q=query(collection(db,'notifications'),where('uid','==',currentUser.uid),where('read','==',false),orderBy('createdAt','desc'),limit(1));
  let first=true;
  notifUnsub=onSnapshot(q, snap=>{
    if(first){first=false;return;}
    snap.docChanges().forEach(change=>{
      if(change.type==='added'){
        const d=change.doc.data();
        showNotifToast(d.icon+' '+d.title, d.message);
        const badge=document.getElementById('notifBadge');if(badge){const c=parseInt(badge.textContent||0);badge.textContent=c+1;}
      }
    });
  });
}

function showNotifToast(title, msg) {
  const popup=document.getElementById('notifToastPopup');
  if(!popup)return;
  document.getElementById('notifToastTitle').textContent=title;
  document.getElementById('notifToastMsg').textContent=msg;
  popup.classList.add('show');
  setTimeout(()=>popup.classList.remove('show'),4000);
}

// â•â• MARKETPLACE â•â•
let allMarketItems=[], activeMarketFilter='all', marketSearchQuery='';

async function loadMarket(){
  try{
    const snap=await getDocs(query(collection(db,'marketplace'),orderBy('createdAt','desc'),limit(50)));
    allMarketItems=[];snap.forEach(d=>allMarketItems.push({id:d.id,...d.data()}));
    renderMarket();
  }catch(e){renderMarket();}
}

window.renderMarket=function(){
  const sort=document.getElementById('marketSort')?.value||'newest';
  let items=[...allMarketItems];
  if(activeMarketFilter!=='all'){
    if(activeMarketFilter==='free') items=items.filter(i=>!i.price||i.price===0);
    else items=items.filter(i=>i.assetType===activeMarketFilter);
  }
  if(marketSearchQuery) items=items.filter(i=>(i.name||'').toLowerCase().includes(marketSearchQuery));
  if(sort==='cheapest') items.sort((a,b)=>(a.price||0)-(b.price||0));
  else if(sort==='popular') items.sort((a,b)=>(b.buyCount||0)-(a.buyCount||0));
  const grid=document.getElementById('marketGrid');
  const empty=document.getElementById('marketEmpty');
  if(!items.length){if(grid)grid.innerHTML='';if(empty)empty.style.display='block';return;}
  if(empty)empty.style.display='none';
  if(grid)grid.innerHTML=items.map(item=>`
    <div class="market-card" onclick="openMarketItem('${item.id}')">
      <div class="market-card-thumb">
        ${item.assetType==='Decal'?`<img src="https://www.roblox.com/asset-thumbnail/image?assetId=${item.assetId}&width=150&height=150&format=png" style="width:100%;height:100%;object-fit:cover" onerror="this.parentElement.innerHTML='ðŸ–¼ï¸'">`:`<span>${item.assetType==='Audio'?'ðŸŽµ':'ðŸ“¦'}</span>`}
        <div class="market-card-type">${item.assetType}</div>
      </div>
      <div class="market-card-body">
        <div class="market-card-name">${item.name}</div>
        <div class="market-card-seller">ðŸ‘¤ ${item.sellerName||'Anonymous'}</div>
        <div class="market-card-foot">
          <div><div class="market-price">${item.price>0?item.price:0}</div><div class="market-price-lbl">${item.price>0?'Coin':'Gratis'}</div></div>
          <button class="btn-market-buy" onclick="event.stopPropagation();buyMarketAsset('${item.id}','${item.name}',${item.price||0},'${item.assetId}','${item.sellerId}')">
            ${item.price>0?'ðŸ’° Beli':'â¬‡ Ambil'}
          </button>
        </div>
      </div>
    </div>`).join('');
}

window.filterMarket=function(type,el){
  activeMarketFilter=type;
  document.querySelectorAll('.market-filter-chip').forEach(c=>c.classList.remove('on'));
  if(el)el.classList.add('on');
  renderMarket();
}
window.searchMarket=function(){marketSearchQuery=document.getElementById('marketSearch')?.value?.toLowerCase()||'';renderMarket();}

window.listAssetForSale=async function(){
  if(!currentUser)return toast('âš  Login dulu!');
  const name=document.getElementById('sellName').value.trim();
  const assetId=document.getElementById('sellAssetId').value.trim();
  const type=document.getElementById('sellType').value;
  const price=parseInt(document.getElementById('sellPrice').value)||0;
  const desc=document.getElementById('sellDesc').value.trim();
  if(!name||!assetId)return toast('âš  Isi nama dan asset ID!');
  await addDoc(collection(db,'marketplace'),{name,assetId,assetType:type,price,description:desc,sellerId:currentUser.uid,sellerName:currentUserData.name,buyCount:0,createdAt:serverTimestamp()});
  ['sellName','sellAssetId','sellDesc'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('sellPrice').value='';
  toast(`âœ“ ${name} berhasil di-listing!`);loadMarket();
}

window.buyMarketAsset=async function(itemId,name,price,assetId,sellerId){
  if(!currentUser)return toast('âš  Login dulu!');
  if(sellerId===currentUser.uid)return toast('âš  Tidak bisa beli asset sendiri!');
  if(price>0){
    if(currentUserData.coins<price)return toast(`âš  Coin tidak cukup! Butuh ${price} coin.`);
    if(!confirm(`Beli "${name}" seharga ${price} Coin?`))return;
    await updateDoc(doc(db,'users',currentUser.uid),{coins:increment(-price)});
    await updateDoc(doc(db,'users',sellerId),{coins:increment(Math.floor(price*0.9))});
    currentUserData.coins-=price;updateUI();
  }
  await updateDoc(doc(db,'marketplace',itemId),{buyCount:increment(1)});
  await addDoc(collection(db,'notifications'),{uid:sellerId,title:'ðŸ’° Asset Terjual!',message:`"${name}" dibeli seharga ${price} coin!`,icon:'ðŸ’°',read:false,createdAt:serverTimestamp()});
  toast(`âœ“ Berhasil! Asset ID: ${assetId}`); cp(assetId);
}

window.openMarketItem=function(id){const item=allMarketItems.find(i=>i.id===id);if(!item)return;toast(`Asset ID: ${item.assetId}`);}

// â•â• PROFILE â•â•
window.loadProfile=async function(){
  if(!currentUser||!currentUserData)return;
  document.getElementById('profileAvatarBig').textContent=currentUserData.avatarEmoji||'âš¡';
  document.getElementById('profileNameBig').textContent=currentUserData.name||'â€”';
  document.getElementById('profileJoined').textContent='Bergabung '+(currentUserData.createdAt?.toDate?currentUserData.createdAt.toDate().toLocaleDateString('id-ID'):'â€”');
  document.getElementById('profStatUploads').textContent=currentUserData.totalUploads||0;
  document.getElementById('profStatCoins').textContent=currentUserData.coins||0;
  document.getElementById('profStatRefs').textContent=currentUserData.referralCount||0;
  document.getElementById('profileDisplayName').value=currentUserData.name||'';
  document.getElementById('profileBio').value=currentUserData.bio||'';
  document.getElementById('profileWa').value=currentUserData.waNumber||'';
  // Badges row
  const badges=[];if((currentUserData.totalUploads||0)>=1)badges.push('ðŸ¥‰');if((currentUserData.totalUploads||0)>=10)badges.push('ðŸ¥ˆ');if((currentUserData.totalUploads||0)>=50)badges.push('ðŸ¥‡');if(currentUserData.vipTier==='gold'||currentUserData.vipTier==='diamond')badges.push('ðŸ‘‘');if(currentUserData.vipTier==='diamond')badges.push('ðŸ’Ž');if((currentUserData.referralCount||0)>=5)badges.push('ðŸ¤');
  const vipBadge=currentUserData.vipTier&&currentUserData.vipTier!=='free'?`<span class="vip-badge ${currentUserData.vipTier}">${{silver:'ðŸ¥ˆ',gold:'ðŸ‘‘',diamond:'ðŸ’Ž'}[currentUserData.vipTier]} ${currentUserData.vipTier.toUpperCase()}</span>`:'';
  document.getElementById('profileBadgesRow').innerHTML=vipBadge;
  document.getElementById('profileBadgesFull').innerHTML=badges.map(b=>`<div style="font-size:28px">${b}</div>`).join('')||'<div style="font-family:DM Mono,monospace;font-size:11px;color:var(--muted)">Belum ada badge. Mulai upload!</div>';
}

window.saveProfile=async function(){
  if(!currentUser)return;
  const name=document.getElementById('profileDisplayName').value.trim();
  const bio=document.getElementById('profileBio').value.trim();
  const wa=document.getElementById('profileWa').value.trim();
  if(!name)return toast('âš  Nama tidak boleh kosong!');
  await updateDoc(doc(db,'users',currentUser.uid),{name,bio,waNumber:wa});
  currentUserData.name=name;currentUserData.bio=bio;currentUserData.waNumber=wa;
  updateUI();toast('âœ“ Profil tersimpan!');
}

// â•â• DARK MODE â•â•
window.toggleDarkMode=function(){
  document.body.classList.toggle('light-mode');
  const btn=document.getElementById('darkModeToggle');
  if(btn)btn.textContent=document.body.classList.contains('light-mode')?'â˜€ï¸':'ðŸŒ™';
  localStorage.setItem('theme',document.body.classList.contains('light-mode')?'light':'dark');
}
// Load saved theme
if(localStorage.getItem('theme')==='light'){document.body.classList.add('light-mode');const b=document.getElementById('darkModeToggle');if(b)b.textContent='â˜€ï¸';}

// â•â• HISTORY SEARCH â•â•
window.searchHistory=function(){
  const q=document.getElementById('histSearchInput')?.value?.toLowerCase()||'';
  const type=document.getElementById('histTypeFilter')?.value||'all';
  document.querySelectorAll('.hist-item').forEach(el=>{
    const name=el.querySelector('.hist-name')?.textContent?.toLowerCase()||'';
    const tag=el.querySelector('.hist-tag')?.textContent||'';
    const matchQ=!q||name.includes(q);
    const matchT=type==='all'||tag===type;
    el.style.display=(matchQ&&matchT)?'':'none';
  });
}

// â•â• PATCH switchTab â•â•
const _prevSwitchTab = window.switchTab;
window.switchTab=function(btn,panel){
  _prevSwitchTab(btn,panel);
  if(panel==='market')loadMarket();
  if(panel==='profile')loadProfile();
};

// â•â• PATCH showApp to setup realtime notif â•â•
const _prevShowApp2=window.showApp;
window.showApp=function(){
  if(_prevShowApp2)_prevShowApp2();
  setTimeout(setupRealtimeNotif, 1000);
  loadVipStatus();
};


let canvasRunning=false,animFrame;
function startCanvas(){if(canvasRunning)return;canvasRunning=true;const cv=document.getElementById('c');if(!cv)return;const cx=cv.getContext('2d');let W,H;function resize(){W=cv.width=innerWidth;H=cv.height=innerHeight;}resize();addEventListener('resize',resize);const pts=Array.from({length:80},()=>({x:Math.random()*1400,y:Math.random()*900,vx:(Math.random()-.5)*.2,vy:-(Math.random()*.3+.04),r:Math.random()*1.2+.2,a:Math.random()*.3+.05,c:Math.random()>.65?'#c9a84c':Math.random()>.5?'#00e5c8':'#fff',life:Math.random(),decay:Math.random()*.001+.0004}));const orbs=[{bx:.15,by:.35,cr:'rgba(201,168,76,0.07)',t:0,s:80},{bx:.85,by:.65,cr:'rgba(0,229,200,0.05)',t:2,s:70}];let ot=0;function draw(){if(!canvasRunning)return;cx.clearRect(0,0,W,H);ot+=.003;orbs.forEach(o=>{const ox=o.bx*W+Math.sin(ot+o.t)*o.s,oy=o.by*H+Math.cos(ot*.7+o.t)*50;const rg=cx.createRadialGradient(ox,oy,0,ox,oy,.35*Math.min(W,H));rg.addColorStop(0,o.cr);rg.addColorStop(1,'transparent');cx.fillStyle=rg;cx.fillRect(0,0,W,H);});pts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life-=p.decay;if(p.life<=0||p.y<-10){p.x=Math.random()*W;p.y=H+10;p.life=1;}cx.save();cx.globalAlpha=p.a*p.life;cx.fillStyle=p.c;cx.shadowColor=p.c;cx.shadowBlur=5;cx.beginPath();cx.arc(p.x,p.y,p.r,0,Math.PI*2);cx.fill();cx.restore();});animFrame=requestAnimationFrame(draw);}draw();}
function stopCanvas(){canvasRunning=false;if(animFrame)cancelAnimationFrame(animFrame);}
</script>
</body>
</html>
